

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="è‡ªå®šä¹‰Viewä¸åŠ¨ç”»ä¸€ã€è‡ªå®šä¹‰View1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ ä¸€å¥è¯ï¼šå®˜æ–¹çš„æ§ä»¶æ»¡è¶³ä¸äº†äº§å“æƒ³è¦çš„æ•ˆæœ ( ä½†å…¶å®ï¼Œå®˜æ–¹æ§ä»¶å·²ç»èƒ½æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹è‡ªå®šä¹‰ View æ˜¯ä¸‹ä¸‹ç­–ï¼Œå› ä¸ºé€ è‡ªå®šä¹‰ View çš„è½®å­æ˜¯ä¸€ä»¶å¾ˆè€—æ—¶ä¹Ÿå¾ˆè€—ç²¾åŠ›çš„äº‹ã€‚ è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘å¤§ä¸€æš‘å‡æ—¶é‡åˆ°çš„äº‹æƒ…ï¼Œå½“æ—¶å…± 5 ä¸ªç»„åˆ†å¼€åšç§¯åˆ†å•†åŸï¼Œäº§å“ç»™äº†ä¸€ä¸ªç§¯åˆ†å•†åŸçš„è®¾è®¡å›¾ï¼Œå…¶ä¸­ä¸»é¡µæœ‰ä¸€ä¸ªä¸Šæ»‘å±•å¼€çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ç»„ï¼ˆæˆ‘å’Œé’Ÿæ™ºï¼‰ï¼Œæˆ‘å°±è´Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="Viewç›¸å…³">
<meta property="og:url" content="http://example.com/2022/08/08/%E8%87%AA%E5%AE%9A%E4%B9%89View/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="è‡ªå®šä¹‰Viewä¸åŠ¨ç”»ä¸€ã€è‡ªå®šä¹‰View1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ ä¸€å¥è¯ï¼šå®˜æ–¹çš„æ§ä»¶æ»¡è¶³ä¸äº†äº§å“æƒ³è¦çš„æ•ˆæœ ( ä½†å…¶å®ï¼Œå®˜æ–¹æ§ä»¶å·²ç»èƒ½æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹è‡ªå®šä¹‰ View æ˜¯ä¸‹ä¸‹ç­–ï¼Œå› ä¸ºé€ è‡ªå®šä¹‰ View çš„è½®å­æ˜¯ä¸€ä»¶å¾ˆè€—æ—¶ä¹Ÿå¾ˆè€—ç²¾åŠ›çš„äº‹ã€‚ è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘å¤§ä¸€æš‘å‡æ—¶é‡åˆ°çš„äº‹æƒ…ï¼Œå½“æ—¶å…± 5 ä¸ªç»„åˆ†å¼€åšç§¯åˆ†å•†åŸï¼Œäº§å“ç»™äº†ä¸€ä¸ªç§¯åˆ†å•†åŸçš„è®¾è®¡å›¾ï¼Œå…¶ä¸­ä¸»é¡µæœ‰ä¸€ä¸ªä¸Šæ»‘å±•å¼€çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ç»„ï¼ˆæˆ‘å’Œé’Ÿæ™ºï¼‰ï¼Œæˆ‘å°±è´Ÿ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320161207313.png">
<meta property="og:image" content="c:/Users/%E9%83%AD%E7%A5%A5%E7%91%9E/AppData/Roaming/Typora/typora-user-images/image-20220320144121673.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320163052101.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164459116.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164844556.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320165148269.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320195658810.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321194906364.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321225743926.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230004519.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230432739.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231555746.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231735164.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321232502431.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233030377.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233713916.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234733578.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234928364.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235408579.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235709470.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000124439.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000411111.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000630000.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000826091.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000941813.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322001506870.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002054498.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002252433.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002424079.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322003418726.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180055610.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326185016280.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180533094.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180809792.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322190910124.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191150701.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191527878.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323223301814.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323224318637.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230405944.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230713647.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323231300755.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234144858.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234305639.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141248013.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141438062.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133455931.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133728477.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325134213260.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135853586.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135808864.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231305660.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231921252.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234300251.png">
<meta property="og:image" content="d:/Typora/img/image-20220326234410761.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234634838.png">
<meta property="og:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325155039418.png">
<meta property="article:published_time" content="2022-08-08T06:44:33.000Z">
<meta property="article:modified_time" content="2022-10-20T01:03:09.479Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320161207313.png">
  
  
  
  <title>Viewç›¸å…³ - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Viewç›¸å…³"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-08 14:44" pubdate>
          August 8, 2022 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          65k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          545 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Viewç›¸å…³</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="è‡ªå®šä¹‰Viewä¸åŠ¨ç”»"><a href="#è‡ªå®šä¹‰Viewä¸åŠ¨ç”»" class="headerlink" title="è‡ªå®šä¹‰Viewä¸åŠ¨ç”»"></a>è‡ªå®šä¹‰Viewä¸åŠ¨ç”»</h1><h2 id="ä¸€ã€è‡ªå®šä¹‰View"><a href="#ä¸€ã€è‡ªå®šä¹‰View" class="headerlink" title="ä¸€ã€è‡ªå®šä¹‰View"></a>ä¸€ã€è‡ªå®šä¹‰View</h2><h3 id="1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ"><a href="#1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ"></a>1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ</h3><blockquote>
<p>ä¸€å¥è¯ï¼šå®˜æ–¹çš„æ§ä»¶æ»¡è¶³ä¸äº†äº§å“æƒ³è¦çš„æ•ˆæœ (</p>
<p>ä½†å…¶å®ï¼Œå®˜æ–¹æ§ä»¶å·²ç»èƒ½æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹è‡ªå®šä¹‰ View æ˜¯ä¸‹ä¸‹ç­–ï¼Œå› ä¸ºé€ è‡ªå®šä¹‰ View çš„è½®å­æ˜¯ä¸€ä»¶å¾ˆè€—æ—¶ä¹Ÿå¾ˆè€—ç²¾åŠ›çš„äº‹ã€‚</p>
<p>è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘å¤§ä¸€æš‘å‡æ—¶é‡åˆ°çš„äº‹æƒ…ï¼Œå½“æ—¶å…± 5 ä¸ªç»„åˆ†å¼€åšç§¯åˆ†å•†åŸï¼Œäº§å“ç»™äº†ä¸€ä¸ªç§¯åˆ†å•†åŸçš„è®¾è®¡å›¾ï¼Œå…¶ä¸­ä¸»é¡µæœ‰ä¸€ä¸ªä¸Šæ»‘å±•å¼€çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ç»„ï¼ˆæˆ‘å’Œé’Ÿæ™ºï¼‰ï¼Œæˆ‘å°±è´Ÿè´£åšè¿™ä¸ªä¸Šæ»‘çš„ç•Œé¢ã€‚å½“æ—¶æˆ‘èŠ±äº†å¥½åƒ 3ã€4 å¤©çš„æ—¶é—´å»è®¾è®¡ä¸€ä¸ªè‡ªå®šä¹‰ Viewï¼ˆåŸè°…æˆ‘å½“æ—¶è¿˜ä¸çŸ¥é“åè°ƒè€…å¸ƒå±€è¿™ä¸ªä¸œè¥¿ï¼‰ï¼Œç»“æœå•Šï¼Œäº§å“æ”¹éœ€æ±‚äº†ï¼Œé </p>
<p>ç»è¿‡ä¸Šé¢çš„è¿™ä¸ªæ•…äº‹åï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥ç†è§£åˆ°äº†é€‰æ‹©è‡ªå®šä¹‰ View ä¼šé¢ä¸´çš„é£é™©</p>
<p>åæ¥æˆ‘åˆèŠ±äº†æ¥è¿‘ä¸€å‘¨çš„æ—¶é—´è¿˜æ˜¯ç”¨è‡ªå®šä¹‰ View å†™å‡ºäº†äº§å“çš„æ–°éœ€æ±‚ï¼Œé™äºå½“æ—¶æˆ‘çš„èƒ½åŠ›ï¼Œç°åœ¨å»çœ‹å½“æ—¶å†™çš„ä»£ç ï¼Œå­˜åœ¨ä¸€äº›è€¦åˆçš„åœ°æ–¹ï¼Œç®—æ˜¯ç»™ä»¥åå­¦å¼Ÿç•™å‘äº†ğŸ˜</p>
<p>OKï¼Œå›åˆ°è¿™é‡Œï¼Œè‡ªå®šä¹‰ View ç¡®å®æ˜¯ä¸‹ä¸‹ç­–ï¼Œä¸æ­¢ä¼šå½±å“ä½ çš„å¿ƒæƒ…ï¼Œå¦‚æœä½ çš„ä»£ç è®¾è®¡å¾—ä¸å¥½çš„è¯ï¼ˆæ¯”å¦‚è€¦åˆåº¦å¾ˆé«˜ï¼Œä»£ç é€»è¾‘æ··ä¹±ï¼‰ï¼Œè¿˜ä¼šå½±å“ä»¥åç»´æŠ¤ä»£ç äººçš„å¿ƒæƒ…ã€‚ï¼ˆè¯´ä¸ªç¬‘è¯ï¼šå¬è¯´ä»£ç å†™å¾—è¶Šçƒ‚ï¼Œè¶Šä¸å®¹æ˜“è¢«è¾é€€ :ï¼‰</p>
</blockquote>
<h3 id="2ã€åˆ†ç±»"><a href="#2ã€åˆ†ç±»" class="headerlink" title="2ã€åˆ†ç±»"></a>2ã€åˆ†ç±»</h3><blockquote>
<p>è¿™é‡Œè‡ªå®šä¹‰ View æ˜¯ä¸€ä¸ªä¹ æƒ¯æ€§çš„ç»Ÿç§°</p>
<p>å¦‚æœæŒ‰ç…§ç±»å‹æ¥åˆ†ï¼š</p>
<ul>
<li><p>è‡ªå®šä¹‰ View</p>
<blockquote>
<p>æŒ‡ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿äº View çš„æ§ä»¶ï¼Œå¦‚ï¼šTextViewã€Button</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TextView</span> &#123;&#125;<br></code></pre></td></tr></table></figure>


</blockquote>
</li>
<li><p>è‡ªå®šä¹‰ ViewGroup</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearLayout</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ViewGroup</span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameLayout</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ViewGroup</span> &#123;&#125;<br></code></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<p>å¦‚æœæŒ‰ç…§å­¦ä¹ çš„å†…å®¹æ¥åˆ†ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å†…å®¹</p>
<ul>
<li><p>View çš„æµ‹é‡ä¸å¸ƒå±€</p>
<blockquote>
<p>æµ‹é‡å°±æ˜¯ä¸ Measure ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š<code>onMeasure()</code></p>
<p>å¸ƒå±€å°±æ˜¯ä¸ Layout ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š<code>onLayout()</code></p>
<p>è¿™ä¸¤ä¸ªä¸€èˆ¬æ˜¯åœ¨ä¸€èµ·è°ƒç”¨çš„ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯åœ¨ è‡ªå®šä¹‰ ViewGroup ä¸­æ‰ä¼šæ¶‰åŠåˆ°ï¼ˆView ä¸­ä¹Ÿå¯ä»¥å®ç°ï¼Œæ¯”å¦‚ TextView å°±é‡å†™äº† <code>onLayout()</code> æ–¹æ³•ï¼‰</p>
</blockquote>
</li>
<li><p>View çš„ç»˜åˆ¶</p>
<blockquote>
<p>ç»˜åˆ¶å°±æ˜¯ä¸ Draw ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š<code>onDraw()</code></p>
<p>ä¸ºä»€ä¹ˆè¦åˆ—å‡ºç»˜åˆ¶ï¼Ÿ</p>
<p>å› ä¸ºå¾ˆå¤šåŠ¨ç”»éƒ½æ˜¯ä¾é é‡å†™ç»˜åˆ¶æ¥å®ç°çš„ï¼Œæ‰€ä»¥ç»˜åˆ¶ä¹Ÿæ¯”è¾ƒé‡è¦</p>
</blockquote>
</li>
<li><p>äº‹ä»¶åˆ†å‘</p>
<blockquote>
<p>ä¸€èˆ¬æŒ‡è§¦æ‘¸äº‹ä»¶çš„åˆ†å‘</p>
<p>è¿™ä¸ªåº”è¯¥æ˜¯è‡ªå®šä¹‰ View ä¸­æœ€éš¾ä¹Ÿæœ€é‡è¦çš„å†…å®¹äº†ï¼Œå¦‚æœä½ æƒ³è®¾è®¡å‡ºä¸€äº›å¾ˆç‚«é…·çš„ç•Œé¢ï¼Œå°±å¾—ç²¾é€šäº‹ä»¶åˆ†å‘</p>
<p>äº‹ä»¶åˆ†å‘ä¼šåœ¨ä¸‹ä¸‹èŠ‚è¯¾è®²è§£</p>
</blockquote>
</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¼å¼€å§‹è®²è§£è‡ªå®šä¹‰ View çš„æ—¶é—´ï¼Œç”±äºæ—¶é—´åŸå› ï¼Œåœ¨åŠ ä¸Šä½ ä»¬çš„ç°é˜¶æ®µèƒ½åŠ›çš„åŸå› ï¼Œæœ¬èŠ‚è¯¾æ›´åå‘äºè®²è§£å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰ Viewï¼Œè€Œä¸æ˜¯è®²è§£åº•å±‚å†…å®¹ï¼Œåº•å±‚å†…å®¹ä»¥åšå®¢çš„å½¢å¼åˆ†äº«</p>
</blockquote>
<h3 id="3ã€æ„é€ å‡½æ•°"><a href="#3ã€æ„é€ å‡½æ•°" class="headerlink" title="3ã€æ„é€ å‡½æ•°"></a>3ã€æ„é€ å‡½æ•°</h3><blockquote>
<p>è¯¥éƒ¨åˆ†å†…å®¹å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/angeldevil/p/3479431.html#three">https://www.cnblogs.com/angeldevil/p/3479431.html#three</a></p>
<p>View ä¸€å…±æœ‰å››ä¸ªæ„é€ å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">View</span> &#123;<br><span class="hljs-comment">// è¿™ä¸ªç”¨äºåœ¨ä»£ç ä¸­ç›´æ¥ new ä¸€ä¸ª Viewï¼Œè¿™ä¸ª context ä¸€èˆ¬éƒ½æ˜¯ activityï¼Œä»£è¡¨ä¸Šä¸‹æ–‡</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(Context context)</span><br><br><span class="hljs-comment">// è¿™ä¸ªç”¨äºåœ¨ xml ä¸­ä¹¦å†™ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†ä½ å†™åœ¨ xml ä¸­çš„å±æ€§è£…æ¢ä¸ºä¸€ä¸ª AttributeSet å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs</span><br><span class="hljs-params">)</span><br><br><span class="hljs-comment">// è¿™ä¸ªä¸€èˆ¬ç”¨äºè®¾ç½®é»˜è®¤å±æ€§ï¼Œä½¿ç”¨çš„æƒ…å†µè¾ƒå°‘</span><br><span class="hljs-comment">// ç³»ç»Ÿä¸ä¼šä¸»åŠ¨è°ƒç”¨ï¼Œä¸€èˆ¬æ˜¯å¼€å‘è€…è‡ªå·±è®¾ç½®</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleAttr</span><br><span class="hljs-params">)</span><br><br><span class="hljs-comment">// è¿™ä¸ªä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è®¾ç½®é»˜è®¤å±æ€§ï¼Œä½¿ç”¨çš„æƒ…å†µä¹Ÿè¾ƒå°‘ï¼Œä¸”åªæ”¯æŒ Android 5.0 ä»¥ä¸Š</span><br><span class="hljs-comment">// ç³»ç»Ÿä¸ä¼šä¸»åŠ¨è°ƒç”¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleAttr, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleRes</span><br><span class="hljs-params">)</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>å‰é¢ä¸¤ä¸ªæ„é€ å‡½æ•°å„ä½åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ï¼Œå…³é”®åœ¨äºåé¢ä¸¤ä¸ªï¼Œä»–ä»¬ä¸è®¾ç½®é»˜è®¤å±æ€§ç›¸å…³ï¼Œåœ¨è®²è§£å‰æˆ‘ä»¬å…ˆå¾—çŸ¥é“ä¸€ä¸ª View å¯ä»¥é€šè¿‡å“ªäº›æ–¹å¼è®¾ç½®å±æ€§</p>
</blockquote>
<h4 id="1ã€ç›´æ¥å†™åœ¨-XML-ä¸­"><a href="#1ã€ç›´æ¥å†™åœ¨-XML-ä¸­" class="headerlink" title="1ã€ç›´æ¥å†™åœ¨ XML ä¸­"></a>1ã€ç›´æ¥å†™åœ¨ XML ä¸­</h4><blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">androidx.cardview.widget.CardView</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">app:cardBackgroundColor</span>=<span class="hljs-string">&quot;@android:color/darker_gray&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">app:cardCornerRadius</span>=<span class="hljs-string">&quot;8dp&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šç»™å½“å‰ View è®¾ç½®å±æ€§</p>
<p>åŸç†æ˜¯ç³»ç»Ÿè‡ªåŠ¨æŠŠè¿™äº›å±æ€§å†™å…¥åˆ° AttributeSet ç±»é‡Œé¢ï¼Œç„¶åè°ƒç”¨</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> View(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)<br></code></pre></td></tr></table></figure>

<p>æ¥ç”Ÿæˆ View å¯¹è±¡</p>
</blockquote>
<h4 id="2ã€ä½¿ç”¨-style-è®¾ç½®å±æ€§"><a href="#2ã€ä½¿ç”¨-style-è®¾ç½®å±æ€§" class="headerlink" title="2ã€ä½¿ç”¨ @style è®¾ç½®å±æ€§"></a>2ã€ä½¿ç”¨ @style è®¾ç½®å±æ€§</h4><blockquote>
<p>åœ¨ <code>style.xml</code> ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myCardView_style&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cardBackgroundColor&quot;</span>&gt;</span>@android:color/darker_gray<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cardCornerRadius&quot;</span>&gt;</span>8dp<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>åœ¨ <code>layout.xml</code> ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">androidx.cardview.widget.CardView</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;@style/myCardView_style&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¸€èˆ¬ç”¨äºå¤šä¸ªç›¸åŒæ§ä»¶å¤ç”¨å±æ€§çš„æ—¶å€™</p>
<p>åŸç†ä¸ä¸Šä¸€ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œå®ƒä¼šæŠŠ <code>style=&quot;@style/MyCardView&quot;</code> é‡Œå†™çš„å±æ€§ä¸€èµ·å†™å…¥ AttributeSet ç±»é‡Œé¢</p>
<blockquote>
<p>é—®é¢˜ï¼šå¦‚æœ <code>style=&quot;@style/MyCardView&quot;</code> ä¸ xml ä¸­æœ‰ç›¸åŒå±æ€§å®ƒä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>ç»è¿‡æµ‹è¯•åï¼Œxml ä¸­å®šä¹‰çš„å±æ€§ä¼šè¦†ç›– <code>style=&quot;@style/MyCardView&quot;</code> ä¸­å®šä¹‰çš„å±æ€§</p>
</blockquote>
</blockquote>
<h4 id="3ã€åœ¨-theme-ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§"><a href="#3ã€åœ¨-theme-ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§" class="headerlink" title="3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§"></a>3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§</h4><blockquote>
<p>åœ¨ <code>theme.xml</code> ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MyAppTheme&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.MaterialComponents&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml"> <span class="hljs-comment">&lt;!--ä¸‹é¢è¿™ä¸ª @style/MyCardView å°±æ˜¯å‰é¢å†™çš„ &lt;style name=&quot;MyCardView&quot;&gt;--&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cardViewStyle&quot;</span>&gt;</span>@style/myCardView_style<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œ <code>name=&quot;cardViewStyle&quot;</code> æ„æ€æ˜¯å®šä¹‰ CardView çš„é»˜è®¤å±æ€§<br>è¿™ä¸ªé»˜è®¤å±æ€§æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŸå› åœ¨äº CardView çš„æ„é€ å‡½æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">CardView</span><span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-meta">@NonNull</span> Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs</span><br><span class="hljs-params">)</span> &#123;<br><span class="hljs-built_in">this</span>(context, attrs, R.attr.cardViewStyle);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">CardView</span><span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-meta">@NonNull</span> Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleAttr</span><br><span class="hljs-params">)</span> &#123;<br><span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ä½¿ç”¨äº† <code>this(context, attrs, R.attr.cardViewStyle)</code> è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­ä»–ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥äº†ä¸€ä¸ªå€¼ <code>R.attr.cardViewStyle</code>ï¼Œæˆ‘ä»¬å»æ‰’å®ƒæºç ï¼Œçœ‹ä¸‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ˆç›´æ¥ç‚¹å‡»å¯¼åŒ…ä¸­çš„ <code>import androidx.cardview.R</code> å°±å¯ä»¥è·³åˆ°æºç ä¸­ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;reference&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cardViewStyle&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯èƒ½ä½ ä»¬ä¼šçœ‹ä¸æ‡‚ï¼Œæˆ‘ç®€å•è®²ä¸€ä¸‹ï¼šè¿™ä¸ª <code>format=&quot;reference&quot;</code> ä»£è¡¨è¿™ä¸ªå±æ€§æ¥å—çš„ç±»å‹ï¼Œè€Œ <code>reference</code> è¡¨ç¤ºæ¥å—çš„ç±»å‹ä¸ºä¸€ä¸ªå¼•ç”¨å€¼ï¼Œæ¯”å¦‚ï¼š<code>@style/xxx</code>ã€<code>@color/xxx</code>ã€<code>@drawable/xxx</code> å°±æ˜¯å¼•ç”¨å€¼</p>
<p>ç„¶å <code>name=&quot;cardViewStyle&quot;</code> ä»£è¡¨è¿™ä¸ªå±æ€§çš„å”¯ä¸€åå­—</p>
<p>è¿™ä¸ª attr çš„å¼•ç”¨å°±æ˜¯ CardView å¯ä»¥åœ¨ theme ä¸­è®¾ç½®é»˜è®¤å±æ€§çš„åŸå› ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨ CardView ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç„¶åå®ƒè¿™ä¸ªæ„é€ å‡½æ•°ä¸»åŠ¨è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥äº† <code>R.attr.cardViewStyle</code>ï¼Œæ‰€ä»¥æ„é€ å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯ä¸€ä¸ª<code>style</code> æ ¼å¼çš„å¼•ç”¨ï¼Œä½†éœ€è¦ä½ è‡ªå·±åœ¨ View ä¸­æŒ‡å®šåå­—</p>
<p>å¼•ç”¨ <code>theme.xml</code> æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li><p>å…¨å±€å¼•ç”¨ï¼Œæ‰€æœ‰ View éƒ½ä¼šä½¿ç”¨è¯¥é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/MyAppTheme&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>æŸä¸ª Activity å¼•ç”¨ï¼Œå½“å‰ Activity å†…ä½¿ç”¨è¯¥é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.section3.test.TestActivity&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/MyAppTheme&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>æŸä¸ª Activity ä½¿ç”¨ä»£ç å¼•ç”¨</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>    setTheme(R.style.MyAppTheme)<br>    setContentView(R.layout.layout_card0)<br>&#125;<br><span class="hljs-comment">// æ³¨æ„åœ¨ Activity ä¸­ä½¿ç”¨å¿…é¡»åœ¨ setContentView ä¹‹å‰</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>å•ä¸ª View ä½¿ç”¨</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">androidx.cardview.widget.CardView</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;200dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/MyAppTheme&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½æœ‰ç‚¹æ™•ï¼Œæˆ‘ä»¬ç®€å•æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼š</p>
<pre><code class=" mermaid">graph TB
id1(&quot;ç³»ç»Ÿè¯»å–ä½ å†™çš„ xml&quot;)--&gt;id2
id2[&quot;ç”Ÿæˆ AttributeSetï¼Œç„¶åè°ƒç”¨ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°&quot;]--&gt;id3
id3[&quot;ä¸¤ä¸ªå‚æ•°çš„è°ƒç”¨ä¸‰ä¸ªå‚æ•°çš„ï¼Œå¹¶ä¼ å…¥ R.attr.cardViewStyle&quot;]--&gt;id4
id4[&quot;View å¼€å§‹ä» theme ä¸­è¯»å–å±æ€§&quot;]--&gt;id5
id5[&quot;View åœ¨ theme ä¸­å‘ç° name=cardViewStyle&gt;xxxx&lt; çš„å®šä¹‰&quot;]--&gt;id6
id6(&quot;è¯»å– @style/MyCardView é‡Œé¢çš„å±æ€§&quot;)
</code></pre>


</blockquote>
<h4 id="4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„-defStyleRes"><a href="#4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„-defStyleRes" class="headerlink" title="4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„ defStyleRes"></a>4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„ defStyleRes</h4><blockquote>
<p>ç”±äº CardView æ²¡æœ‰é‡å†™ç¬¬å››ä¸ªæ„é€ å‡½æ•°ï¼ˆå¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹ Android 5.0 ä»¥ä¸‹ï¼Ÿï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ç”¨ FrameLayout æ¥æ¼”ç¤º</p>
<p>å…ˆåœ¨ <code>style.xml</code> ä¸­å®šä¹‰å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myFrameLayout&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:layout_width&quot;</span>&gt;</span>match_parent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:layout_height&quot;</span>&gt;</span>match_parent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:background&quot;</span>&gt;</span>@android:color/black<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ä»£ç ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> frameLayout = FrameLayout(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, R.style.myFrameLayout_style)<br></code></pre></td></tr></table></figure>

<p>å½“ä½ ä¸èƒ½åœ¨ xml ä¸­ç”³æ˜ï¼Œåªèƒ½åœ¨ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§å†™æ³•ï¼Œæœ‰ä¸ªä¼˜ç‚¹å°±æ˜¯ä½¿ç”¨ <code>style.xml</code> å¯ä»¥è¿›è¡Œå±æ€§çš„å¤ç”¨ï¼Œä½†ä¸€èˆ¬éƒ½ç”¨ä¸åˆ°å¤ç”¨ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ LayoutParams å’Œè°ƒç”¨å¯¹åº”æ–¹æ³•æ¥ä»£æ›¿ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> frameLayout = FrameLayout(<span class="hljs-keyword">this</span>)<br><span class="hljs-comment">// Android ç¬¬ä¸€èŠ‚è¯¾æˆ‘ä»¬è®²è¿‡ï¼Œçˆ¶å¸ƒå±€å¯ä»¥ç»™å­å¸ƒå±€è®¾ç½®å±æ€§</span><br><span class="hljs-comment">// ä¸”å±æ€§éƒ½ä»¥ layout_ å¼€å¤´ï¼Œæ‰€ä»¥ layout_width å’Œ layout_height </span><br><span class="hljs-comment">// å¯¹åº”ç”± LayoutParams æ¥è®¾ç½®</span><br>frameLayout.layoutParams = ViewGroup.LayoutParams(<br> ViewGroup.LayoutParams.MATCH_PARENT,<br> ViewGroup.LayoutParams.MATCH_PARENT<br>)<br><span class="hljs-comment">// background å±äº View è‡ªèº«å±æ€§ï¼Œæ‰€ä»¥å¯¹åº” View è‡ªèº«æ–¹æ³•</span><br>frameLayout.setBackgroundColor(Color.BLACK)<br><br><span class="hljs-comment">// ä½†è¿™æ ·å†™æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼šLayoutParams è¿™ä¸œè¥¿åªèƒ½è®¾ç½®å°‘é‡çš„å±æ€§ï¼Œ</span><br><span class="hljs-comment">// è€Œä¸” LayoutParams æœ‰å¾ˆå¤šä¸ªï¼Œå…·ä½“é€‰æ‹©é‚£ä¸ªéœ€è¦çœ‹ä½ çš„ View è¢«æ·»åŠ åˆ°</span><br><span class="hljs-comment">// å“ªç§çˆ¶å¸ƒå±€é‡Œï¼Œå¦‚æœæ˜¯ LinearLayoutï¼Œå°±æ˜¯ LinearLayout.LayoutParams(...)</span><br></code></pre></td></tr></table></figure>

<p>å¯èƒ½æœ‰äººä¸çŸ¥é“ LayoutParams æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä½ æš‚æ—¶å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ç”¨æ¥ä¿å­˜ View ä¸­æœ‰å…³<strong>çˆ¶å¸ƒå±€å±æ€§</strong>çš„ä¸€ä¸ªæ•°æ®ç±»ï¼Œä¾›çˆ¶å¸ƒå±€ä½¿ç”¨ï¼Œåé¢ä¼šå†æ¬¡è®²è§£</p>
<p>é™¤äº†ä¸Šé¢è¿™ç§åŠ¨æ€ç”Ÿæˆæ—¶ä¼ å…¥é»˜è®¤å±æ€§ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ„é€ å™¨ä¸­è®¾ç½®ä½ çš„è‡ªå®šä¹‰ View çš„é»˜è®¤å±æ€§ï¼š</p>
<p>ä¸€èˆ¬æ˜¯è¿™æ ·å®šä¹‰æ„é€ å™¨çš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// ç”±äº java æ˜¯åŸºç¡€ï¼Œæˆ‘å…ˆç”¨ java æ¥å®šä¹‰æ„é€ å™¨ï¼Œåé¢å†ä½¿ç”¨ kt æ¥ä¼˜åŒ–å†™æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Section3View</span> <span class="hljs-title">extends</span> <span class="hljs-title">View</span> &#123;<br> <span class="hljs-keyword">public</span> Section3View(Context context) &#123;<br>     <span class="hljs-comment">// æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super</span><br>     <span class="hljs-keyword">this</span>(context, <span class="hljs-literal">null</span>);<br> &#125;<br><br> <span class="hljs-keyword">public</span> Section3View(<br>     Context context, <br>     <span class="hljs-meta">@Nullable</span> AttributeSet attrs<br> ) &#123;<br>     <span class="hljs-comment">// æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super</span><br>     <span class="hljs-keyword">this</span>(context, attrs, R.attr.mySection3View_attrs);<br> &#125;<br><br> <span class="hljs-keyword">public</span> Section3View(<br>     Context context, <br>     <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <br>     int defStyleAttr<br> ) &#123;<br>     <span class="hljs-comment">// æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super</span><br>     <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯è®¾ç½®é»˜è®¤å±æ€§</span><br>     <span class="hljs-keyword">this</span>(<br>         context, <br>         attrs, <br>         defStyleAttr, <br>         R.style.mySection3View_defaultAttrs<br>     );<br> &#125;<br><br> <span class="hljs-keyword">public</span> Section3View(<br>     Context context, <br>     <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <br>     int defStyleAttr, <br>     int defStyleRes<br> ) &#123;<br>     <span class="hljs-comment">// ç›´åˆ°è¿™é‡Œæ‰è°ƒç”¨ super</span><br>     <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>R.attr.mySection3View_attrs</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--value/attrs.xml--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mySection3View_attrs&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;reference&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>R.style.mySection3View_defaultAttrs</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--value/style.xml--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mySection3View_defaultAttrs&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:background&quot;</span>&gt;</span>@android:color/black<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>å¦‚æœä½ å»å¯¹ç…§å®˜æ–¹æ§ä»¶çš„å†™æ³•ï¼Œä½ ä¼šå‘ç°ä»–ä»¬çš„æ„é€ å‡½æ•°ä¹Ÿæ˜¯è¿™æ ·å†™çš„ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯è°ƒç”¨ <code>this()</code>ï¼Œåªæœ‰æœ€åä¸€ä¸ªè°ƒç”¨   <code>super()</code>ï¼Œä½†ä»–ä»¬ä¸€èˆ¬åªè®¾ç½®äº† <code>R.attr.mySection3View_attrs</code>ï¼Œç”¨äºå¼€å‘è€…åœ¨ theme ä¸­å®šä¹‰å…¨å±€å±æ€§ï¼ˆ[ç¬¬ä¸‰ç‚¹](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§)ï¼‰ï¼Œè€Œ <code>R.style.mySection3View_defaultAttrs</code> åœ¨å®˜ç½‘æ§ä»¶ä¸­ä¸€èˆ¬æ²¡è®¾ç½®ï¼Œéƒ½æ˜¯å†™ä¸ª 0ï¼Œä»£è¡¨æ²¡å¾—é»˜è®¤å±æ€§</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªé»˜è®¤å±æ€§ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">Context context, </span><br><span class="hljs-params"><span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleAttr, </span><br><span class="hljs-params"><span class="hljs-type">int</span> defStyleRes</span><br><span class="hljs-params">)</span><br></code></pre></td></tr></table></figure>

<p>ä½ ä¼šå‘ç°ç¬¬ä¸‰ä¸ªå‚æ•° <code>defStyleAttr</code> å’Œç¬¬å››ä¸ª <code>defStyleRes</code> éƒ½æ˜¯è®¾ç½®é»˜è®¤å‚æ•°ï¼Œä½†ä¸ºä»€ä¹ˆè¦åŒæ—¶å­˜åœ¨ä¸¤ä¸ªå‘¢ï¼Ÿ</p>
<p>åŸå› ï¼š<code>defStyleAttr</code> æ˜¯ä» theme ä¸­è¯»å–é»˜è®¤å€¼ï¼Œä½†å¦‚æœæˆ‘ä»¬åªèƒ½åŠ¨æ€ç”Ÿæˆ Viewï¼Œåˆéœ€è¦å¤šæ¬¡ç”¨åˆ°ä¸€äº›å±æ€§ï¼Œåœ¨ Android 5.0 ä¹‹å‰è¦ä¹ˆæ¯æ¬¡éƒ½æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æ¥è®¾ç½®ï¼Œè¦ä¹ˆå†™åœ¨ theme ä¸­ï¼Œä½†è¿™æ ·æœªå…éº»çƒ¦äº†äº›ï¼Œåœ¨ Android 5.0 åå¢åŠ äº†è¿™ä¸ª <code>defStyleRes</code> å‚æ•°ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠå±æ€§å†™åœ¨ <code>style.xml</code> ä¸­ï¼Œæ–¹ä¾¿å¤ç”¨</p>
<p><strong>ä½†è¿™é‡Œæœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼š</strong>ä½¿ç”¨ <code>defStyleRes</code> æ—¶ä¸èƒ½è®¾ç½® <code>defStyleAttr</code>ï¼Œç»™ <code>defStyleAttr</code> å¡«å…¥ 0 æˆ–è€… theme ä¸­ä¸è®¾ç½®å¯¹åº”çš„å±æ€§å³å¯</p>
</blockquote>
<p>å›åˆ°è¿™é‡Œï¼Œå‰é¢ java çš„å†™æ³•ç¡®å®æ„Ÿè§‰æœ‰äº›è‡ƒè‚¿äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ kt çš„å†™æ³•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// å¿…é¡»æ·»åŠ  @JvmOverloadsï¼Œä¸ç„¶ java å±‚æ— æ³•ä½¿ç”¨è¯¥æ„é€ å™¨</span><br><span class="hljs-comment">// ä¼šå¯¼è‡´ xml ä¸­çš„ View æ— æ³•ç”Ÿæˆ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Section3ViewKt</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span>(<br>    context: Context,<br>    attrs: AttributeSet? = <span class="hljs-literal">null</span>,<br>    defStyleAttr: <span class="hljs-built_in">Int</span> = R.attr.mySection3View_attrs,<br>    defStyleRes: <span class="hljs-built_in">Int</span> = R.style.mySection3View_defaultAttrs<br>) : View(context, attrs, defStyleAttr, defStyleRes) &#123;<br>&#125;<br><span class="hljs-comment">// å¦‚æœä½ æ²¡å¾— R.attr.mySection3View æˆ– R.style.MySection3View_defaultAttrs</span><br><span class="hljs-comment">// å¯ä»¥ç›´æ¥èµ‹å€¼ä¸º 0ï¼Œå°±æ˜¯æ²¡å¾—é»˜è®¤å±æ€§è®¾ç½®</span><br></code></pre></td></tr></table></figure>

<p><strong>è®²åˆ°è¿™é‡Œï¼Œæ„é€ å‡½æ•°ä¸­çš„å››ä¸ªå‚æ•°å„ä½åº”è¯¥çŸ¥é“æœ‰ä»€ä¹ˆä½œç”¨äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(Context context)</span><br><span class="hljs-comment">// ç”¨äºåœ¨ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆè‡ªå®šä¹‰ View</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">    Context context, </span><br><span class="hljs-params">    <span class="hljs-meta">@Nullable</span> AttributeSet attrs</span><br><span class="hljs-params">)</span><br><span class="hljs-comment">// ç”¨äºå†™åœ¨ xml é‡Œé¢ç³»ç»Ÿè°ƒç”¨</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">    Context context,</span><br><span class="hljs-params">    <span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params">    <span class="hljs-type">int</span> defStyleAttr</span><br><span class="hljs-params">)</span><br><span class="hljs-comment">// ç”¨äºè®¾ç½®å…¨å±€é»˜è®¤å±æ€§å€¼ï¼Œé€šå¸¸æ˜¯é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥é—´æ¥è°ƒç”¨</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">View</span><span class="hljs-params">(</span><br><span class="hljs-params">    Context context, </span><br><span class="hljs-params">    <span class="hljs-meta">@Nullable</span> AttributeSet attrs, </span><br><span class="hljs-params">    <span class="hljs-type">int</span> defStyleAttr, </span><br><span class="hljs-params">    <span class="hljs-type">int</span> defStyleRes</span><br><span class="hljs-params">)</span><br><span class="hljs-comment">// ä¹Ÿæ˜¯ç”¨äºè®¾ç½®é»˜è®¤å±æ€§å€¼ï¼Œåªæ˜¯ä¸ç”¨å†™åœ¨ theme ä¸­ï¼Œé€šå¸¸ç”¨äºåŠ¨æ€ç”Ÿæˆä»£ç ä¸­æˆ–è‡ªå·±è‡ªå®šä¹‰ View çš„æ—¶å€™</span><br></code></pre></td></tr></table></figure>

<p>å‰é¢è®²äº† 4 ç§æ–¹å¼æ¥è®¾ç½®å±æ€§ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ä¹Ÿå¯ä»¥æ¥è®¾ç½®å±æ€§</p>
</blockquote>
<h4 id="5ã€ç›´æ¥åœ¨-theme-ä¸­å®šä¹‰å±æ€§"><a href="#5ã€ç›´æ¥åœ¨-theme-ä¸­å®šä¹‰å±æ€§" class="headerlink" title="5ã€ç›´æ¥åœ¨ theme ä¸­å®šä¹‰å±æ€§"></a>5ã€ç›´æ¥åœ¨ theme ä¸­å®šä¹‰å±æ€§</h4><blockquote>
<p>è¿™ä¸ªä¸ç¬¬ä¸‰ç‚¹ï¼š[åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§) æœ‰äº›ç±»ä¼¼ï¼Œä½†å®ƒå€¼å…è®¸ç›´æ¥å†™åœ¨ theme ä¸­</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span> <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Theme.CustomViewWithAnimStudy&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.MaterialComponents.DayNight.DarkActionBar&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-comment">&lt;!--å¦‚æœä½ åŠ äº†è¿™è¡Œä»£ç ï¼Œä½ ä¼šå‘ç°åº”ç”¨å¤§éƒ¨åˆ†æ§ä»¶å˜æˆé»‘è‰²äº†--&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:background&quot;</span>&gt;</span>@android:color/black<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯ï¼Œ</strong>è¿™ä¸ªæ˜¯ä¸åˆ†æ§ä»¶çš„ç»™å…¨éƒ¨ View è®¾ç½®å±æ€§ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨åˆ°å®ƒï¼Œåªæœ‰è®¾ç½®æ•´ä¸ªåº”ç”¨çš„ä¸»é¢˜æ—¶ä¼šç”¨åˆ°</p>
<p>æ¯”å¦‚ä½ å¯ä»¥è¯•è¯•æŠŠè¿™å‡ ä¸ªå±æ€§æ”¹ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°åº”ç”¨çš„æ ‡é¢˜æ é¢œè‰²ä»ç´«è‰²æ”¹æˆäº†ä½ è®¾ç½®çš„é¢œè‰²</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorPrimary&quot;</span>&gt;</span>@color/purple_500<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorPrimaryVariant&quot;</span>&gt;</span>@color/purple_700<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorOnPrimary&quot;</span>&gt;</span>@color/white<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorSecondary&quot;</span>&gt;</span>@color/teal_200<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorSecondaryVariant&quot;</span>&gt;</span>@color/teal_700<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;colorOnSecondary&quot;</span>&gt;</span>@color/black<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™äº›å±æ€§å¯¹åº”äº†æŸç§å…·ä½“ä½ç½®çš„é¢œè‰²ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡åšå®¢ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/smartzzg/article/details/104788412">https://blog.csdn.net/smartzzg/article/details/104788412</a></p>
<h3 id="äº”ç§å±æ€§å®šä¹‰æ–¹æ³•çš„é¡ºåº"><a href="#äº”ç§å±æ€§å®šä¹‰æ–¹æ³•çš„é¡ºåº" class="headerlink" title="äº”ç§å±æ€§å®šä¹‰æ–¹æ³•çš„é¡ºåº"></a>äº”ç§å±æ€§å®šä¹‰æ–¹æ³•çš„é¡ºåº</h3><blockquote>
<p>æˆ‘ä»¬è®²äº†æœ‰ 5 ç§ä¸åŒçš„å±æ€§å®šä¹‰ï¼Œå¦‚æœå®šä¹‰äº†ç›¸åŒå±æ€§ï¼Œä»–ä»¬å­˜åœ¨ä¸€ä¸ªä¼˜å…ˆçº§é¡ºåºï¼š</p>
<p>[1ã€ç›´æ¥å†™åœ¨ XML ä¸­](#1ã€ç›´æ¥å†™åœ¨ XML ä¸­)</p>
<p>[2ã€ä½¿ç”¨ @style è®¾ç½®å±æ€§](#2ã€ä½¿ç”¨ @style è®¾ç½®å±æ€§)</p>
<p>[3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æ§ä»¶çš„é»˜è®¤å±æ€§)</p>
<p>[4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„ defStyleRes](#4ã€è°ƒç”¨æ„é€ å‡½æ•°çš„ defStyleRes)</p>
<p>[5ã€ç›´æ¥åœ¨ theme ä¸­å®šä¹‰å±æ€§](#5ã€ç›´æ¥åœ¨ theme ä¸­å®šä¹‰å±æ€§)</p>
<p>è¿™é‡Œæ³¨æ„ï¼šä½¿ç”¨ <code>defStyleRes </code> æ—¶ä¸èƒ½è®¾ç½® <code>defStyleAttr</code>ï¼Œç»™ <code>defStyleAttr</code> å¡«å…¥ 0 æˆ–è€… theme ä¸­ä¸è®¾ç½®å¯¹åº”çš„å±æ€§å³å¯</p>
</blockquote>
<p><strong>åˆ°è¿™é‡Œ View çš„å››ä¸ªæ„é€ å‡½æ•°åŸºæœ¬åˆ†æå®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®²è§£é‡Œé¢çš„æ–¹æ³•</strong></p>
</blockquote>
<h3 id="4ã€onDraw"><a href="#4ã€onDraw" class="headerlink" title="4ã€onDraw()"></a>4ã€onDraw()</h3><blockquote>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>å¯¹ View è¿›è¡Œç»˜åˆ¶</p>
<h3 id="æ¶‰åŠå†…å®¹"><a href="#æ¶‰åŠå†…å®¹" class="headerlink" title="æ¶‰åŠå†…å®¹"></a>æ¶‰åŠå†…å®¹</h3><ul>
<li>[Canvas ç”»å¸ƒ](#1ã€Canvas ç”»å¸ƒ)</li>
<li>[Paint ç”»ç¬”](#2ã€Paint ç”»ç¬”)</li>
<li>[Path è·¯å¾„](#3ã€Path è·¯å¾„)</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªå›è°ƒï¼Œä¸ºä»€ä¹ˆæ˜¯å›è°ƒï¼Œåœ¨ä¹‹åçš„ invalidate() ä¼šè¿›è¡Œè®²è§£</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>?)</span></span> &#123;<br><span class="hljs-keyword">super</span>.onDraw(canvas)<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œè®²ä¸€ä¸ªå°æŠ€å·§ï¼šå¯ä»¥æŠŠ <code>Canvas?</code> ä¸­çš„ <code>?</code> ä¸ºå»æ‰</p>
<p>å› ä¸ºåœ¨ kt é‡å†™ <code>onDraw()</code> æ–¹æ³•æ—¶ï¼Œæºä»£ç  java å±‚ä¸­å¹¶æ²¡æœ‰ç»™å‚æ•° <code>canvas</code> åŠ ä¸Š <code>@NonNull</code>ï¼Œå¯¼è‡´ kt ä¸çŸ¥é“å®ƒä¼šä¸ä¼šä¸ºç©ºï¼Œä½†æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è‚¯å®šæ˜¯çŸ¥é“å®ƒä¸ä¼šä¸ºç©ºçš„ï¼Œæ‰€ä»¥å»æ‰ <code>?</code>ï¼Œå¯ä»¥å‡å°‘åç»­çš„åˆ¤æ–­ï¼Œä¸ç„¶å¾ˆå¯èƒ½å†™å‡ºè¿™æ ·çš„ä»£ç </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>?)</span></span> &#123;<br>    <span class="hljs-keyword">super</span>.onDraw(canvas)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>    canvas?.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>çœ‹ç€å¥½åƒæ²¡å¾—ä»€ä¹ˆé—®é¢˜ï¼Œä¸å°±å¤šæ‰“äº†ä¸€ä¸ª <code>?</code> å—ï¼Ÿ</p>
<p>ç¡®å®çœ‹ç€æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†ä½ æŠŠ kt è½¬æˆ javaï¼Œä½ å°±ä¼šå‘ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Canvas canvas)</span> &#123;<br>   <span class="hljs-built_in">super</span>.onDraw(canvas);<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>   <span class="hljs-keyword">if</span> (canvas != <span class="hljs-literal">null</span>) &#123;<br>      canvas.drawRect(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">100.0F</span>, <span class="hljs-number">200.0F</span>, <span class="hljs-built_in">this</span>.mBlackPaint);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¯ä¸ª canvas éƒ½å•ç‹¬åˆ¤æ–­äº†ä¸€éæ˜¯å¦ä¸ºç©ºï¼Œä¸çŸ¥é“ä½ ä»¬æ€ä¹ˆæƒ³ï¼Œä½†æˆ‘çš„å¼ºè¿«ç—‡ä¸å…è®¸å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å»ºè®®å„ä½å†™è‡ªå®šä¹‰ View æ—¶ï¼ŒæŠŠæ–¹æ³•å‚æ•°ä¸­å¯ä»¥å»æ‰ <code>?</code> çš„é¡ºæ‰‹ç»™å»æ‰</p>
<p>é™¤äº† <code>onDraw()</code> ä»¥å¤–ï¼Œè¿˜æœ‰ <code>override fun onTouchEvent(event: MotionEvent?)</code> çš„ <code>?</code> ä¹Ÿå¯ä»¥å»æ‰</p>
<blockquote>
<p>æ€ä¹ˆçœ‹ kt è½¬æˆçš„ java ä»£ç ï¼Ÿ</p>
 <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320161207313.png" srcset="/img/loading.gif" lazyload alt="image-20220320161207313" style="zoom:50%;" />

 <img src="C:/Users/%E9%83%AD%E7%A5%A5%E7%91%9E/AppData/Roaming/Typora/typora-user-images/image-20220320144121673.png" srcset="/img/loading.gif" lazyload alt="image-20220320144121673" style="zoom:50%;" />
</blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®²è§£ <code>onDraw()</code> éœ€è¦çš„å…¶ä»–çŸ¥è¯†</p>
</blockquote>
</blockquote>
<h4 id="1ã€Canvas-ç”»å¸ƒ"><a href="#1ã€Canvas-ç”»å¸ƒ" class="headerlink" title="1ã€Canvas ç”»å¸ƒ"></a>1ã€Canvas ç”»å¸ƒ</h4><blockquote>
<p>ç”±äºæ—¶é—´åŸå› ï¼Œè¿™é‡Œä¸ä¼šè®²å¾—å¾ˆè¯¦ç»†ï¼Œä½ ä»¬å¯ä»¥åœ¨è¿™äº›åœ°æ–¹è¿›è¡Œå­¦ä¹ ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://carsonho.blog.csdn.net/article/details/60598775">https://carsonho.blog.csdn.net/article/details/60598775</a></li>
<li><a target="_blank" rel="noopener" href="https://qijian.blog.csdn.net/article/details/50995268">https://qijian.blog.csdn.net/article/details/50995268</a></li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><em><strong>canvas</strong></em></td>
<td>Canvas</td>
<td>å­—é¢ç¿»è¯‘æ˜¯â€œå¸†å¸ƒâ€ï¼Œä½ å¯ä»¥çœ‹æˆæ˜¯ç³»ç»Ÿåº•å±‚ç»™äº†ä½ ä¸€å¼ â€œç”»å¸ƒâ€ï¼ˆcanvasï¼‰ï¼Œç„¶åä½ åœ¨è¿™å¼ ç”»å¸ƒä¸Šè¿›è¡Œç»˜å›¾</td>
</tr>
</tbody></table>
<p>é‚£æ€ä¹ˆè¿›è¡Œç”»å›¾å‘¢ï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™ä¸ª paint ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯â€œç”»ç¬”â€</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mBlackPaint = Paint().apply &#123;<br>color = Color.BLACK <span class="hljs-comment">// è®¾ç½®ç”»ç¬”é¢œè‰²ä¸ºé»‘è‰²</span><br>&#125;<br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> &#123;<br><span class="hljs-keyword">super</span>.onDraw(canvas)<br><span class="hljs-comment">// ç”»ä¸€ä¸ª (0, 0) - (100, 200) çš„é»‘è‰²çŸ©å½¢</span><br>canvas.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚ä¸Šé¢ä»£ç ï¼Œè°ƒç”¨ <code>canvas.drawRect()</code> å°±å¯ä»¥ç”»ä¸€ä¸ªé»‘è‰²çŸ©å½¢åœ¨ View é‡Œé¢</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png" srcset="/img/loading.gif" lazyload alt="image-20220320144833039" style="zoom:50%;float:left" />

<p>å¦‚æœä½ æ²¡æœ‰è‡ªå®šä¹‰ View åŸºç¡€çš„è¯ï¼Œå¯èƒ½ä¼šè§‰å¾—æœ‰äº›å¥‡æ€ª</p>
<p>æˆ‘ä»¬ä»å°å­¦å¼€å§‹å­¦çš„åæ ‡ç³»ç¬¬ä¸€è±¡é™ä¸æ˜¯å‘ä¸Šä¸º Y æ­£åŠè½´ï¼Œå‘å³ä¸º X æ­£åŠè½´ï¼Œé‚£ä¹ˆæŒ‰ç…§æƒ¯æ€§æ€ç»´ï¼Œ(0, 0) - (100, 200) ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‹å›¾è¿™æ ·çš„ï¼Ÿ</p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png" srcset="/img/loading.gif" lazyload alt="image-20220320144833039" style="zoom:50%;transform:rotateX(180deg);float:left" />

<p>å…¶å®åŸå› åœ¨äº View ä¸­åæ ‡ç³»çš„ y è½´æ˜¯åè¿‡æ¥çš„ï¼Œæˆ‘çŒœæµ‹æ˜¯å› ä¸ºï¼šä¸ºäº†è®¾é…æ‰‹æœºçš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€äº›åˆ—è¡¨ï¼Œéƒ½æ˜¯æ‰‹æŒ‡å¾€ä¸Šæ»‘åŠ¨ï¼ŒæŸ¥çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸ºäº†å¥½å¼€å‘ï¼ŒView ä¸­çš„åæ ‡åŸç‚¹å°±è®¾ç½®åœ¨äº†å·¦ä¸Šè§’ï¼Œå‘ä¸‹ä¸º Y æ­£åŠè½´ï¼Œå‘å³ä¸º X æ­£åŠè½´</p>
<p>è¿™ä¸ªç®—æ˜¯åŸºç¡€å†…å®¹äº†ï¼Œå¦‚æœä¸çŸ¥é“çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/carson_ho/article/details/56009827">https://blog.csdn.net/carson_ho/article/details/56009827</a></p>
<p>Canvas é‡Œé¢ä¸æ­¢æœ‰ç»˜åˆ¶çŸ©å½¢çš„æ–¹æ³•ï¼Œè¿˜æœ‰ç»˜åˆ¶åœ†çš„æ–¹æ³•ï¼Œç»˜åˆ¶æ–‡å­—çš„æ–¹æ³•Â·Â·Â·Â·Â·Â·ï¼Œè¿™é‡Œä¸ä¼šå»è®²è§£è¿™äº›åŸºç¡€å†…å®¹ï¼Œå¯ä»¥å»ä¸‹é¢è¿™äº›åœ°æ–¹å»æŸ¥çœ‹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Canvas?hl=en">https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Canvas?hl=en</a></li>
</ul>
</blockquote>
<h4 id="2ã€Paint-ç”»ç¬”"><a href="#2ã€Paint-ç”»ç¬”" class="headerlink" title="2ã€Paint ç”»ç¬”"></a>2ã€Paint ç”»ç¬”</h4><blockquote>
<p>å‰é¢çš„ä»£ç æ¼”ç¤ºä¸­å‡ºç°äº† <code>Paint</code>ï¼Œè¿™ä¸ªç±»ä¸»è¦æ˜¯ç®¡ç”»ç¬”çš„ï¼Œé™¤äº†è®¾ç½®é¢œè‰²ä»¥å¤–ï¼Œä»–è¿˜å¯ä»¥è®¾ç½®çº¿çš„ç²—ç»†ç­‰</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™æ˜¯æˆ‘çš„æŸä¸ªè‡ªå®šä¹‰ View è®¾ç½®çš„ Paint</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mCircleBackgroundPaint <span class="hljs-keyword">by</span> lazyUnlock &#123;<br>    Paint().apply &#123;<br>        color = mCircleBackground<br>        style = Paint.Style.FILL<br>        isAntiAlias = <span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Paint çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œç»™å‡ºæ–‡ç« ï¼Œä½ ä»¬æœ‰æ—¶é—´å¯ä»¥å»çœ‹çœ‹ï¼Œé‚£æœ¬è‡ªå®šä¹‰é»‘ä¹¦å¯¹äº Paint çš„å†…å®¹æœ‰ç‚¹å°‘ï¼Œå»ºè®®å»çœ‹ä¹¦ä½œè€…å†™çš„æ–‡ç« ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå…¶ä»–é«˜çº§ç”¨æ³•</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://qijian.blog.csdn.net/article/details/50995268">https://qijian.blog.csdn.net/article/details/50995268</a></li>
</ul>
</blockquote>
<h4 id="3ã€Path-è·¯å¾„"><a href="#3ã€Path-è·¯å¾„" class="headerlink" title="3ã€Path è·¯å¾„"></a>3ã€Path è·¯å¾„</h4><blockquote>
<p>Path è¡¨ç¤ºè·¯å¾„ï¼Œå¸¸ç”¨äºç»˜åˆ¶æ›²çº¿ï¼Œç»˜åˆ¶ä¸è§„åˆ™çš„å›¾å½¢ç­‰</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™æ˜¯æˆ‘çš„æŸä¸ªè‡ªå®šä¹‰ View è®¾ç½®çš„ Path</span><br><span class="hljs-comment">// ä¸»è¦æ˜¯å†™äº†æ ¹æ®å˜åŒ–çš„ offset å€¼æ¥è®¡ç®—åœ†çš„åŠå¾„ï¼Œæœ€åç»˜åˆ¶ä¸€ä¸ªåœ†</span><br><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drawFirstCircle</span><span class="hljs-params">(path: <span class="hljs-type">Path</span>, offset: <span class="hljs-type">Float</span>, total: <span class="hljs-type">Float</span>)</span></span> &#123;<br>    <span class="hljs-keyword">val</span> radio = abs(offset / total)<br>    <span class="hljs-keyword">val</span> startMove = <span class="hljs-number">0.6F</span><br>    <span class="hljs-keyword">val</span> k = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> - startMove)<br>    <span class="hljs-keyword">val</span> b = <span class="hljs-number">1</span> - k<br>    <span class="hljs-keyword">val</span> y = offset / abs(offset) * max(<span class="hljs-number">0F</span>, k * radio + b) * total<br>    <span class="hljs-keyword">val</span> r = getNewRadius(y)<br>    <span class="hljs-keyword">val</span> dx = (outerX - abs(y)) / (outerR + r) * r<br>    <span class="hljs-keyword">val</span> dy = outerY / (outerR + r) * r<br>    firstPointX = <span class="hljs-keyword">if</span> (offset &gt; <span class="hljs-number">0</span>) dx + y <span class="hljs-keyword">else</span> -dx + y<br>    firstPointY = dy<br>    path.addCircle(y, <span class="hljs-number">0F</span>, r, Path.Direction.CCW)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸è¿›è¡Œè®²è§£ï¼Œç»™å‡ºä¸‹é¢æ–‡ç« ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Path?hl=en">https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Path?hl=en</a></li>
<li><a target="_blank" rel="noopener" href="https://carsonho.blog.csdn.net/article/details/60597923">https://carsonho.blog.csdn.net/article/details/60597923</a></li>
<li><a target="_blank" rel="noopener" href="https://qijian.blog.csdn.net/article/details/50995268">https://qijian.blog.csdn.net/article/details/50995268</a></li>
</ul>
</blockquote>
<h4 id="4ã€å…¶ä»–ä¸œè¥¿"><a href="#4ã€å…¶ä»–ä¸œè¥¿" class="headerlink" title="4ã€å…¶ä»–ä¸œè¥¿"></a>4ã€å…¶ä»–ä¸œè¥¿</h4><blockquote>
<p>ä¸Šé¢å¹¶æ²¡æœ‰åˆ—å®ŒåŸºç¡€çŸ¥è¯†ï¼Œå› ä¸ºåŸºç¡€çŸ¥è¯†å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œè¿™é‡Œæ˜¯å†™ä¸ä¸‹çš„ï¼Œæ¥ä¸‹æ¥æˆ‘è®²ä¸€äº›å…¶ä»–ç»éªŒæ€§çš„ä¸œè¥¿</p>
</blockquote>
<h5 id="1ã€onDraw-é‡Œé¢ç¦æ­¢-new-å¯¹è±¡"><a href="#1ã€onDraw-é‡Œé¢ç¦æ­¢-new-å¯¹è±¡" class="headerlink" title="1ã€onDraw() é‡Œé¢ç¦æ­¢ new å¯¹è±¡"></a>1ã€onDraw() é‡Œé¢ç¦æ­¢ new å¯¹è±¡</h5><blockquote>
<p>å¾ˆå¤šåˆå­¦è€…åœ¨åˆšå¼€å§‹å†™çš„æ—¶å€™å¾ˆå–œæ¬¢åœ¨ <code>onDraw()</code> é‡Œé¢ new å¯¹è±¡ï¼Œä¹‹å‰ <code>canvas.drawRect()</code> ä¸æ˜¯è¦ä¼ å…¥ä¸€ä¸ªç”»ç¬”å—ï¼Ÿå°±ä¼šæœ‰äººè¿™æ ·å†™</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> &#123;<br> <span class="hljs-keyword">super</span>.onDraw(canvas)<br> <span class="hljs-keyword">val</span> blackPaint = Paint()<br> blackPaint.color = Color.BLACK<br> canvas.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, blackPaint)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ ·å†™æ—¶ AS è¿˜ä¼šæŠ¥ä¸€ä¸ªé»„ï¼Œå‘Šè¯‰ä½ è¿™æ ·å†™æ˜¯ä¸å¯¹çš„ï¼Œä½†ä½ çŸ¥é“ä¸ºä»€ä¹ˆä¸å¯¹å—ï¼Ÿ</p>
<p>åŸå› ï¼š<code>onDraw()</code> åœ¨ä¸€ç›´åˆ·æ–°è§†å›¾æ—¶ï¼Œåœ¨ 60 å¸§çš„æ‰‹æœºä¸Šä¼šæ¯éš” 16 æ¯«ç§’å›è°ƒä¸€æ¬¡ï¼Œ90 å¸§çš„æ‰‹æœºä¸Šæ¯éš” 11 æ¯«ç§’å›è°ƒä¸€æ¬¡ï¼ˆ1000 Ã· 90ï¼‰ï¼Œæ‰€ä»¥åœ¨ä¸€ç§’é’Ÿï¼Œ60 å¸§çš„æ‰‹æœºä¼šç”Ÿæˆ 60 ä¸ª Paint å¯¹è±¡ï¼Œ90 å¸§æ‰‹æœºç”Ÿæˆ 90 ä¸ªå¯¹è±¡ï¼Œè¿™æ ·ç–¯ç‹‚ new å¯¹è±¡ï¼Œä¼šè®©æ‰‹æœºå‡ºç°å¡é¡¿ï¼Œè¿™è·Ÿä¸ŠèŠ‚è¯¾è®²çš„ <code>onBindViewHolder()</code> ä¸è¦å†™ç‚¹å‡»ç›‘å¬ä¸€æ ·ï¼Œä½†è¿™ä¸ªä¼šæ¯”å®ƒæ›´ä¸¥é‡</p>
<p>ä½† AS çš„æ™ºèƒ½æç¤ºå¹¶ä¸æ˜¯èƒ½å‘ç°æ‰€æœ‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> &#123;<br> <span class="hljs-keyword">super</span>.onDraw(canvas)<br> <span class="hljs-keyword">set</span> &#123; <br>     <span class="hljs-comment">// ...</span><br> &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(func: () -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br> func.invoke()<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µè¾ƒéš¾å‘ç°ï¼Œè¿™æ ·å†™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œå»ºè®®åŠ ä¸Š <code>inline</code> å…³é”®å­—</p>
<p><strong>è¯¥ç¦ä»¤åŒæ ·é€‚ç”¨äº <code>onMeasure()</code>ã€<code>onLayout()</code>ï¼</strong></p>
</blockquote>
<h5 id="2ã€ä¸è¦åœ¨-onDraw-é‡Œé¢è¿›è¡Œè€—æ—¶æ“ä½œ"><a href="#2ã€ä¸è¦åœ¨-onDraw-é‡Œé¢è¿›è¡Œè€—æ—¶æ“ä½œ" class="headerlink" title="2ã€ä¸è¦åœ¨ onDraw() é‡Œé¢è¿›è¡Œè€—æ—¶æ“ä½œ"></a>2ã€ä¸è¦åœ¨ onDraw() é‡Œé¢è¿›è¡Œè€—æ—¶æ“ä½œ</h5><blockquote>
<p>åŸå› è·Ÿä¸Šé¢ä¸€æ ·</p>
<p><strong>è¯¥ç¦ä»¤åŒæ ·é€‚ç”¨äº <code>onMeasure()</code>ã€<code>onLayout()</code>ï¼</strong></p>
</blockquote>
<h5 id="3ã€ä¸è¦æŒæœ‰-canvas-å¯¹è±¡"><a href="#3ã€ä¸è¦æŒæœ‰-canvas-å¯¹è±¡" class="headerlink" title="3ã€ä¸è¦æŒæœ‰ canvas å¯¹è±¡"></a>3ã€ä¸è¦æŒæœ‰ canvas å¯¹è±¡</h5><blockquote>
<p>æ¯æ¬¡å›è°ƒçš„ canvas å¯¹è±¡å¹¶ä¸æ˜¯ä¸€å®šæ˜¯åŒä¸€ä¸ªï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯åŒä¸€ä¸ªï¼‰ï¼Œè€Œä¸”æ¯æ¬¡çš„å›è°ƒåªèƒ½è¡¨ç¤ºå½“å‰å¸§çš„çŠ¶æ€ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¥ä¸ªè¿è§„æ“ä½œï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> &#123;<br> <span class="hljs-keyword">super</span>.onDraw(canvas)<br> <span class="hljs-comment">// å¼€ä¸€ä¸ªçº¿ç¨‹æ¨¡æ‹ŸæŒæœ‰ canvas å¯¹è±¡</span><br> thread &#123;<br>     <span class="hljs-comment">// å»¶è¿Ÿ 20 æ¯«ç§’æ‰ç»˜å›¾</span><br>     sleep(<span class="hljs-number">20</span>)<br>     canvas.drawRect(<span class="hljs-number">0F</span>, <span class="hljs-number">0F</span>, <span class="hljs-number">100F</span>, <span class="hljs-number">200F</span>, mBlackPaint)<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä½ å¯èƒ½çŒœéƒ½çŒœä¸åˆ°å®ƒæŠŠå›¾ç»˜åˆ¶åˆ°å“ªé‡Œå»äº†</p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320163052101.png" srcset="/img/loading.gif" lazyload alt="image-20220320163052101" style="zoom:50%;float:left" />

<p>å¥½å®¶ä¼™ï¼Œå®ƒç«Ÿç„¶æŠŠå›¾ç»˜åˆ¶åˆ°æ ‡é¢˜æ ä¸Šäº†ï¼Œè¿™é‡ŒçŒœæµ‹åŸå› å¦‚ä¸‹ï¼ˆæ²¡æœ‰å»æŸ¥çœ‹æºç æ‰¾çœŸæ­£åŸå› ï¼‰ï¼š</p>
<ul>
<li>æ•´ä¸ªåº”ç”¨å…±ç”¨äº†åŒä¸€ä¸ª canvas å¯¹è±¡</li>
<li>å› å¼€å¯çº¿ç¨‹å sleepï¼Œæ‰€ä»¥ canvas æ˜¯æ•´ä¸ªåº”ç”¨ç»˜åˆ¶å®Œæˆåå†è°ƒç”¨çš„ <code>canvas.drawRect()</code></li>
<li><strong>æ ‡é¢˜æ æ˜¯åœ¨æœ€åè¿›è¡Œç»˜åˆ¶çš„</strong>ï¼Œæ­¤æ—¶çš„ canvas çš„åæ ‡ç³»æ˜¯ä»¥æ ‡é¢˜æ ä¸ºå‡†çš„</li>
</ul>
<p>è¿™æ€ä¹ˆéªŒè¯å‘¢ï¼Ÿ</p>
<blockquote>
<p>ä½ æŠŠå¼€å‘è€…æ¨¡å¼æ¨¡å¼çš„ <code>æ˜¾ç¤ºå¸ƒå±€è¾¹ç•Œ</code> ç»™æ‰“å¼€ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢è¿™ç§å›¾ï¼š</p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164459116.png" srcset="/img/loading.gif" lazyload alt="image-20220320164459116" style="zoom: 67%;float:left" />

<p>è¿™é‡Œè¯´æ˜æ ‡é¢˜æ çš„æ–‡å­—æ˜¯ä¸€ä¸ª View æ¥æ˜¾ç¤ºçš„</p>
<p>é‚£æˆ‘ä»¬è¯•è¯•æŠŠæ ‡é¢˜æ ç»™å»æ‰ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--theme.xml--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.MaterialComponents.DayNight.NoActionBar&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>

<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164844556.png" srcset="/img/loading.gif" lazyload alt="image-20220320164844556" style="zoom: 67%;float:left" />

<p>å˜¿ï¼Œå»æ‰æ ‡é¢˜æ åç»˜åˆ¶çš„ä½ç½®å¯¹äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æå‡ºçŒœæµ‹ï¼šæ ‡é¢˜æ æ˜¯åœ¨æœ€åè¿›è¡Œç»˜åˆ¶çš„</p>
<p>å…¶å®æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹ï¼Œå†™ä¸€ä¸ªåœ¨å®ƒåé¢ç»˜åˆ¶çš„ View éªŒè¯ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">com.ndhzs.lib.section4.MySection4ViewCanvas</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;300dp&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;300dp&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">View</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320165148269.png" srcset="/img/loading.gif" lazyload alt="image-20220320165148269" style="zoom: 67%;float:left" />

<p>æœç„¶ï¼Œæˆ‘çš„çŒœæµ‹åº”è¯¥æ˜¯åˆç†çš„</p>
</blockquote>
</blockquote>
<h5 id="4ã€è‡ªå®šä¹‰-View-å’Œ-ViewGroup-åœ¨ç»˜åˆ¶ä¸­çš„ä¸åŒ"><a href="#4ã€è‡ªå®šä¹‰-View-å’Œ-ViewGroup-åœ¨ç»˜åˆ¶ä¸­çš„ä¸åŒ" class="headerlink" title="4ã€è‡ªå®šä¹‰ View å’Œ ViewGroup åœ¨ç»˜åˆ¶ä¸­çš„ä¸åŒ"></a>4ã€è‡ªå®šä¹‰ View å’Œ ViewGroup åœ¨ç»˜åˆ¶ä¸­çš„ä¸åŒ</h5><blockquote>
<p>åœ¨è‡ªå®šä¹‰ ViewGroup ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šé‡å†™ <code>onDraw()</code>ï¼Œå› ä¸º ViewGroup å¯¹ <code>onDraw()</code> è¿›è¡Œäº†å¤„ç†ï¼Œåªæœ‰åœ¨<strong>æœ‰èƒŒæ™¯å›¾æ—¶</strong>ï¼Œæ‰ä¼šè°ƒç”¨ <code>onDraw()</code>ï¼Œæ‰€ä»¥åœ¨è‡ªå®šä¹‰ ViewGroup æ—¶æƒ³ç»˜å›¾ä¸€èˆ¬æ˜¯é‡å†™ <code>dispatchDraw(Canvas canvas)</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥å†³å®šæ˜¯ç»˜åˆ¶åœ¨å­ View ä¸Šå±‚è¿˜æ˜¯å­ View ä¸‹å±‚ï¼Œå…·ä½“çš„ä½ ä»¬è‡ªå·±å»å®è·µä¸€ä¸‹å§ï¼Œè¿™é‡Œç»™å‡ºæ–‡ç« é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/89efaf8bd3dd">https://www.jianshu.com/p/89efaf8bd3dd</a></p>
</blockquote>
<h4 id="5ã€onDraw-çš„ç»˜åˆ¶æµç¨‹"><a href="#5ã€onDraw-çš„ç»˜åˆ¶æµç¨‹" class="headerlink" title="5ã€onDraw() çš„ç»˜åˆ¶æµç¨‹"></a>5ã€onDraw() çš„ç»˜åˆ¶æµç¨‹</h4><blockquote>
<p>è¿™ä¸œè¥¿å±äºé«˜é˜¶å†…å®¹ï¼Œé™äºæ—¶é—´å…³ç³»ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²äº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™äº›æ–‡ç« ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/carson_ho/article/details/56011153">https://blog.csdn.net/carson_ho/article/details/56011153</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Idtk/Blog/blob/master/Blog/9%E3%80%81Invalidate.md">https://github.com/Idtk/Blog/blob/master/Blog/9%E3%80%81Invalidate.md</a></li>
</ul>
</blockquote>
<h3 id="5ã€invalidate"><a href="#5ã€invalidate" class="headerlink" title="5ã€invalidate()"></a>5ã€invalidate()</h3><blockquote>
<p>è¿™ä¸œè¥¿ä½ ç›®å‰åªéœ€è¦è®°ä½ä»¥ä¸‹å‡ ç‚¹å°±å¯ä»¥äº†ï¼š</p>
<ul>
<li>è°ƒç”¨åä¼šåœ¨<strong>ä¸‹ä¸€å¸§å›è°ƒ</strong> <code>onDraw()</code> è¿›è¡Œåˆ·æ–°</li>
<li>ä¸‹ä¸€å¸§æ˜¯æŒ‡ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°çš„æ—¶å€™</li>
</ul>
<p>å¦‚æœä½ æƒ³æ¢ç©¶æºç çš„è¯ï¼Œæˆ‘åªèƒ½ä¸¢æ–‡ç« å‡ºæ¥äº†ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7017452765672636446">https://juejin.cn/post/7017452765672636446</a></li>
</ul>
<p>OKï¼Œè¿™ä¸ªæ–¹æ³•è®²å®Œäº†ï¼Œå› ä¸ºå¾€æ·±äº†è®²ï¼Œä¼šæ¶‰åŠåˆ° Handler æœºåˆ¶ã€ViewRootImpl ç­‰ Framwork å±‚æºç </p>
<p>å“¦ï¼Œæƒ³èµ·äº†ï¼Œè¿˜è¦ä¸€ç‚¹ï¼Œé™¤äº† <code>invalidate()</code> å¤–è¿˜æœ‰ä¸€ä¸ª <code>postInvalidate()</code> ç”¨äºåœ¨å…¶ä»–çº¿ç¨‹é‡Œåˆ·æ–°</p>
<p>ä½†è€ƒè™‘åˆ°å¯èƒ½ä¼šæœ‰å…¶ä»–å­¦é•¿æ¥å¬è¯¾ï¼Œæˆ‘è¿˜æ˜¯ç”»ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾</p>
<pre><code class=" mermaid">graph TB
id1(&quot;View&quot;)--&gt;id2
id2[&quot;è°ƒç”¨invalidate()åˆ·æ–°&quot;]--&gt;id3
id3&#123;&quot;parent == null&quot;&#125;--ä¸ä¸º null--&gt;id4
id4[&quot;å‘Šè¯‰çˆ¶å¸ƒå±€æœ‰å­å¸ƒå±€è¦é‡ç»˜&quot;]--&gt;id3--ä¸º null--&gt;id5
id5[&quot;ä¼ é€’åˆ°äº† ViewRootImpl (ä¸€ä¸ªç®¡ç†å¸ƒå±€çš„ç±»)&quot;]--&gt;id6
id6[&quot;ViewRootImpl è°ƒç”¨ mChoreographer å‘é€ä¸€ä¸ª post (ä¸€ä¸ªä¸“é—¨ç›‘å¬å±å¹•åˆ·æ–°çš„ç±»)&quot;]-.-&gt;id7
id7[&quot;å±å¹•åˆ·æ–°äº†ï¼Œå›è°ƒ ViewRootImplï¼Œå¼€å§‹é‡æ–°èµ° View æµ‹é‡å’Œç»˜å›¾æµç¨‹&quot;]--&gt;id8
id8(&quot;ä»é¡¶éƒ¨å¸ƒå±€æœ€åå›è°ƒåˆ° View çš„ onDraw()&quot;)
</code></pre>

<p>å…¶å®è¿˜æœ‰äº¿ç‚¹ç»†èŠ‚ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²è¿°äº†ï¼Œè‡ªå·±çœ‹ä¸‹é¢å›¾ï¼Œå…¶å®è¿™å›¾ä»æœ‰è®¸å¤šæ²¡æœ‰ç”»ä¸Š</p>
<pre><code class=" mermaid">sequenceDiagram
View-&gt;&gt;View: invalidate()
View-&gt;&gt;ViewGroup: invalidateChild()
alt å¦‚æœæ˜¯ç¡¬ä»¶åŠ é€Ÿ
	ViewGroup-&gt;&gt;other ViewGroups: onDescendantInvalidated()
	other ViewGroups-&gt;&gt;DecorView: onDescendantInvalidated()
	DecorView-&gt;&gt;ViewRootImpl: onDescendantInvalidated()
	ViewRootImpl-&gt;&gt;ViewRootImpl: invalidate()
else å¦‚æœæ˜¯è½¯ä»¶åŠ é€Ÿ
	ViewGroup-&gt;&gt;other ViewGroups: invalidateChildInParent()
	other ViewGroups-&gt;&gt;DecorView: invalidateChildInParent()
	DecorView-&gt;&gt;ViewRootImpl: invalidateChildInParent()
	ViewRootImpl-&gt;&gt;ViewRootImpl: invalidateRectOnScreen()
end
ViewRootImpl-&gt;&gt;ViewRootImpl: scheduleTraversals()
ViewRootImpl-&gt;&gt;Choreographer: postCallback(mTraversalRunnable)
Choreographer-&gt;&gt;Handler: sendMessage*()
Handler-&gt;&gt;Handler: ç­‰åˆ°ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°
Handler-&gt;&gt;ViewRootImpl: mTraversalRunnable.run()
ViewRootImpl-&gt;&gt;ViewRootImpl: doTraversal()
ViewRootImpl-&gt;&gt;ViewRootImpl: performTraversals()
ViewRootImpl-&gt;&gt;ViewRootImpl: performDraw()
ViewRootImpl-&gt;&gt;DecorView: draw()
DecorView-&gt;&gt;other ViewGroups: draw()
other ViewGroups-&gt;&gt;ViewGroup: draw()
ViewGroup-&gt;&gt;View: draw()
View-&gt;&gt;View: onDraw()
</code></pre>

<p>END</p>
</blockquote>
<h3 id="6ã€è‡ªå®šä¹‰å±æ€§-AttributeSet"><a href="#6ã€è‡ªå®šä¹‰å±æ€§-AttributeSet" class="headerlink" title="6ã€è‡ªå®šä¹‰å±æ€§ AttributeSet"></a>6ã€è‡ªå®šä¹‰å±æ€§ AttributeSet</h3><blockquote>
<p>å‰é¢æˆ‘ä»¬æåˆ°ç³»ç»Ÿä¼šæŠŠä½  xml ä¸­å†™å¾—å±æ€§è£…æ¢ä¸ºä¸€ä¸ª AttributeSet å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆè‡ªå®šä¹‰è‡ªå·±çš„å±æ€§å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œéœ€è¦æ–°å»ºä¸€ä¸ª <code>res/value/attrs.xml</code> æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªåœ†åŠå¾„çš„å±æ€§</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br> <span class="hljs-comment">&lt;!--è¿™ä¸ª name æ˜¯ View çš„ç±»å--&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MySection6View&quot;</span>&gt;</span><br>     <span class="hljs-comment">&lt;!--è¿™ä¸ª name æ˜¯è‡ªå®šä¹‰å±æ€§çš„åç§°ï¼Œformate æ˜¯æ¥å—çš„ç±»å‹--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my6_circleRadius&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;dimension&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>å¦‚ä¸Šè¿°ä»£ç ï¼Œè¿™é‡Œæœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰å±æ€§çš„åç§°ä¸èƒ½ä¸å®˜æ–¹çš„é‡å¤ï¼Œè€Œä¸”å»ºè®®åŠ ä¸Šå‰ç¼€ï¼Œä¸å®˜æ–¹çš„è¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚æˆ‘å°±åŠ ä¸Šäº† <code>my6_</code></li>
</ul>
<p><code>formate</code> æœ‰ä¸‹é¢å‡ ç§ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¯´æ˜</th>
<th>ç”¨æ³•</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><em><strong>dimension</strong></em></td>
<td>é•¿åº¦å€¼</td>
<td>â€œ1dpâ€ã€â€1pxâ€ã€â€@dimen&#x2F;xxxâ€</td>
<td>è¿™é‡Œæ— æ‰€è°“ dpã€pxï¼Œç³»ç»Ÿä¼šæœ€ç»ˆè£…æ¢æˆ px</td>
</tr>
<tr>
<td><em><strong>reference</strong></em></td>
<td>å¼•ç”¨å€¼</td>
<td>â€œ@drawable&#x2F;xxxâ€ã€â€@style&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>color</strong></em></td>
<td>é¢œè‰²å€¼</td>
<td>â€œ#FFFFFFFFâ€ã€â€@color&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>float</strong></em></td>
<td>å°æ•°</td>
<td>â€œ1.0â€</td>
<td></td>
</tr>
<tr>
<td><em><strong>boolean</strong></em></td>
<td>å¸ƒå°”ç±»å‹</td>
<td>â€œtrueâ€ã€â€@bool&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>interger</strong></em></td>
<td>æ•´æ•°</td>
<td>â€œ1â€ã€â€@interget&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>string</strong></em></td>
<td>å­—ç¬¦ä¸²</td>
<td>â€œstringâ€ã€â€@string&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>fraction</strong></em></td>
<td>ç™¾åˆ†æ•°</td>
<td>â€œ50%â€ã€â€@fraction&#x2F;xxxâ€</td>
<td></td>
</tr>
<tr>
<td><em><strong>enum</strong></em></td>
<td>æšä¸¾</td>
<td><a href="#enum">çœ‹ä¸‹æ–‡</a></td>
<td></td>
</tr>
<tr>
<td><em><strong>flag</strong></em></td>
<td>ä½è¿ç®—</td>
<td><a href="#flag">çœ‹ä¸‹æ–‡</a></td>
<td></td>
</tr>
</tbody></table>
<h3 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h3><blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ¯”å¦‚æˆ‘è®¾ç½®åœ†çš„ä½ç½®å±æ€§--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my6_circleGravity&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;enum&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;left&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure>

<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320195658810.png" srcset="/img/loading.gif" lazyload alt="image-20220320195658810" style="zoom:50%;float:left" />

<p>è®¾ç½®ååœ¨ä½¿ç”¨æ—¶å®ƒçš„å±æ€§å°±åªèƒ½é€‰æ‹©ä½ å¡«å†™çš„é‚£å‡ ä¸ª</p>
</blockquote>
<h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><blockquote>
<p>å°±æ˜¯è¿›è¡Œä½è¿ç®—ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ FrameLayout çš„ <code>layout_gravity</code> ä¸ºä¾‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;layout_gravity&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--0011 0000--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;top&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x30&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0101 0000--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bottom&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x50&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0000 0011--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;left&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x03&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0000 0101--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x05&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0001 0000--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;center_vertical&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x10&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0000 0001--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;center_horizontal&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x01&quot;</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--0001 0001--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x11&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x00800003&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;end&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x00800005&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>ä½ æ˜¯å¦è¿˜è®°å¾—ä½ æ›¾ç»è¿™æ ·ä½¿ç”¨è¿‡ï¼Ÿ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">View</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">&quot;top|left&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œä½ ä¼šå‘ç°å®ƒæŠŠ <code>top|left</code> æŠ¥é»„äº†ï¼ŒåŸå› åœ¨äºå®ƒæ¨èä½ ä½¿ç”¨ <code>start</code> å»ä»£æ›¿ <code>left</code>ï¼Œå› ä¸ºåœ¨éƒ¨åˆ†å›½å®¶æ˜¯ä»å³è¾¹å¾€å·¦è¾¹é˜…è¯»æ–‡å­—çš„ï¼Œæ‰€ä»¥ï¼ŒAndroid ä¸ºäº†å›½é™…åŒ–ï¼Œå°±è®¾è®¡å‡ºäº† <code>start</code> ä»£æ›¿ <code>left</code>ï¼Œ<code>end</code> ä»£æ›¿ <code>right</code></p>
</blockquote>
</blockquote>
<h3 id="ç±»å‹çš„æ··ç”¨"><a href="#ç±»å‹çš„æ··ç”¨" class="headerlink" title="ç±»å‹çš„æ··ç”¨"></a>ç±»å‹çš„æ··ç”¨</h3><blockquote>
<p>æ¯”å¦‚ <code>android:layout_width</code> æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;layout_width&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;dimension&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fill_parent&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;-1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;match_parent&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;-1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;wrap_content&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;-2&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>è¿˜æœ‰ <code>android:background</code> æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;background&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;reference|color&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä½ ä¼ å…¥ <code>@drawable/xxx</code> å’Œ <code>#FFFFFFFF</code>ï¼Œå®ƒéƒ½å¯ä»¥è·å–ï¼Œåªæ˜¯å¡«å…¥é¢œè‰²å€¼æ—¶ä½¿ç”¨ <code>TypedValue#getDrawable()</code> å¾—åˆ°æ˜¯ ColorDrawable</p>
<p>ä¹Ÿæ”¯æŒè¿™æ ·æ··ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è¿™æ˜¯ View çš„ä¸€ä¸ªå±æ€§--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;focusable&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;boolean|enum&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;auto&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0x00000010&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>ä½†è¿™æ ·ä½¿ç”¨åªèƒ½æ‰‹åŠ¨å»åˆ¤æ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getFocusableAttribute</span><span class="hljs-params">(TypedArray attributes)</span> &#123;<br>    <span class="hljs-type">TypedValue</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypedValue</span>();<br>    <span class="hljs-keyword">if</span> (attributes.getValue(com.android.internal.R.styleable.View_focusable, val)) &#123;<br>        <span class="hljs-keyword">if</span> (val.type == TypedValue.TYPE_INT_BOOLEAN) &#123;<br>            <span class="hljs-keyword">return</span> (val.data == <span class="hljs-number">0</span> ? NOT_FOCUSABLE : FOCUSABLE);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> val.data;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> FOCUSABLE_AUTO;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</blockquote>
<p>å‰é¢è®²äº†ç±»å‹çš„å®šä¹‰ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆè·å–è¿™äº›å±æ€§å‘¢ï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mCircleRadius = <span class="hljs-number">100</span><br><span class="hljs-comment">// è¿™ä¸ª enum å±æ€§æ›´å»ºè®®ä½¿ç”¨æšä¸¾æ¥ä¿å­˜ï¼Œå®˜æ–¹é€šå¸¸ä½¿ç”¨çš„æ³¨è§£ï¼Œä½† kt å¾ˆæ€ªï¼Œæ³¨è§£ä¸èµ·ä½œç”¨</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mCircleGravity = <span class="hljs-number">0</span><br><span class="hljs-keyword">init</span> &#123;<br>    <span class="hljs-keyword">if</span> (attrs != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// ä¸»è¦å°±æ˜¯è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•å»è·å–å±æ€§</span><br>        <span class="hljs-keyword">val</span> ty = context.obtainStyledAttributes(attrs, R.styleable.MySection6View)<br>        mCircleRadius = ty.getDimensionPixelSize(<br>            R.styleable.MySection6View_my6_circleRadius,<br>            mCircleRadius<br>        )<br>        mCircleGravity = ty.getInt(<br>            R.styleable.MySection6View_my6_circleGravity,<br>            mCircleGravity<br>        )<br>        ty.recycle()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜å¥½åªæœ‰ä¸¤ä¸ªå±æ€§ï¼Œä½†å¦‚æœæœ‰å¤šè¾¾ä¸Šç™¾ä¸ªå±æ€§è¿™æ ·å†™æœªå…å¤ªå è¡Œæ•°äº†ï¼Œæ‰€ä»¥ï¼Œç§‰æŒç€å°‘å†™ä»£ç çš„åŸåˆ™ï¼Œæˆ‘ä½¿ç”¨äº† kt æ‰©å±•å‡½æ•°æ¥ä¼˜åŒ–ï¼ˆä¸‹é¢æ˜¯æˆ‘å†™çš„è¯¾è¡¨è‡ªå®šä¹‰ Viewï¼‰ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// å…ˆæŠŠå±æ€§çš„è¯»å–å•ç‹¬æå–åˆ°ä¸€ä¸ªç±»ä¸­</span><br><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetLayout</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span>(<br>    context: Context,<br>    attrs: AttributeSet? = <span class="hljs-literal">null</span>,<br>    defStyleAttr: <span class="hljs-built_in">Int</span> = R.attr.netLayoutStyle,<br>    defStyleRes: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><br>) : ViewGroup(context, attrs, defStyleAttr, defStyleRes), INetLayout &#123;<br>    <span class="hljs-comment">// å±æ€§å€¼</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">val</span> mNetAttrs: NetLayoutAttrs = NetLayoutAttrs.newInstance(<span class="hljs-keyword">this</span>, attrs)<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// æˆ‘æŠŠå±æ€§å•ç‹¬å†™åœ¨äº†ä¸€ä¸ªç±»é‡Œé¢</span><br><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetLayoutAttrs</span>(<br>    rowCount: <span class="hljs-built_in">Int</span>,<br>    columnCount: <span class="hljs-built_in">Int</span><br>) : BaseViewAttrs &#123;<br><br>    <span class="hljs-keyword">var</span> rowCount = rowCount<br>        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">set</span><br>    <span class="hljs-keyword">var</span> columnCount = columnCount<br>        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">set</span><br><br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">newInstance</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            view: <span class="hljs-type">View</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            attrs: <span class="hljs-type">AttributeSet</span>?,</span></span><br><span class="hljs-params"><span class="hljs-function">            defStyleAttr: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            defStyleRes: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        )</span></span>: NetLayoutAttrs &#123;<br>            <span class="hljs-keyword">return</span> newAttrs(<br>                view,<br>                attrs,<br>                R.styleable.NetLayout,<br>                defStyleAttr,<br>                defStyleRes<br>            ) &#123;<br>                <span class="hljs-comment">// è¿™é‡Œä½ å°±ä¼šçœ‹åˆ°ç›´æ¥ä½¿ç”¨ R.styleable.xxx.int() æ¥è·å–å±æ€§ï¼Œè¿™æ ·å†™èµ·æ¥èˆ’æœå¤šäº†</span><br>                NetLayoutAttrs(<br>                    R.styleable.NetLayout_net_rowCount.int(ROW_COUNT),<br>                    R.styleable.NetLayout_net_columnCount.int(COLUMN_COUNT)<br>                )<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> ROW_COUNT = <span class="hljs-number">4</span><br>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> COLUMN_COUNT = <span class="hljs-number">4</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™æ˜¯å®šä¹‰æ‰©å±•å‡½æ•°çš„æ¥å£</span><br><span class="hljs-keyword">internal</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BaseViewAttrs</span> &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">newAttrs</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        view: <span class="hljs-type">View</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        attrs: <span class="hljs-type">AttributeSet</span>?,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-meta">@StyleableRes</span></span></span><br><span class="hljs-params"><span class="hljs-function">        styleableId: <span class="hljs-type">IntArray</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        defStyleAttr: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        defStyleRes: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        func: <span class="hljs-type">Typedef</span>.() -&gt; <span class="hljs-type">T</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: T = BaseViewAttrs.newAttrs(view, attrs, styleableId, defStyleAttr, defStyleRes, func)<br><br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">newAttrs</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            view: <span class="hljs-type">View</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            attrs: <span class="hljs-type">AttributeSet</span>?,</span></span><br><span class="hljs-params"><span class="hljs-function">            <span class="hljs-meta">@StyleableRes</span></span></span><br><span class="hljs-params"><span class="hljs-function">            styleableId: <span class="hljs-type">IntArray</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            defStyleAttr: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            defStyleRes: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            func: <span class="hljs-type">Typedef</span>.() -&gt; <span class="hljs-type">T</span></span></span><br><span class="hljs-params"><span class="hljs-function">        )</span></span>: T &#123;<br>            <span class="hljs-keyword">val</span> ty = view.context.obtainStyledAttributes(attrs, styleableId, defStyleAttr, defStyleRes)<br>            <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) &#123;<br>                <span class="hljs-comment">// è¿™æ˜¯ä¿å­˜åœ¨ Debug æ¨¡å¼ä¸­èƒ½çœ‹åˆ°çš„ä¿¡æ¯ï¼Œå…·ä½“æ€ä¹ˆæŸ¥çœ‹ï¼Œä½ å¯ä»¥å»çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æºç </span><br>                view.saveAttributeDataForStyleable(<br>                    view.context, styleableId, attrs, ty, defStyleAttr, defStyleRes)<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> Typedef(ty, view.context).func()<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                ty.recycle()<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Typedef</span>(<span class="hljs-keyword">val</span> ty: TypedArray, <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context) &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">int</span><span class="hljs-params">(defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.int(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">color</span><span class="hljs-params">(defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.color(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">colorById</span><span class="hljs-params">(<span class="hljs-meta">@ColorRes</span> defValueId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.color(<br>            ContextCompat.getColor(context, defValueId))<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">dimens</span><span class="hljs-params">(defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.dimens(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">dimens</span><span class="hljs-params">(defValue: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Float</span> = <span class="hljs-keyword">this</span>.dimens(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">layoutDimens</span><span class="hljs-params">(defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.layoutDimens(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">dimensById</span><span class="hljs-params">(<span class="hljs-meta">@DimenRes</span> defValueId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span><br>        .dimens(context.resources.getDimensionPixelSize(defValueId))<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">string</span><span class="hljs-params">(defValue: <span class="hljs-type">String</span>? = <span class="hljs-literal">null</span>)</span></span>: String = <span class="hljs-keyword">this</span>.string(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">boolean</span><span class="hljs-params">(defValue: <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> = <span class="hljs-keyword">this</span>.boolean(ty, defValue)<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">float</span><span class="hljs-params">(defValue: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Float</span> = <span class="hljs-keyword">this</span>.float(ty, defValue)<br>        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> E: RuntimeException&gt;</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">intOrThrow</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            attrsName: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-keyword">this</span>.intOrThrow&lt;E&gt;(ty, attrsName)<br>        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> E: RuntimeException&gt;</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">stringOrThrow</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            attrsName: <span class="hljs-type">String</span>)</span></span>: String = <span class="hljs-keyword">this</span>.stringOrThrow&lt;E&gt;(ty, attrsName)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">int</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getInt(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">color</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getColor(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">dimens</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getDimensionPixelSize(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">dimens</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Float</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getDimension(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">layoutDimens</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getLayoutDimension(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">string</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">String</span>? = <span class="hljs-literal">null</span>)</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> ty.getString(<span class="hljs-keyword">this</span>) ?: defValue ?: <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">boolean</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getBoolean(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">float</span><span class="hljs-params">(ty: <span class="hljs-type">TypedArray</span>, defValue: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Float</span> &#123;<br>    <span class="hljs-keyword">return</span> ty.getFloat(<span class="hljs-keyword">this</span>, defValue)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> E: RuntimeException&gt;</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">intOrThrow</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    ty: <span class="hljs-type">TypedArray</span>, attrsName: <span class="hljs-type">String</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">if</span> (!ty.hasValue(<span class="hljs-keyword">this</span>)) &#123;<br>        <span class="hljs-keyword">throw</span> E::<span class="hljs-keyword">class</span>.java.getConstructor(String::<span class="hljs-keyword">class</span>.java)<br>            .newInstance(<span class="hljs-string">&quot;å±æ€§ <span class="hljs-variable">$attrsName</span> æ²¡æœ‰è¢«å®šä¹‰ï¼&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.int(ty, <span class="hljs-number">0</span>)<br>&#125;<br><br><span class="hljs-keyword">internal</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> E: java.lang.RuntimeException&gt;</span> <span class="hljs-built_in">Int</span>.<span class="hljs-title">stringOrThrow</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    ty: <span class="hljs-type">TypedArray</span>, attrsName: <span class="hljs-type">String</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>: String &#123;<br>    <span class="hljs-keyword">if</span> (!ty.hasValue(<span class="hljs-keyword">this</span>)) &#123;<br>        <span class="hljs-keyword">throw</span> E::<span class="hljs-keyword">class</span>.java.getConstructor(String::<span class="hljs-keyword">class</span>.java)<br>            .newInstance(<span class="hljs-string">&quot;å±æ€§ <span class="hljs-variable">$attrsName</span> æ²¡æœ‰è¢«å®šä¹‰ï¼&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.string(ty)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰-layout-å±æ€§"><a href="#è‡ªå®šä¹‰-layout-å±æ€§" class="headerlink" title="è‡ªå®šä¹‰ layout_ å±æ€§"></a>è‡ªå®šä¹‰ layout_ å±æ€§</h3><p>ä¹‹å‰åœ¨æˆ‘ç»™å¤§å®¶ä¸Šçš„ Android ç¬¬ä¸€èŠ‚è¯¾è®²è¿‡ï¼Œçˆ¶ View æ˜¯å¯ä»¥ç»™å­ View é¢å¤–æ·»åŠ å±æ€§çš„ï¼Œä¸”å±æ€§åä»¥ <code>layout_</code> å¼€å¤´</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ¯”å¦‚è¯´è¿™ä¸ªé‡Œé¢æ‰€æœ‰ layout_ å¼€å¤´çš„éƒ½æ˜¯çˆ¶ View ç»™å­ View æ·»åŠ çš„é¢å¤–å±æ€§--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">View</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">&quot;top|left&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>é‚£å¦‚ä½•è‡ªå®šä¹‰ ViewGroup å¦‚ä½•è®¾ç½®è‡ªå·±æƒ³è¦çš„å±æ€§ï¼Ÿ</p>
<p>æ¯”å¦‚æˆ‘ç»™å®ƒæ·»åŠ ä¸€ä¸ªè¡¨ç¤ºå­ View ä½ç½®çš„å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--æ³¨æ„ï¼šè¿™ç§å±æ€§çš„è®¾ç½®å¿…é¡»ä»¥ _Layout ç»“å°¾ï¼Œè¿™æ˜¯å®˜æ–¹çš„è§„èŒƒï¼--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;My6ViewGroup_Layout&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æ³¨æ„ï¼šå±æ€§åå»ºè®®å¸¦æœ‰ layout_ å¼€å¤´çš„æ ‡è¯†--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my6VG_layout_position&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;integer&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ xml ä¸­å†™å¾—æ—¶å€™ï¼ŒAS ä¼šè¿›è¡Œæ™ºèƒ½æç¤º</p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321194906364.png" srcset="/img/loading.gif" lazyload alt="image-20220321194906364" style="zoom:67%;" />

<p>é‚£æ€ä¹ˆè·å–è¿™ä¸ªå±æ€§å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªæˆ‘ä»¬ç•™åˆ° <a href="#1%E3%80%81LayoutParams">LayoutParams</a> å†è®²è§£</p>
</blockquote>
<h3 id="7ã€onMeasure"><a href="#7ã€onMeasure" class="headerlink" title="7ã€onMeasure()"></a>7ã€onMeasure()</h3><blockquote>
<h3 id="ä½œç”¨-1"><a href="#ä½œç”¨-1" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>æµ‹é‡è‡ªèº«å’Œå­æ§ä»¶å¤§å°</p>
<h3 id="æ¶‰åŠçŸ¥è¯†"><a href="#æ¶‰åŠçŸ¥è¯†" class="headerlink" title="æ¶‰åŠçŸ¥è¯†"></a>æ¶‰åŠçŸ¥è¯†</h3><ul>
<li><code>MeasureSpecs</code></li>
<li><code>LayoutParams</code></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// ä¸ä¸Šé¢è®²çš„ onDraw() ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå›è°ƒï¼Œè¯¥å›è°ƒçš„ä½œç”¨æ˜¯ç”± requestLayout() è§¦å‘</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(widthMeasureSpec: <span class="hljs-type">Int</span>, heightMeasureSpec: <span class="hljs-type">Int</span>)</span></span> &#123;<br>    <span class="hljs-keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ä¸»è¦ç”¨æ³•"><a href="#ä¸»è¦ç”¨æ³•" class="headerlink" title="ä¸»è¦ç”¨æ³•"></a>ä¸»è¦ç”¨æ³•</h3><ul>
<li>è°ƒç”¨ <code>setMeasuredDimension()</code>ï¼Œè®¾ç½®è‡ªèº«å®½å’Œé«˜</li>
<li>éå†å­ Viewï¼Œå†è°ƒç”¨ <code>child.measure()</code>ï¼Œè®¾ç½®å­ View çš„å®½å’Œé«˜</li>
</ul>
<pre><code class=" mermaid">graph LR
id1(&quot;ViewRootImpl å¼€å§‹æµ‹é‡&quot;)--&gt;id2
id2[&quot;ViewGroup#mearsure()&quot;]--&gt;id3
id3[&quot;ViewGroup#onMeasure()&quot;]--&gt;id4
id4[&quot;View#measure()&quot;]--&gt;id5(&quot;View#onMeasure()&quot;)
</code></pre>


</blockquote>
<h4 id="1ã€LayoutParams"><a href="#1ã€LayoutParams" class="headerlink" title="1ã€LayoutParams"></a>1ã€LayoutParams</h4><blockquote>
<p>è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®ç±»ï¼Œç”¨äºåœ¨å­ View ä¸­ä¿å­˜çˆ¶ç±»éœ€è¦çš„ä¿¡æ¯</p>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€ä¸‹ FrameLayout çš„ LayoutParams</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½ ä¼šå‘ç°è¿™ LayoutParams å¾ˆç®€å•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LayoutParams</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MarginLayoutParams</span> &#123;<br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯¹åº” layout_gravity å±æ€§æ²¡æœ‰è¢«è®¾ç½®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">UNSPECIFIED_GRAVITY</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™å°±æ˜¯ layout_gravity å±æ€§çš„ä¿å­˜å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@see</span> android.view.Gravity</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@attr</span> ref android.R.styleable#FrameLayout_Layout_layout_gravity</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">gravity</span> <span class="hljs-operator">=</span> UNSPECIFIED_GRAVITY;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context c, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(c, attrs);<br>        <span class="hljs-comment">// çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å°±èƒ½å›ç­”ä¹‹å‰ç•™ä¸‹çš„é—®é¢˜äº†</span><br>        <span class="hljs-comment">// çˆ¶ View è¯»å–å­ View ä¸­çš„å±æ€§æ˜¯åœ¨ LayoutParams ä¸­è·å–çš„</span><br>        <span class="hljs-comment">// å¯èƒ½ä½ ä¼šå¥‡æ€ªäº View æ˜¯ä»€ä¹ˆæ—¶å€™å¼€å§‹åŠ è½½ LayoutParams</span><br>        <span class="hljs-comment">// è¿™ä¸ªç•™åˆ°åé¢è®² setContentView å†è®²è§£</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">TypedArray</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> c.obtainStyledAttributes(attrs, R.styleable.FrameLayout_Layout);<br>        gravity = a.getInt(R.styleable.FrameLayout_Layout_layout_gravity, UNSPECIFIED_GRAVITY);<br>        a.recycle();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        <span class="hljs-built_in">super</span>(width, height);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, <span class="hljs-type">int</span> gravity)</span> &#123;<br>        <span class="hljs-built_in">super</span>(width, height);<br>        <span class="hljs-built_in">this</span>.gravity = gravity;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams source)</span> &#123;<br>        <span class="hljs-built_in">super</span>(source);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup.MarginLayoutParams source)</span> &#123;<br>        <span class="hljs-built_in">super</span>(source);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LayoutParams</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LayoutParams source)</span> &#123;<br>        <span class="hljs-built_in">super</span>(source);<br>        <span class="hljs-built_in">this</span>.gravity = source.gravity;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœè¦æƒ³ä½¿ç”¨è¿™ä¸ª <code>LayoutParams</code> è¿˜å¾—é‡å†™è¿™å‡ ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™ä¸ªæ˜¯æ£€æŸ¥ LayoutParams æ˜¯å¦æ˜¯ä½ æƒ³è¦çš„ LayoutParams</span><br><span class="hljs-comment">// æ³¨æ„ï¼šè¿™ä¸ª LayoutParams æ˜¯éœ€è¦æ‰“ä¸ª ? çš„ï¼Œå› ä¸ºå­˜åœ¨ä¼ å…¥ä¸€ä¸ª null çš„æƒ…å†µ</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkLayoutParams</span><span class="hljs-params">(p: <span class="hljs-type">LayoutParams</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>    <span class="hljs-comment">// è¿™æ˜¯æƒ¯ç”¨å†™æ³•</span><br>    <span class="hljs-keyword">return</span> p <span class="hljs-keyword">is</span> NetLayoutParams<br>&#125;<br><br><span class="hljs-comment">// è¿™ä¸ªæ˜¯é€šè¿‡ AttributeSet å¾—åˆ°ä½ è‡ªå·±çš„ LayoutParmas</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateLayoutParams</span><span class="hljs-params">(attrs: <span class="hljs-type">AttributeSet</span>)</span></span>: LayoutParams &#123;<br>    <span class="hljs-keyword">return</span> NetLayoutParams(context, attrs)<br>&#125;<br><br><span class="hljs-comment">// è¿™ä¸ªæ˜¯è£…æ¢ LayoutParms</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateLayoutParams</span><span class="hljs-params">(lp: <span class="hljs-type">LayoutParams</span>)</span></span>: LayoutParams &#123;<br>    <span class="hljs-comment">// è¿™ä¹Ÿæ˜¯æƒ¯ç”¨å†™æ³•ï¼Œæ³¨æ„ï¼šè¦æŠŠä½  LayoutParams çš„æ‰€æœ‰çˆ¶ç±»éƒ½è¦å†™å®Œ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (lp) &#123;<br>        <span class="hljs-keyword">is</span> NetLayoutParams -&gt; NetLayoutParams(lp)<br>        <span class="hljs-keyword">is</span> MarginLayoutParams -&gt; NetLayoutParams(lp)<br>        <span class="hljs-keyword">else</span> -&gt; NetLayoutParams(lp)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è¿™ä¸ªæ˜¯å¾—åˆ°é»˜è®¤çš„ LayoutParams</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateDefaultLayoutParams</span><span class="hljs-params">()</span></span>: LayoutParams &#123;<br>    <span class="hljs-keyword">return</span> NetLayoutParams(<br>        NetLayoutParams.UNSET,<br>        NetLayoutParams.UNSET,<br>        NetLayoutParams.UNSET,<br>        NetLayoutParams.UNSET<br>    )<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™å‡ ä¸ªæ–¹æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ <a href="#1%E3%80%81LayoutInflater">LayoutInflater</a> è®²è§£</p>
</blockquote>
<h4 id="2ã€MeasureSpecs"><a href="#2ã€MeasureSpecs" class="headerlink" title="2ã€MeasureSpecs"></a>2ã€MeasureSpecs</h4><blockquote>
<p>æ¨èæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1260a98a09e9">https://www.jianshu.com/p/1260a98a09e9</a></p>
<p>å®ƒä¿å­˜äº†æµ‹é‡æ¨¡å¼å’Œæµ‹é‡å¤§å°</p>
<p>æ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ï¼š<code>widthMeasureSpec</code> å’Œ <code>heightMeasureSpec</code></p>
<p>å¯èƒ½ä½ ä¼šæ¯”è¾ƒç–‘æƒ‘å®ƒæ˜¯æ€ä¹ˆç”¨ä¸€ä¸ª int æ¥ä¿å­˜çš„ï¼Œå…¶å®åŸç†å¾ˆç®€å•ï¼Œå®ƒä½¿ç”¨é«˜ 2 ä½ä¿å­˜æµ‹é‡æ¨¡å¼ï¼Œå 30 ä¸ºæµ‹é‡å¤§å°</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// ä½¿ç”¨æ–¹å¼ï¼ŒåŸç†å°±æ˜¯ä½è¿ç®—</span><br><span class="hljs-keyword">val</span> wSize = MeasureSpec.getSize(widthMeasureSpec)<br><span class="hljs-keyword">val</span> wMode = MeasureSpec.getMode(widthMeasureSpec)<br></code></pre></td></tr></table></figure>

<p>æµ‹é‡æ¨¡å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>è¯´æ˜</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><em><strong>EXACTLY</strong></em></td>
<td>æœ‰å…·ä½“å€¼æ—¶</td>
<td>ä¸€èˆ¬å¯¹åº” <code>match_parent</code> å’Œå…·ä½“çš„å€¼</td>
</tr>
<tr>
<td><em><strong>AT_MOST</strong></em></td>
<td>è‡ªé€‚åº”å¤§å°</td>
<td>ä¸€èˆ¬å¯¹åº” <code>wrap_content</code></td>
</tr>
<tr>
<td><em><strong>UNSPECIFIED</strong></em></td>
<td>å¯ä»»æ„å–å€¼</td>
<td>åªå‡ºç°äº <code>ScrollView</code>ã€<code>ListView</code> è¿™ç±»æ§ä»¶ä¸­</td>
</tr>
</tbody></table>
<p>é‡å†™ ViewGroup æ—¶å°±æ˜¯é€šè¿‡è¿™äº›æ¥åˆ¤æ–­å­ View åº”è¯¥å–å¾—çš„é«˜åº¦çš„</p>
<p>å…³äºæ€ä¹ˆå–ï¼Œå¯ä»¥çœ‹è¿™ä¸ªåœ¨ ViewGroup ä¸­çš„æ–¹æ³•ï¼Œé‡Œé¢æ˜¯å¸¸è§æƒ…å†µæ—¶çš„å–æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å¾ˆå¤šå®˜æ–¹æ§ä»¶ä¸­è¢«ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> spec å­ View èƒ½å¾—åˆ°çš„ MeasureSpecsï¼Œä¸€èˆ¬æ˜¯çˆ¶ View çš„æµ‹é‡æ¨¡å¼ + æƒ³ç»™å‡ºçš„å¤§å°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> padding é—´è·å€¼ï¼Œä¸€èˆ¬è¿™æ ·å¡«å…¥ï¼šlayoutParams.leftMargin + layoutParams.rightMargin</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> childDimension å­ View çš„å®½æˆ–è€…é«˜ï¼Œå›ºå®šå¡«å…¥ï¼šchild.width æˆ–è€… child.height</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getChildMeasureSpec</span><span class="hljs-params">(<span class="hljs-type">int</span> spec, <span class="hljs-type">int</span> padding, <span class="hljs-type">int</span> childDimension)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">specMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(spec); <span class="hljs-comment">// æµ‹é‡æ¨¡å¼</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">specSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(spec); <span class="hljs-comment">// æµ‹é‡é•¿åº¦</span><br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, specSize - padding); <span class="hljs-comment">// å…ˆå‡å»é—´è·å€¼å¾—åˆ°çš„æœ€å¤§é•¿åº¦</span><br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">resultSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// ä¿å­˜æœ€åçš„é•¿åº¦å€¼</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">resultMode</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// ä¿å­˜æœ€åçš„æµ‹é‡ï¼Œæ¨¡å¼</span><br><br>    <span class="hljs-keyword">switch</span> (specMode) &#123;<br>    <span class="hljs-comment">// å¦‚æœæµ‹é‡æ¨¡å¼æ˜¯å…·ä½“å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º match_parent æˆ–è€… ç¡®å®šå€¼</span><br>    <span class="hljs-keyword">case</span> MeasureSpec.EXACTLY:<br>        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å‡è®¾å­ View å›ºå®šä¸º 100dp</span><br>            resultSize = childDimension;<br>            resultMode = MeasureSpec.EXACTLY;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ match_parent</span><br>            resultSize = size; <span class="hljs-comment">// é‚£ç»“æœå€¼å°±æ˜¯æœ€å¤§å€¼</span><br>            resultMode = MeasureSpec.EXACTLY; <span class="hljs-comment">// æµ‹é‡æ¨¡å¼ä¿æŒä¸€æ ·ï¼Œä¸ºå…·ä½“å€¼</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ wrap_content</span><br>            resultSize = size;<br>            resultMode = MeasureSpec.AT_MOST; <span class="hljs-comment">// æ”¹å˜æµ‹é‡æ¨¡å¼ä¸ºè‡ªé€‚åº”å¤§å°</span><br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br><br>    <span class="hljs-comment">// å¦‚æœæµ‹é‡æ¨¡å¼æ˜¯è‡ªé€‚åº”å¤§å°ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º wrap_content</span><br>    <span class="hljs-keyword">case</span> MeasureSpec.AT_MOST:<br>        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å‡è®¾å­ View å›ºå®šä¸º 100dp</span><br>            resultSize = childDimension;<br>            resultMode = MeasureSpec.EXACTLY;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ match_parent</span><br>            <span class="hljs-comment">// è¿™é‡Œæ¯”è¾ƒé‡è¦</span><br>            <span class="hljs-comment">// è¿™é‡Œå¯¹åº”çˆ¶ View ä¸º wrap_contentï¼Œä½†å­ View å´ä¸º match_parent</span><br>            resultSize = size; <span class="hljs-comment">// è¿™é‡Œçš„æ„æ€æ˜¯ç»™å‡ºå­ View èƒ½å¾—åˆ°çš„æœ€å¤§å€¼</span><br>            resultMode = MeasureSpec.AT_MOST;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ wrap_content</span><br>            resultSize = size;<br>            resultMode = MeasureSpec.AT_MOST;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br><br>    <span class="hljs-comment">// å¦‚æœæµ‹é‡æ¨¡å¼æ˜¯å¯ä»»æ„å–å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º ScrollView</span><br>    <span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:<br>        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å‡è®¾å­ View å›ºå®šä¸º 100dp</span><br>            resultSize = childDimension;<br>            resultMode = MeasureSpec.EXACTLY;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ match_parent</span><br>            <span class="hljs-comment">// è¿™ä¸ª sUseZeroUnspecifiedMeasureSpec å˜é‡ç”¨äºå…¼å®¹ Android æ—§ç‰ˆæœ¬</span><br>            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;<br>            resultMode = MeasureSpec.UNSPECIFIED;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>            <span class="hljs-comment">// å­ View æ˜¯ wrap_content</span><br>            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;<br>            resultMode = MeasureSpec.UNSPECIFIED;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä»¥åå¼€å‘è‡ªå®šä¹‰ ViewGroupï¼Œåœ¨ç»™å­ View æµ‹é‡æ—¶æˆ‘æ›´æ¨èä½¿ç”¨è¯¥æ–¹æ³•ï¼Œéµå¾ªå®˜æ–¹çš„å†™æ³•å¯ä»¥æé«˜å¯è¯»æ€§</p>
</blockquote>
<h4 id="3ã€onMeasure-æºç ç›¸å…³åˆ†æ"><a href="#3ã€onMeasure-æºç ç›¸å…³åˆ†æ" class="headerlink" title="3ã€onMeasure() æºç ç›¸å…³åˆ†æ"></a>3ã€onMeasure() æºç ç›¸å…³åˆ†æ</h4><h5 id="1ã€FrameLayout-çš„-onMeasure-æºç åˆ†æ"><a href="#1ã€FrameLayout-çš„-onMeasure-æºç åˆ†æ" class="headerlink" title="1ã€FrameLayout çš„ onMeasure() æºç åˆ†æ"></a>1ã€FrameLayout çš„ onMeasure() æºç åˆ†æ</h5><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¥ä¸‹æ¥æ˜¯èµ·é£ç¯èŠ‚</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> getChildCount();<br><br> <span class="hljs-comment">// åˆ¤æ–­è‡ªèº«æ˜¯å¦æœ‰ä¸€è¾¹ä¸æ˜¯å…·ä½“å€¼ï¼Œä½œç”¨å¦‚ä¸‹ï¼š</span><br> <span class="hljs-comment">// æ¯”å¦‚ FrameLayout çš„å®½æ˜¯ wrap_contentï¼Œä½†å…¶ä¸­ä¸€ä¸ªå­ View å®½ä¸º match_parent</span><br> <span class="hljs-comment">// é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ FrameLayout æ˜¯ä¸çŸ¥é“è¯¥ç»™è¿™ä¸ªå­ View å®½åº¦å¤šå°‘çš„</span><br> <span class="hljs-comment">// ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶ä»– View æ¥åˆ¤æ–­ FrameLayout èƒ½å¾—åˆ°çš„å®½åº¦</span><br> <span class="hljs-comment">// è¿™ä¸ªæ—¶å€™å°±çŸ¥é“ FraneLayout å®½åº¦å€¼èƒ½å–å¤šå°‘äº†</span><br> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">measureMatchParentChildren</span> <span class="hljs-operator">=</span><br>         MeasureSpec.getMode(widthMeasureSpec) != MeasureSpec.EXACTLY ||<br>         MeasureSpec.getMode(heightMeasureSpec) != MeasureSpec.EXACTLY;<br> <span class="hljs-comment">// è¿™ä¸ªæ˜¯ä¿å­˜ä¸Šè¿°æ‰€è¯´çš„é‚£ç§å­ Viewï¼Œç”¨äºäºŒæ¬¡æµ‹é‡</span><br> mMatchParentChildren.clear(); <br><br> <span class="hljs-type">int</span> <span class="hljs-variable">maxHeight</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br> <span class="hljs-type">int</span> <span class="hljs-variable">maxWidth</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br> <span class="hljs-comment">// çŠ¶æ€å€¼ï¼Œç”¨æ¥è®°å½•å­ View æ˜¯å¦å¾—åˆ°äº†æƒ³è¦çš„å¤§å°ï¼Œç”¨çš„å¾ˆå°‘ï¼Œå¿½ç•¥å³å¯</span><br> <span class="hljs-type">int</span> <span class="hljs-variable">childState</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <br><br> <span class="hljs-comment">// éå†æ‰€æœ‰å­ View</span><br> <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>     <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(i);<br>     <span class="hljs-comment">// è¿™ä¸ª mMeasureAllChildren æ˜¯ä¸€ä¸ªå±æ€§ï¼Œä½œç”¨ï¼šæ˜¯å¦å¿½ç•¥ Gone çš„å½±å“</span><br>     <span class="hljs-comment">// child.getVisibility() != GONEï¼šGone æ—¶ä¸æµ‹é‡å­ View</span><br>     <span class="hljs-comment">// è¿™ä¸ª Gone æ—¶å†è‡ªå·±å†™è‡ªå®šä¹‰ View å»ºè®®ä¹Ÿåˆ¤æ–­ä¸Š</span><br>     <span class="hljs-keyword">if</span> (mMeasureAllChildren || child.getVisibility() != GONE) &#123;<br>         <span class="hljs-comment">// measureChildWithMargins() é‡Œé¢è°ƒç”¨äº†æµ‹é‡å­ View çš„æ–¹æ³•</span><br>         <span class="hljs-comment">// ä¹‹åä¼šæåˆ°è¯¥æ–¹æ³•ï¼Œä½ åªéœ€è¦çŸ¥é“è°ƒç”¨åå¯ä»¥å¾—åˆ°å­ View æµ‹é‡çš„å®½å’Œé«˜</span><br>         <span class="hljs-comment">// ä½†è¿™ä¸ªå®½å’Œé«˜ä¸æ˜¯ width å’Œ heightï¼Œè€Œæ˜¯ measuredWidth å’Œ measuredHeight</span><br>         measureChildWithMargins(child, widthMeasureSpec, <span class="hljs-number">0</span>, heightMeasureSpec, <span class="hljs-number">0</span>);<br>         <span class="hljs-comment">// å¾—åˆ° LayoutParamsï¼Œä¸»è¦æ˜¯ä»é‡Œé¢å–å¾—å®šä¹‰çš„ Margin å€¼</span><br>         <span class="hljs-keyword">final</span> <span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (LayoutParams) child.getLayoutParams();<br>         <span class="hljs-comment">// ä¿å­˜å­ View ä¸­æœ€å¤§çš„å®½åº¦</span><br>         maxWidth = Math.max(maxWidth,<br>                 child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin);<br>         <span class="hljs-comment">// ä¿å­˜å­ View ä¸­æœ€å¤§çš„é«˜åº¦</span><br>         maxHeight = Math.max(maxHeight,<br>                 child.getMeasuredHeight() + lp.topMargin + lp.bottomMargin);<br>         <span class="hljs-comment">// çŠ¶æ€å€¼ï¼Œå¿½ç•¥å³å¯ï¼Œåœ¨ ViewRootImpl ä¸­æœ‰ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è‡ªå®šä¹‰ View ä¸ç”¨</span><br>         childState = combineMeasuredStates(childState, child.getMeasuredState());<br>         <span class="hljs-comment">// æœ€å¼€å§‹çš„é‚£ä¸ª boolean å€¼ï¼Œç”¨æ¥ä¿å­˜æ˜¯ match_parent çš„ View</span><br>         <span class="hljs-keyword">if</span> (measureMatchParentChildren) &#123;<br>             <span class="hljs-keyword">if</span> (lp.width == LayoutParams.MATCH_PARENT ||<br>                     lp.height == LayoutParams.MATCH_PARENT) &#123;<br>                 mMatchParentChildren.add(child);<br>             &#125;<br>         &#125;<br>     &#125;<br> &#125;<br><br> <span class="hljs-comment">// æœ€å¤§å€¼åŠ ä¸Š padding å€¼</span><br> <span class="hljs-comment">// getPadding*WithForeground() æ˜¯å†…éƒ¨æ–¹æ³•ï¼Œæˆ‘ä»¬è‡ªå·±ç”¨æ—¶æ˜¯ä½¿ç”¨ getPadding*() ä»£æ›¿</span><br> maxWidth += getPaddingLeftWithForeground() + getPaddingRightWithForeground();<br> maxHeight += getPaddingTopWithForeground() + getPaddingBottomWithForeground();<br><br> <span class="hljs-comment">// æ£€æŸ¥æœ€å°å€¼çš„è®¾ç½®</span><br> <span class="hljs-comment">// View éƒ½è‡ªå¸¦äº†ä¸€ä¸ª android:minHeight å±æ€§ï¼Œè‡ªå·±è‡ªå®šä¹‰ View æ—¶å»ºè®®æŠŠè¿™ä¸ªé€‚é…ä¸€ä¸‹</span><br> maxHeight = Math.max(maxHeight, getSuggestedMinimumHeight());<br> maxWidth = Math.max(maxWidth, getSuggestedMinimumWidth());<br><br> <span class="hljs-comment">// å¾—åˆ°å‰å°çš„èƒŒæ™¯å›¾ï¼Œå†ä¸æœ€å¤§å€¼æ¯”è¾ƒ</span><br> <span class="hljs-keyword">final</span> <span class="hljs-type">Drawable</span> <span class="hljs-variable">drawable</span> <span class="hljs-operator">=</span> getForeground();<br> <span class="hljs-keyword">if</span> (drawable != <span class="hljs-literal">null</span>) &#123;<br>     maxHeight = Math.max(maxHeight, drawable.getMinimumHeight());<br>     maxWidth = Math.max(maxWidth, drawable.getMinimumWidth());<br> &#125;<br><br> <span class="hljs-comment">// å…³é”®æ–¹æ³•ï¼Œè°ƒç”¨ setMeasuredDimension() è®¾ç½®è‡ªèº«å®½å’Œé«˜</span><br> setMeasuredDimension(resolveSizeAndState(maxWidth, widthMeasureSpec, childState),<br>         resolveSizeAndState(maxHeight, heightMeasureSpec,<br>                 childState &lt;&lt; MEASURED_HEIGHT_STATE_SHIFT));<br><br> <span class="hljs-comment">// åœ¨ä¸Šé¢é‚£ä¸ªè°ƒç”¨è¿‡åï¼Œå°±èƒ½å¾—åˆ°è‡ªèº«çš„å®½å’Œé«˜äº†</span><br> <span class="hljs-comment">// ç„¶åè¿™é‡Œå†é‡å†™æµ‹é‡ä¸º match_parent çš„ View</span><br> count = mMatchParentChildren.size();<br> <span class="hljs-comment">// è¿™ä¸ª count åˆ¤æ–­æˆ‘ä¸ªäººæ„Ÿè§‰æœ‰ç‚¹é—®é¢˜</span><br> <span class="hljs-comment">// count æ˜¯æŒ‡ä¸º match_parent View çš„æ•°é‡ï¼Œ</span><br> <span class="hljs-comment">// è€Œå¦‚æœæˆ‘åªæœ‰ä¸€ä¸ª View æ˜¯ match_parentï¼Œé‚£å®ƒä¸æ˜¯å°±ä¸ä¼šé‡æ–°æµ‹é‡äº†å—ï¼Ÿ</span><br> <span class="hljs-comment">// çœŸå¥‡æ€ªï¼Œæˆ‘æ„Ÿè§‰è¯¥ç”¨ childCount</span><br> <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">1</span>) &#123;<br>     <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>         <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> mMatchParentChildren.get(i);<br>         <span class="hljs-keyword">final</span> <span class="hljs-type">MarginLayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (MarginLayoutParams) child.getLayoutParams();<br><br>         <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> childWidthMeasureSpec;<br>         <span class="hljs-keyword">if</span> (lp.width == LayoutParams.MATCH_PARENT) &#123;<br>             <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, getMeasuredWidth()<br>                        - getPaddingLeftWithForeground() - getPaddingRightWithForeground()<br>                        - lp.leftMargin - lp.rightMargin);<br>                childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(<br>                        width, MeasureSpec.EXACTLY);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,<br>                        getPaddingLeftWithForeground() + getPaddingRightWithForeground() +<br>                        lp.leftMargin + lp.rightMargin,<br>                        lp.width);<br>            &#125;<br><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> childHeightMeasureSpec;<br>            <span class="hljs-keyword">if</span> (lp.height == LayoutParams.MATCH_PARENT) &#123;<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, getMeasuredHeight()<br>                        - getPaddingTopWithForeground() - getPaddingBottomWithForeground()<br>                        - lp.topMargin - lp.bottomMargin);<br>                childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(<br>                        height, MeasureSpec.EXACTLY);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,<br>                        getPaddingTopWithForeground() + getPaddingBottomWithForeground() +<br>                        lp.topMargin + lp.bottomMargin,<br>                        lp.height);<br>            &#125;<br>            <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å‘ç° onMeasure() ä¸æ­¢ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæœ‰æ—¶å€™éœ€è¦è°ƒç”¨å¤šæ¬¡æ‰èƒ½æµ‹é‡å®Œæˆ </span><br>            child.measure(childWidthMeasureSpec, childHeightMeasureSpec);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>


</blockquote>
<h5 id="2ã€NestedScrollView-åµŒå¥—-Rv-å¤ç”¨å¤±æ•ˆ"><a href="#2ã€NestedScrollView-åµŒå¥—-Rv-å¤ç”¨å¤±æ•ˆ" class="headerlink" title="2ã€NestedScrollView åµŒå¥— Rv å¤ç”¨å¤±æ•ˆ"></a>2ã€NestedScrollView åµŒå¥— Rv å¤ç”¨å¤±æ•ˆ</h5><blockquote>
<p>æ¥ä¸‹æ¥å¼€å§‹åšç«ç®­</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æˆ‘å¯’å‡æ—¶å¤šæ¬¡æåˆ° NestedScrollView åµŒå¥— Rvï¼Œå¯¼è‡´ Rv å¤ç”¨å¤±æ•ˆçš„é—®é¢˜ï¼Œç½‘ä¸Šæˆ‘è¿˜æ²¡æœ‰çœ‹è¿‡å¾ˆè¯¦ç»†çš„ä»æºç è§’åº¦æ¥åˆ†æçš„æ–‡ç« </p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æƒ³æƒ³é—®ä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ</p>
<p>å¤±æ•ˆè¯´æ˜ Rv æŠŠå…¨éƒ¨å­ View éƒ½æµ‹é‡å®Œäº†ï¼Œé‚£è¯´æ˜è‚¯å®šæ˜¯ <code>onMeasure()</code> çš„é—®é¢˜ï¼Œokï¼Œé‚£æˆ‘ä»¬æ¥ debug ä¸€ä¸‹ <code>onMeasure()</code> çš„æ•´ä¸ªæµç¨‹</p>
<h5 id="é¦–å…ˆä»-NestedScrollView-çš„-onMeasure-å¼€å§‹-debug"><a href="#é¦–å…ˆä»-NestedScrollView-çš„-onMeasure-å¼€å§‹-debug" class="headerlink" title="é¦–å…ˆä» NestedScrollView çš„ onMeasure() å¼€å§‹ debug"></a>é¦–å…ˆä» NestedScrollView çš„ onMeasure() å¼€å§‹ debug</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321225743926.png" srcset="/img/loading.gif" lazyload alt="image-20220321225743926"></p>
<p>å¯ä»¥å‘ç° NestedScrollView æŠŠæµ‹é‡ç›´æ¥äº¤ç»™äº†çˆ¶ç±» FrameLayout å¤„ç†ï¼Œï¼ˆä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¸é‡å†™ <code>onMeasure()</code> é‚£ NestedScrollView æ˜¯æ€ä¹ˆå®ç°ä¸åŒäºå…¶ä»– View æµ‹é‡çš„ï¼Ÿè¿™ä¸ªé—®é¢˜åœ¨ä¸‹é¢ä¼šè®²è§£ï¼‰</p>
<p>åˆç”±äº <code>mFillViewport</code> ä¸º <code>false</code>ï¼Œå°±ç›´æ¥ return äº†ï¼Œè‡³äº <code>mFillViewport</code> æ˜¯ä»€ä¹ˆæˆ‘ä»¬åé¢ä¼šè®²è§£</p>
</blockquote>
<h5 id="æ¥åˆ°-FrameLayout-çš„-onMeasure-å®ç°"><a href="#æ¥åˆ°-FrameLayout-çš„-onMeasure-å®ç°" class="headerlink" title="æ¥åˆ° FrameLayout çš„ onMeasure() å®ç°"></a>æ¥åˆ° FrameLayout çš„ onMeasure() å®ç°</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230004519.png" srcset="/img/loading.gif" lazyload alt="image-20220321230004519"></p>
<p>è¿™é‡Œåªæœ‰ä¸€ä¸ª Viewï¼Œå°±æ˜¯ Rvï¼Œç„¶å FrameLayout è°ƒç”¨äº† <code>measureChildWithMargins(child, widthMeasureSpec, 0, heightMeasureSpec, 0)</code>ï¼Œè¿™ä¸ªå‡½æ•°è¢« NestedScrollView é‡å†™äº†ï¼Œç„¶åç»™å‡ºäº†ä¸€ä¸ª <code>MeasureSpec.UNSPECIFIED</code>ï¼Œè¿™å°±æ˜¯ NestedScrollView ä¸åŒäºå…¶ä»– View æµ‹é‡çš„åŸå› </p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230432739.png" srcset="/img/loading.gif" lazyload alt="image-20220321230432739"></p>
<p>ä»”ç»†çœ‹çº¢çº¿å¤„ï¼Œè¿™é‡Œå®ƒç»™å‡ºçš„é«˜åº¦ç«Ÿç„¶ç›´æ¥ä¸º <code>lp.topMargin + lp.bottomMargin</code>ï¼Œå¯èƒ½ä½ ä¸ä¼šæ„è¯†åˆ°è¿™ä¸ªæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ NestedScrollView çš„å­ªç”Ÿå…„å¼Ÿ ScrollView å¯¹äºè¯¥æ–¹æ³•çš„å®ç°</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png" srcset="/img/loading.gif" lazyload alt="image-20220321230936516"></p>
<p>å‘ç°ä¸åŒäº†å—ï¼ŒScrollView æœ‰ä¸ª <code>parentHeightMeasureSpec</code> çš„é«˜åº¦ï¼Œè€Œ NestedScrollView åªä½¿ç”¨äº† <code>lp.topMargin + lp.bottomMargin</code>ï¼Œå¦‚æœå­ View æ²¡å¾— margin å€¼ï¼Œé‚£ä¸å°±ç›´æ¥ç»™å­ View ä¼ å…¥çš„é«˜åº¦ä¸º 0 äº†ï¼Ÿ</p>
<p>NestedScrollView ä¸ ScrollView åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šçš„ä¸åŒï¼Œå°±æ˜¯é€ æˆ Rv å¤ç”¨å¤±æ•ˆçš„ç›´æ¥åŸå› ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¢ç©¶ä¸€ä¸‹æ ¹æœ¬åŸå› </p>
</blockquote>
<h5 id="æ¥åˆ°-Rv-çš„-onMeasure"><a href="#æ¥åˆ°-Rv-çš„-onMeasure" class="headerlink" title="æ¥åˆ° Rv çš„ onMeasure"></a>æ¥åˆ° Rv çš„ onMeasure</h5><blockquote>
<p>ç´§æ¥ç€ä¸Šé¢ç»§ç»­ debugï¼Œæˆ‘ä»¬æ¥åˆ°äº† Rv çš„ <code>onMeasure()</code> å®ç°</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231555746.png" srcset="/img/loading.gif" lazyload alt="image-20220321231555746"></p>
<p>å¯ä»¥å‘ç°è¿™é‡Œ <code>heightSpec</code> ä¸º 0</p>
</blockquote>
<h5 id="æ¥åˆ°-dispatchLayoutStep2-æ–¹æ³•"><a href="#æ¥åˆ°-dispatchLayoutStep2-æ–¹æ³•" class="headerlink" title="æ¥åˆ° dispatchLayoutStep2() æ–¹æ³•"></a>æ¥åˆ° dispatchLayoutStep2() æ–¹æ³•</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231735164.png" srcset="/img/loading.gif" lazyload alt="image-20220321231735164"></p>
<p>å‰é¢é‚£ä¸ª <code>dispatchLayoutStrp1()</code> å› ä¸ºä¸å¤„äº <code>State.STEP_START</code> è€Œè·³è¿‡äº†</p>
</blockquote>
<h5 id="å‘ç°-mLayout-onLayoutChildren"><a href="#å‘ç°-mLayout-onLayoutChildren" class="headerlink" title="å‘ç° mLayout.onLayoutChildren()"></a>å‘ç° mLayout.onLayoutChildren()</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321232502431.png" srcset="/img/loading.gif" lazyload alt="image-20220321232502431"></p>
<p>æ•´ä¸ª <code>dispatchLayoutChild2()</code> ä¸€çœ‹å°±åªæœ‰è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºå¸ƒå±€çš„ï¼Œdebug è¿›å»è¯•è¯•</p>
</blockquote>
<h5 id="æ¢ç´¢-onLayoutChild-æ–¹æ³•"><a href="#æ¢ç´¢-onLayoutChild-æ–¹æ³•" class="headerlink" title="æ¢ç´¢ onLayoutChild() æ–¹æ³•"></a>æ¢ç´¢ onLayoutChild() æ–¹æ³•</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233030377.png" srcset="/img/loading.gif" lazyload alt="image-20220321233030377"></p>
<p>å‰é¢æœ‰ä¸€å †æ–¹æ³•ï¼Œä½†å…¶å® Rv æ˜¯è°ƒç”¨è¿™ä¸ª <code>fill()</code> æ¥ç»™å­ View å¸ƒå±€çš„</p>
</blockquote>
<h5 id="æ¢ç´¢-fill"><a href="#æ¢ç´¢-fill" class="headerlink" title="æ¢ç´¢ fill()"></a>æ¢ç´¢ fill()</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233713916.png" srcset="/img/loading.gif" lazyload alt="image-20220321233713916"></p>
<p>è¿™ä¸ª while å¾ˆé‡è¦ï¼Œå°±æ˜¯ä¾é è¿™ä¸ªå¾ªç¯æ¥æµ‹é‡å­ View çš„ï¼Œè™½ç„¶ä½ åº”è¯¥çœ‹çš„å¾ˆæ‡µé€¼ï¼Œä½†è¯·è®°ä½è¿™ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<p><code>layoutState.mInfinite = true</code> å’Œ <code>remainingSpace = 0</code>ï¼Œåé¢çš„ <code>layoutState.hasMore(state)</code> æ˜¯ç”¨äºåˆ¤æ–­æ¬¡æ•°æ˜¯å¦è¾¾åˆ° ItemCount çš„ï¼Œå¯ä»¥ä¸ç”¨ç®¡</p>
<p>è¿™é‡Œå°±ç›´æ¥å‘Šè¯‰ä½ ç»“è®ºï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ª <code>layoutState.mInfinite = true</code> å¯¼è‡´å®ƒä¸€ç›´æ‰§è¡Œå¾ªç¯ï¼Œç„¶åä¸€ç›´åˆ° <code>layoutState.hasMore(state) = false</code> æ‰ç»“æŸï¼Œå³æŠŠ ItemCount ä¸ª item éƒ½æµ‹é‡å®Œäº†</p>
<p>å¾ˆæ‡µé€¼æ˜¯ä¸æ˜¯ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœä½¿ç”¨ ScrollView åŒ…è£¹è¿è¡Œåˆ°è¿™é‡Œæ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234733578.png" srcset="/img/loading.gif" lazyload alt="image-20220321234733578"></p>
<p>çœ‹åˆ°åŒºåˆ«äº†å§ï¼Œä½¿ç”¨ ScrollView æ—¶ä¼šä¸ä¸€æ ·ï¼Œå…¶ä¸­ <code>layoutState.mInfinite = false</code> å’Œ <code>remainingSpace = 1868</code> </p>
<p>å¦‚æœä½¿ç”¨ ScrollView ç»§ç»­å¾€ä¸‹èµ°</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234928364.png" srcset="/img/loading.gif" lazyload alt="image-20220321234928364"></p>
<p>ä»–ä¼šåœ¨è¿™ä¸ªåœ°æ–¹å‡å°‘ <code>remainingSpace</code> çš„å€¼ï¼Œæœ€åå°±å¯ä»¥ä½¿ while å¾ªç¯æå‰é€€å‡ºäº†</p>
</blockquote>
<p>OKï¼ŒåŸºæœ¬ä¸Šæ ¹æœ¬åŸå› æ‰¾åˆ°äº†ï¼Œä½†ä¸ºä»€ä¹ˆé‚£ä¸ª <code>layoutState.mInfinite = true</code> ä¸” <code>remainingSpace = 0</code> å‘¢ï¼Ÿ</p>
<p>ç»§ç»­åˆ†æ</p>
<h5 id="ä¸ºä»€ä¹ˆ-layoutState-mInfinite-x3D-true"><a href="#ä¸ºä»€ä¹ˆ-layoutState-mInfinite-x3D-true" class="headerlink" title="ä¸ºä»€ä¹ˆ layoutState.mInfinite &#x3D; true ?"></a>ä¸ºä»€ä¹ˆ layoutState.mInfinite &#x3D; true ?</h5><blockquote>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235408579.png" srcset="/img/loading.gif" lazyload alt="image-20220321235408579"></p>
<p>ç‚¹å‡» <code>layoutState.mInfinite</code>ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° <code>mLayoutState.mInfinite</code> åœ¨è¿™é‡Œè¢«èµ‹å€¼</p>
<p>ç‚¹è¿›å»çœ‹çœ‹å®ƒèµ‹çš„ä»€ä¹ˆå€¼</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235709470.png" srcset="/img/loading.gif" lazyload alt="image-20220321235709470"></p>
<p>ç¬¬ä¸€ä¸ª <code>getMode() == View.MeasureSpec.UNSPECIFIED</code> è‚¯å®šæ˜¯ <code>true</code>ï¼Œå› ä¸ºå¤–å¸ƒå±€æ˜¯ NestedScrollView å˜›ï¼Œå‰é¢æåˆ°äº†å®ƒé‡å†™äº† FrameLayout çš„ <code>measureChildWithMargins()</code> æ–¹æ³•ï¼Œç»™çš„å­ View çš„æµ‹é‡æ¨¡å¼æ˜¯ <code>MeasureSpec.UNSPECIFIED</code> ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­ <code>mOrientationHelper.getEnd() == 0</code>ï¼Œæ ¹æ® debug å¯ä»¥å¾—åˆ°å€¼ä¹Ÿä¸º <code>true</code></p>
<p>ç»§ç»­è·Ÿè¸ª <code>mOrientationHelper.getEnd() == 0</code> çš„åŸå› </p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000124439.png" srcset="/img/loading.gif" lazyload alt="image-20220322000124439"></p>
<p>å¯ä»¥å‘ç°å®ƒç›´æ¥è°ƒç”¨äº† <code>mLayoutManger.getHeight()</code>ï¼Œç»§ç»­</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000411111.png" srcset="/img/loading.gif" lazyload alt="image-20220322000411111"></p>
<p><code>mHeight</code> è¢«ä¿®æ”¹çš„åœ°æ–¹å¦‚ä¸‹</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000630000.png" srcset="/img/loading.gif" lazyload alt="image-20220322000630000"></p>
<p>å…¶ä¸­å‰é¢ä¸¤ä¸ªæ˜¯ <code>setRecyclerView()</code> æ˜¯åœ¨ Rv æ·»åŠ  Adapter æ—¶è®¾ç½®çš„åˆå§‹å€¼ï¼Œè‚¯å®šä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„åœ°æ–¹ï¼Œé‚£åªèƒ½æ˜¯ <code>setMeasureSpecs()</code> äº†</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000826091.png" srcset="/img/loading.gif" lazyload alt="image-20220322000826091"></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ª <code>mHeight = 0</code> çš„æ“ä½œï¼Œç‚¹å‡»æ–¹æ³•åç§°çœ‹çœ‹æ˜¯è°è°ƒç”¨äº†å®ƒ</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000941813.png" srcset="/img/loading.gif" lazyload alt="image-20220322000941813"></p>
<p>è¿æ°”çœŸå¥½ï¼Œåˆšå¥½å›åˆ°äº†æˆ‘ä»¬ä¹‹å‰å¤§çš„æ–­ç‚¹å‰ï¼Œé‚£åªèƒ½è¯´æ˜å°±æ˜¯åœ¨è¿™é‡Œè°ƒç”¨çš„ï¼Œæ‰€ä»¥ <code>mHeight = 0</code>ï¼Œå¯¼è‡´å‰é¢çš„ <code>mOrientationHelper.getEnd() == 0</code> ä¸º <code>true</code>ï¼Œæœ€åå¯¼è‡´ <code>layoutState.mInfinite</code> ä¸º <code>true</code> äº† </p>
</blockquote>
<h5 id="ä¸ºä»€ä¹ˆ-remainingSpace-x3D-0ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-remainingSpace-x3D-0ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ remainingSpace &#x3D; 0ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ remainingSpace &#x3D; 0ï¼Ÿ</h5><blockquote>
<p>å¦‚æœä½ å¤§èƒ†çŒœæµ‹çš„è¯ï¼Œåº”è¯¥èƒ½çŒœåˆ°è‚¯å®šä¸ <code>mHeight</code> æœ‰å…³ç³»</p>
<p>å…ˆæ¥åˆ°è¿™é‡Œ</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322001506870.png" srcset="/img/loading.gif" lazyload alt="image-20220322001506870"></p>
<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ <code>remainingSpace</code> ç”± <code>layoutState.mAvailable + layoutState.mExtraFillSpace</code> ç»„æˆï¼Œå…¶ä¸­é€šè¿‡æŸ¥çœ‹æ³¨é‡Šå¯ä»¥çŸ¥é“è·Ÿ <code>layoutState.mExtraFillSpace</code> æ²¡æœ‰å…³ç³»ï¼Œé‚£å°±å»å¯»æ‰¾ <code>layoutState.mAvailable</code> å§</p>
<p>å¯æ˜¯ <code>layoutState.mAvailable</code> è¢«æ”¹å˜çš„åœ°æ–¹æœ‰ç‚¹å¤šï¼Œä¸æ˜¯å¾ˆå¥½å®šä½ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯•è¯•ç»™è¿™ä¸ªå˜é‡æ‰“ä¸Šæ–­ç‚¹ï¼Œé‡æ–°èµ°ä¸€ä¸‹æµç¨‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é‡æ–° debug ä¸€é</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002054498.png" srcset="/img/loading.gif" lazyload alt="image-20220322002054498"></p>
<p>ä¸€ä¸‹å­å°±æ‰¾åˆ°äº†ï¼Œä¸å¾—ä¸è¯´ debug ç¡®å®å¾ˆæ–¹ä¾¿</p>
<p>ç‚¹å‡»å»çœ‹ä¸€ä¸‹ <code>mOrientationHelper.getEndAfterPadding()</code> æ–¹æ³•</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002252433.png" srcset="/img/loading.gif" lazyload alt="image-20220322002252433"></p>
<p>æœç„¶ï¼Œè·Ÿæœ€å¼€å§‹çš„çŒœæµ‹ä¸€æ ·ï¼Œå®ƒä¸ <code>mHeight</code> æœ‰å…³ç³»</p>
<p>é‚£ <code>updateLayoutStateToFillEnd()</code> æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿ</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002424079.png" srcset="/img/loading.gif" lazyload alt="image-20220322002424079"></p>
<p>ä»è°ƒç”¨æ ˆå‘ç°åŸæ¥ä»–åœ¨ <code>fill()</code> æ–¹æ³•å‰è¢«è°ƒç”¨äº†</p>
<p>OKï¼Œè¿™ä¸‹å­ NestedScrollView åµŒå¥— Rv ä½¿å¤ç”¨å¤±æ•ˆçš„æ ¹æœ¬åŸå› å’Œå†³å®šæ€§å› ç´ éƒ½æ‰¾åˆ°äº†</p>
</blockquote>
<h3 id="å¦‚ä½•è§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Ÿ"></a>å¦‚ä½•è§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Ÿ</h3><p>æ ¹æ®ä¸Šé¢çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸‹é¢è¿™å‡ ç§æ–¹æ³•ï¼š</p>
<h5 id="1ã€é‡å†™-NestedScrollView-çš„-measureChildWithMargins-æ–¹æ³•"><a href="#1ã€é‡å†™-NestedScrollView-çš„-measureChildWithMargins-æ–¹æ³•" class="headerlink" title="1ã€é‡å†™ NestedScrollView çš„ measureChildWithMargins() æ–¹æ³•"></a>1ã€é‡å†™ NestedScrollView çš„ <code>measureChildWithMargins()</code> æ–¹æ³•</h5><blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é‡å†™è¯¥æ–¹æ³•çš„å‡ ä¸ªåŸå› ï¼š</span><br><span class="hljs-comment"> * 1ã€ä¸ºäº†åœ¨ UNSPECIFIED æ¨¡å¼ä¸‹ï¼ŒRv ä¹Ÿèƒ½å¾—åˆ° NestedScrollView çš„é«˜åº¦</span><br><span class="hljs-comment"> * 2ã€NestedScrollView ä¸ ScrollView åœ¨å¯¹äºå­ View é«˜åº¦å¤„ç†æ—¶åœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¸ä¸€æ ·, å¯¼è‡´</span><br><span class="hljs-comment"> *    NestedScrollView ä¸­å­ View å¿…é¡»ä½¿ç”¨å…·ä½“çš„é«˜åº¦, è®¾ç½®æˆ wrap_content æˆ– match_parent</span><br><span class="hljs-comment"> *    éƒ½å°†æ— æ•ˆï¼Œå…·ä½“çš„å¯ä»¥å»çœ‹ ScrollView å’Œ NestedScrollView ä¸­å¯¹äºè¿™åŒä¸€æ–¹æ³•çš„æºç </span><br><span class="hljs-comment"> * 3ã€åœ¨ NestedScrollView ä¸­åµŒå¥— RecyclerView ä¼šä½¿ RecyclerView çš„æ‡’åŠ è½½å¤±æ•ˆï¼Œç›´æ¥åŸå› å°±ä¸</span><br><span class="hljs-comment"> *    è¿™ä¸ªæ–¹æ³•æœ‰å…³ï¼Œè€Œä½¿ç”¨ ScrollView å°±ä¸ä¼šé€ æˆæ‡’åŠ è½½å¤±æ•ˆçš„æƒ…å†µ</span><br><span class="hljs-comment"> * 4ã€è‡³äºä¸ºä»€ä¹ˆ NestedScrollView ä¸ ScrollView åœ¨è¯¥æ–¹æ³•ä¸åŒï¼Œæˆ‘çŒœæµ‹åŸå› æ˜¯ä¸ºäº†å…¼å®¹ä»¥å‰çš„ Android ç‰ˆæœ¬ï¼Œ</span><br><span class="hljs-comment"> *    åœ¨ ViewGroup#getChildMeasureSpec() æ–¹æ³•ä¸­å¯ä»¥å‘ç°ä½¿ç”¨äº†</span><br><span class="hljs-comment"> *    ä¸€ä¸ªé™æ€å˜é‡ sUseZeroUnspecifiedMeasureSpec</span><br><span class="hljs-comment"> *    æ¥åˆ¤æ–­ UNSPECIFIED æ¨¡å¼ä¸‹å­ View è¯¥å¾—åˆ°çš„å¤§å°ï¼Œä½†å¯èƒ½è®¾è®¡ NestedScrollView â€œå·æ‡’â€äº†ï¼Œ</span><br><span class="hljs-comment"> *    æ²¡æœ‰åŠ è¿™ä¸ªä¸œè¥¿ï¼Œå…·ä½“åŸå› ä¸çŸ¥</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">measureChildWithMargins</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    child: <span class="hljs-type">View</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">    parentWidthMeasureSpec: <span class="hljs-type">Int</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">    widthUsed: <span class="hljs-type">Int</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">    parentHeightMeasureSpec: <span class="hljs-type">Int</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">    heightUsed: <span class="hljs-type">Int</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span> &#123;<br>    <span class="hljs-keyword">val</span> lp = child.layoutParams <span class="hljs-keyword">as</span> MarginLayoutParams<br><br>    <span class="hljs-keyword">val</span> childWidthMeasureSpec = getChildMeasureSpec(<br>        parentWidthMeasureSpec,<br>        paddingLeft + paddingRight + lp.leftMargin + lp.rightMargin<br>                + widthUsed, lp.width<br>    )<br>    <span class="hljs-comment">// è¿™é‡Œçš„å†™æ³•ä¸ ScrollView é‡Œé¢çš„ä¸€æ ·</span><br>    <span class="hljs-keyword">val</span> usedTotal = paddingTop + paddingBottom + lp.topMargin + lp.bottomMargin + heightUsed<br>    <span class="hljs-keyword">val</span> childHeightMeasureSpec: <span class="hljs-built_in">Int</span> = MeasureSpec.makeMeasureSpec(<br>        max(<span class="hljs-number">0</span>, MeasureSpec.getSize(parentHeightMeasureSpec) - usedTotal),<br>        MeasureSpec.UNSPECIFIED<br>    )<br><br>    child.measure(childWidthMeasureSpec, childHeightMeasureSpec)<br>&#125;<br></code></pre></td></tr></table></figure>
</blockquote>
<h5 id="2ã€ç›´æ¥ç»™-Rv-è®¾ç½®å›ºå®šé«˜åº¦"><a href="#2ã€ç›´æ¥ç»™-Rv-è®¾ç½®å›ºå®šé«˜åº¦" class="headerlink" title="2ã€ç›´æ¥ç»™ Rv è®¾ç½®å›ºå®šé«˜åº¦"></a>2ã€ç›´æ¥ç»™ Rv è®¾ç½®å›ºå®šé«˜åº¦</h5><blockquote>
<p>è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥ç›´æ¥ä¿®æ”¹ <code>mHeight</code> çš„å€¼ï¼Œä»ä¹‹å‰çš„åˆ†æä¸­å¯ä»¥å¾—åˆ°<code>layoutState.mInfinite</code> å’Œ <code>remainingSpace</code> éƒ½ä¸ <code>mHeight</code> æœ‰å…³ï¼Œæ‰€ä»¥ä¿®æ”¹ <code>mHeight</code> å°±å¯ä»¥ä»æ ¹æºä¸Šè§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜</p>
</blockquote>
<h5 id="3ã€ä½¿ç”¨-mFillViewport-å±æ€§ï¼Œä½†éœ€è¦-NsetedScrollView-çš„-layout-height-x3D-match-parent-æˆ–-ç¡®å®šå€¼"><a href="#3ã€ä½¿ç”¨-mFillViewport-å±æ€§ï¼Œä½†éœ€è¦-NsetedScrollView-çš„-layout-height-x3D-match-parent-æˆ–-ç¡®å®šå€¼" class="headerlink" title="3ã€ä½¿ç”¨ mFillViewport å±æ€§ï¼Œä½†éœ€è¦ NsetedScrollView çš„ layout_height &#x3D; match_parent æˆ– ç¡®å®šå€¼"></a>3ã€ä½¿ç”¨ mFillViewport å±æ€§ï¼Œä½†éœ€è¦ NsetedScrollView çš„ layout_height &#x3D; match_parent æˆ– ç¡®å®šå€¼</h5><blockquote>
<p>å‰é¢åœ¨ <code>onMeasure()</code> æåˆ°äº†ä¸€ä¸ª <code>mFillViewport</code> å˜é‡</p>
<p>è¿™æ˜¯å®ƒçš„å®˜æ–¹è§£é‡Šï¼š</p>
<blockquote>
<p>è®¾ç½®æ­¤ ScrollView æ˜¯å¦åº”æ‹‰ä¼¸å…¶å†…å®¹é«˜åº¦ä»¥å¡«å……è§†å£</p>
</blockquote>
<p>å®ƒå¯¹åº”è¿™ä¸ªå±æ€§ï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322003418726.png" srcset="/img/loading.gif" lazyload alt="image-20220322003418726"></p>
<p>ä½†å†æ¬¡ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ï¼Œè®¾ç½®ä¸º <code>true</code> å <code>onMeasure()</code> å¹²äº†äº›ä»€ä¹ˆä¸œè¥¿</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);<br>    <span class="hljs-comment">// mFillViewport ä¸º true ä¸ä¼šè¢« return äº†</span><br>    <span class="hljs-keyword">if</span> (!mFillViewport) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">heightMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(heightMeasureSpec);<br>    <span class="hljs-keyword">if</span> (heightMode == MeasureSpec.UNSPECIFIED) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (getChildCount() &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">final</span> NestedScrollView.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (LayoutParams) child.getLayoutParams();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">childSize</span> <span class="hljs-operator">=</span> child.getMeasuredHeight();<br>        <br>        <span class="hljs-comment">// å…³é”®åœ¨äºè¿™é‡Œï¼Œå¾—åˆ°è‡ªèº«çš„æµ‹é‡é«˜åº¦</span><br>        <span class="hljs-comment">// è¿™ä¸ªæµ‹é‡é«˜åº¦æ˜¯ä¹‹å‰è°ƒç”¨ super.onMeasure() è€Œè®¾ç½®çš„</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">parentSpace</span> <span class="hljs-operator">=</span> getMeasuredHeight()<br>                - getPaddingTop()<br>                - getPaddingBottom()<br>                - lp.topMargin<br>                - lp.bottomMargin;<br><br>        <span class="hljs-keyword">if</span> (childSize &lt; parentSpace) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">childWidthMeasureSpec</span> <span class="hljs-operator">=</span> getChildMeasureSpec(widthMeasureSpec,<br>                    getPaddingLeft() + getPaddingRight() + lp.leftMargin + lp.rightMargin,<br>                    lp.width);<br>            <span class="hljs-comment">// ç»™å­ View çš„æµ‹é‡æ¨¡å¼ä½¿ç”¨äº† MeasureSpec.EXACTLY</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">childHeightMeasureSpec</span> <span class="hljs-operator">=</span><br>                    MeasureSpec.makeMeasureSpec(parentSpace, MeasureSpec.EXACTLY);<br>            child.measure(childWidthMeasureSpec, childHeightMeasureSpec);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè®¾ç½® <code>mFillViewport = true</code> å NestedScrollView ä¼šä½¿ç”¨ <code>MeasureSpec.EXACTLY</code> æ¨¡å¼å†æ¬¡æµ‹é‡å­ Viewï¼Œé«˜åº¦ä½¿ç”¨çš„æ˜¯è‡ªèº«çš„é«˜åº¦</p>
<p>è€Œè‡ªèº«çš„é«˜åº¦åªæœ‰åœ¨ <code>match_parent</code> æˆ–è€… ç¡®å®šå€¼ æ—¶æ‰æœ‰ç”¨ï¼Œä¸ç„¶ï¼Œå¦‚æœä½ çš„ <code>layout_height</code> ä¸º <code>wrap_content</code>ï¼Œé‚£ <code>NestedScrollView#getMeasuredHeight()</code> å¾—åˆ°ä»ç„¶æ˜¯ Rv å…¨éƒ¨æµ‹é‡æ—¶çš„é«˜åº¦ï¼Œæ‰€ä»¥è¿™æ—¶å†æµ‹é‡è¿˜æ˜¯ä¼šå¯¼è‡´ Rv å¤ç”¨å¤±æ•ˆ</p>
<p>ä½¿ç”¨ mFillViewport å±æ€§ï¼Œä½†éœ€è¦ NsetedScrollView çš„ <strong>layout_height &#x3D; match_parent æˆ– ç¡®å®šå€¼</strong></p>
<p>ä½†ä¸€èˆ¬éƒ½ä¸ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå±æ€§æ¥è§£å†³ Rv å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Œè¿™é‡Œåªæ˜¯å½“ä¸ªæ‰©å±•æ¥è®²è§£</p>
</blockquote>
<h5 id="é—®é¢˜ï¼šå¦‚æœç»™-Rv-å¤–é¢å†åŒ…ä¸€å±‚ï¼Œé‚£å¤ç”¨è¿˜ä¼šå¤±æ•ˆå—ï¼Ÿ"><a href="#é—®é¢˜ï¼šå¦‚æœç»™-Rv-å¤–é¢å†åŒ…ä¸€å±‚ï¼Œé‚£å¤ç”¨è¿˜ä¼šå¤±æ•ˆå—ï¼Ÿ" class="headerlink" title="é—®é¢˜ï¼šå¦‚æœç»™ Rv å¤–é¢å†åŒ…ä¸€å±‚ï¼Œé‚£å¤ç”¨è¿˜ä¼šå¤±æ•ˆå—ï¼Ÿ"></a>é—®é¢˜ï¼šå¦‚æœç»™ Rv å¤–é¢å†åŒ…ä¸€å±‚ï¼Œé‚£å¤ç”¨è¿˜ä¼šå¤±æ•ˆå—ï¼Ÿ</h5><blockquote>
<p>ç­”æ¡ˆï¼šä»ç„¶ä¼šå¤±æ•ˆ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“å¤±æ•ˆçš„å†³å®šå› ç´ æ˜¯ <code>mHeight == 0 &amp;&amp; mode == MeasureSpec.UNSPECIFIED</code>ï¼Œè€Œ NestedScrollView åœ¨å­ View æ²¡æœ‰è®¾ç½® Margin å€¼æ—¶ç»™å­ View ä¼ å…¥çš„é«˜åº¦è‚¯å®šæ˜¯ 0</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png" srcset="/img/loading.gif" lazyload alt="image-20220321230936516"></p>
<p>è€Œ <code>MeasureSpec.UNSPECIFIED</code> æµ‹é‡æ¨¡å¼å…·æœ‰ä¼ é€’æ€§ï¼Œå‰é¢æˆ‘ä»¬æåˆ° <code>getChildMeasureSpec()</code> æ–¹æ³•ï¼ˆ<a href="#2%E3%80%81MeasureSpecs">MeasureSpecs</a>ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¦‚æœæµ‹é‡æ¨¡å¼æ˜¯å¯ä»»æ„å–å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º ScrollView</span><br><span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:<br>    <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å‡è®¾å­ View å›ºå®šä¸º 100dp</span><br>        resultSize = childDimension;<br>        resultMode = MeasureSpec.EXACTLY;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>        <span class="hljs-comment">// å­ View æ˜¯ match_parent</span><br>        <span class="hljs-comment">// è¿™ä¸ª sUseZeroUnspecifiedMeasureSpec å˜é‡ç”¨äºå…¼å®¹ Android æ—§ç‰ˆæœ¬</span><br>        resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;<br>        resultMode = MeasureSpec.UNSPECIFIED;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>        <span class="hljs-comment">// å­ View æ˜¯ wrap_content</span><br>        resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;<br>        resultMode = MeasureSpec.UNSPECIFIED;<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é™¤äº† <code>childDimension &gt;= 0</code> å¤–å…¶ä»–æƒ…å†µæµ‹é‡æ¨¡å¼éƒ½æ˜¯ <code>MeasureSpec.UNSPECIFIED</code>ï¼Œæ‰€ä»¥ä½ ä¸­é—´å¤¹ä¸€å±‚å…¶ä»–å¸ƒå±€æ˜¯è§£å†³ä¸äº†çš„</p>
</blockquote>
</blockquote>
<h5 id="3ã€Dialog-æ ¹å¸ƒå±€è®¾ç½®å®½é«˜å¤±æ•ˆ"><a href="#3ã€Dialog-æ ¹å¸ƒå±€è®¾ç½®å®½é«˜å¤±æ•ˆ" class="headerlink" title="3ã€Dialog æ ¹å¸ƒå±€è®¾ç½®å®½é«˜å¤±æ•ˆ"></a>3ã€Dialog æ ¹å¸ƒå±€è®¾ç½®å®½é«˜å¤±æ•ˆ</h5><blockquote>
<p>è¿™ä¸ªä¸œè¥¿ä¹‹å‰åœ¨å¯’å‡æœŸé—´è®²è¿‡ï¼Œä½†æ‰å‘ç°å½“æ—¶è®²çš„æœ‰äº›å°é—®é¢˜ï¼š</p>
<ul>
<li>åªæœ‰ DialogFragment æ‰ä¼šä½¿å¤–å±‚å¸ƒå±€çš„æ‰€æœ‰ <code>layout_</code> å±æ€§å¤±æ•ˆï¼Œè€Œ Dialog åˆ™<strong>ä¸€èˆ¬</strong>ä¸ä¼š</li>
</ul>
<p>å…¶å®ä¹Ÿä¸æ˜¯ä¸€èˆ¬ä¸ä¼šï¼Œä¸»è¦æ˜¯ DialogFragment å’Œ Dialog åœ¨ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨ä¸Šçš„ä¸åŒï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆæˆ‘æœ€å¼€å§‹ç»™é‚£ä½å­¦å¼Ÿè®²çš„<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180055610.png" srcset="/img/loading.gif" lazyload alt="image-20220322180055610" style="zoom: 50%;" /></p>
<p>åŸæ¥æ˜¯æˆ‘ä»¥ä¸º dialog èƒ½è®¾ç½®ï¼Œé‚£ DialogFragment ä¹Ÿèƒ½è®¾ç½®äº†ï¼ŒåŸæ¥ DialogFragment è®¾ç½®æ˜¯å¤±æ•ˆçš„</p>
<p>è¿™é‡Œç›´æ¥å…ˆè®²åŸå› ï¼š</p>
<p>DialogFragment æ˜¯ä½¿ç”¨ <code>setContentView(View view)</code> æ¥è®¾ç½®æ ¹å¸ƒå±€çš„ï¼Œè€Œ Dialog ä¸€èˆ¬ä½¿ç”¨ <code>setContentView(int id)</code> æ¥è®¾ç½®æ ¹å¸ƒå±€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨åº•å±‚çš„è°ƒç”¨ä¼šæœ‰äº›ä¸åŒ</p>
<p>æˆ‘ä»¬ç›´æ¥ä» DialogFragment å¼€å§‹ debug</p>
<p>DialogFragment æ˜¯ä¸€ä¸ª Fragmentï¼Œé‡Œé¢å¤¹å¸¦äº†ä¸€ä¸ª dialogï¼Œæ ¹æ® Fragment å¸¸è§çš„å†™æ³•ï¼Œå…ˆç»™ <code>onCreateView()</code> æ‰“ä¸Š debug</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326185016280.png" srcset="/img/loading.gif" lazyload alt="image-20220326185016280"></p>
<p>debug è¿›æ¥å‘ç°ä¸€å †æ–¹æ³•ï¼Œä½†å¦‚æœä¸äº†è§£è¿™äº›ä¸œè¥¿çš„è¯ï¼Œç¡®å®å¾ˆéš¾çŸ¥é“å®ƒæŠŠè¿™ä¸ªè¿”å›çš„ View æ‹¿æ¥å¹²äº†ä»€ä¹ˆï¼Œå…¶å®å½“æ—¶æˆ‘åœ¨ç»™é‚£ä½å­¦å¼Ÿæ‰¾è¿™ä¸ªé—®é¢˜ç­”æ¡ˆçš„æ—¶å€™æ‰¾äº†å¾ˆä¹…ï¼Œæœ€åæ˜¯ä» <code>View#setLayoutParams()</code> æ–¹æ³•å…¥æ‰‹ï¼Œåœ¨ä¸€å †è°ƒç”¨æ ˆä¸­å‘ç°äº†ç­”æ¡ˆã€‚è¿™é‡Œä¸ºäº†çœæ—¶é—´å°±ç›´æ¥æŒ‰æ­£å‘æµç¨‹è®²ä¸€éå§</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180533094.png" srcset="/img/loading.gif" lazyload alt="image-20220322180533094"></p>
<p>è¿™é‡Œå®ƒæœ‰ä¸€ä¸ª <code>LiveData</code> é€šçŸ¥è§‚å¯Ÿè€…</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180809792.png" srcset="/img/loading.gif" lazyload alt="image-20220322180809792"></p>
<p>DialogFragment é‡Œé¢å¯¹å®ƒè¿›è¡Œäº†è§‚å¯Ÿï¼ŒDialogFragment æ˜¯åœ¨ <code>onAttach()</code> çš„æ—¶å€™å¼€å§‹è¿›è¡Œè§‚å¯Ÿçš„ï¼Œæ€ªä¸å¾—æˆ‘æŒ‰æ­£å¸¸æµç¨‹èµ°äº†åŠå¤©ä¹Ÿæ‰¾ä¸åˆ°é—®é¢˜ :( </p>
<p>è¿™é‡Œçš„è§‚å¯Ÿè€…è¢«é€šçŸ¥æ—¶è°ƒç”¨äº† <code>mDialog.setContentView(view)</code>ï¼Œç‚¹å‡»å®ƒç»§ç»­å¾€ä¸‹èµ°</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322190910124.png" srcset="/img/loading.gif" lazyload alt="image-20220322190910124"></p>
<p>å¯ä»¥å‘ç°è¿™é‡Œå®ƒç›´æ¥ä¼ å…¥äº†è‡ªå·±çš„ LayoutParamsï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‰€æœ‰ <code>layout_</code> å±æ€§å…¨éƒ¨å¤±æ•ˆçš„åŸå› </p>
<p>é‚£æ™®é€šçš„ dialog ä¸ºä»€ä¹ˆä¸ä¼šå¤±æ•ˆå‘¢ï¼Ÿ</p>
<p>ä¸»è¦åŸå› æ˜¯ dialog ä¸€èˆ¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191150701.png" srcset="/img/loading.gif" lazyload alt="image-20220322191150701"></p>
<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191527878.png" srcset="/img/loading.gif" lazyload alt="image-20220322191527878" style="zoom: 50%;" />

<p>å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&gt;mLayoutInflater.inflate(layoutResID, mContentParent);<br></code></pre></td></tr></table></figure>

<p>è€Œä¸æ˜¯ä½¿ç”¨çš„ <code>setContenView(View view)</code></p>
<p>è‡³äº <code>LayoutInflater</code> ä¼šåœ¨åé¢è¿›è¡Œè®²è§£ï¼Œè¿™é‡Œä½ åªéœ€è¦çŸ¥é“è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•åï¼Œå®ƒä¼šè¯»å– xml æ–‡ä»¶ï¼Œå¹¶æŠŠ xml ä¸­å†™çš„ <code>layout_</code> å±æ€§ä¿å­˜åœ¨ä¸€ä¸ª <code>LayoutParams</code> ä¸­ä¾›çˆ¶å¸ƒå±€ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ DialogFragment çš„ <code>layout_</code> å±æ€§ä¸ä¼šå¤±æ•ˆçš„åŸå› ï¼Œå½“ç„¶ï¼Œåªæ˜¯ä¸€èˆ¬ä¸ä¼šå¤±æ•ˆï¼Œå¦‚æœä½ éè¦åœ¨ dialog ä¸­è°ƒç”¨ <code>setContentView(View view)</code>ï¼Œé‚£è‚¯å®šä¹Ÿæ˜¯ä¸€æ ·ä¼šå¤±æ•ˆçš„</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h5 id="1ã€åœ¨-DialogFragment-çš„æ ¹å¸ƒå±€å¤–é¢å†åŒ…ä¸€å±‚-FrameLayout"><a href="#1ã€åœ¨-DialogFragment-çš„æ ¹å¸ƒå±€å¤–é¢å†åŒ…ä¸€å±‚-FrameLayout" class="headerlink" title="1ã€åœ¨ DialogFragment çš„æ ¹å¸ƒå±€å¤–é¢å†åŒ…ä¸€å±‚ FrameLayout"></a>1ã€åœ¨ DialogFragment çš„æ ¹å¸ƒå±€å¤–é¢å†åŒ…ä¸€å±‚ FrameLayout</h5><blockquote>
<p>è¿™æ ·åŒ…äº†ä¸€å±‚åå°±å¯ä»¥è®©ä½ è‡ªå·±çš„å¸ƒå±€çš„ <code>layout_</code> åœ¨ FrameLayout ä¸‹ç”Ÿæ•ˆï¼ŒFrameLayout çš„ <code>layout_width</code>ã€<code>layout_height</code> ä»»æ„è®¾ç½®éƒ½å¯ä»¥ï¼Œå› ä¸ºå¤±æ•ˆäº†ï¼Œä½†æˆ‘æ›´æ¨èè®¾ç½®æˆ <code>wrap_content</code>ï¼Œè¿™æ ·çœ‹èµ·æ¥é€»è¾‘è¦å¥½ä¸€ç‚¹</p>
</blockquote>
<h5 id="2ã€é€šè¿‡ä»£ç è®¾ç½®å®½å’Œé«˜"><a href="#2ã€é€šè¿‡ä»£ç è®¾ç½®å®½å’Œé«˜" class="headerlink" title="2ã€é€šè¿‡ä»£ç è®¾ç½®å®½å’Œé«˜"></a>2ã€é€šè¿‡ä»£ç è®¾ç½®å®½å’Œé«˜</h5><blockquote>
<p>å¯ä»¥è®¾ç½®æ ¹å¸ƒå±€çš„å®½å’Œé«˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åªæœ‰åœ¨ onViewCreated() å›è°ƒé‡Œè®¾ç½®æ‰æœ‰æ•ˆ</span><br>override fun <span class="hljs-title function_">onViewCreated</span><span class="hljs-params">(view: View, savedInstanceState: Bundle?)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onViewCreated(view, savedInstanceState)<br>    <span class="hljs-comment">// density æ˜¯ dp / px çš„è½¬æ¢ç‡ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„æ‰‹æœºè½¬æ¢ç‡æ˜¯ 2.75ï¼Œåˆ™ 1dp å¯¹åº” 2.75px</span><br>    <span class="hljs-type">val</span> <span class="hljs-variable">density</span> <span class="hljs-operator">=</span> requireContext().resources.displayMetrics.density<br>    <span class="hljs-type">val</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> view.layoutParams<br>    lp.width = (density * <span class="hljs-number">400</span>).toInt()<br>    lp.height = (density * <span class="hljs-number">300</span>).toInt()<br>    <span class="hljs-comment">// è¿™é‡Œåªæ˜¯ä¿®æ”¹äº†å®½å’Œé«˜ï¼Œå› ä¸º View è¿˜æ²¡æœ‰è¢«æµ‹é‡å¸ƒå±€</span><br>    <span class="hljs-comment">// æ‰€ä»¥å¯ä»¥ä¸ç”¨è°ƒç”¨ view.layoutParams = lp æ¥åˆ·æ–°ï¼Œåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨æ—¶æ˜¯è¦é€šè¿‡è¿™ç§æ–¹å¼æ‰èƒ½åˆ·æ–°çš„ï¼</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è®¾ç½® window çš„å®½å’Œé«˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åªæœ‰åœ¨ onViewCreated() å›è°ƒé‡Œè®¾ç½®æ‰æœ‰æ•ˆ</span><br>override fun <span class="hljs-title function_">onViewCreated</span><span class="hljs-params">(view: View, savedInstanceState: Bundle?)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onViewCreated(view, savedInstanceState)<br>    <span class="hljs-comment">// density æ˜¯ dp / px çš„è½¬æ¢ç‡ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„æ‰‹æœºè½¬æ¢ç‡æ˜¯ 2.75ï¼Œåˆ™ 1dp å¯¹åº” 2.75px</span><br>    <span class="hljs-type">val</span> <span class="hljs-variable">density</span> <span class="hljs-operator">=</span> requireContext().resources.displayMetrics.density<br>    dialog?.window?.setLayout(<br>        (density * <span class="hljs-number">400</span>).toInt(),<br>        (density * <span class="hljs-number">300</span>).toInt()<br>    )<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ª window å…¶å®æ˜¯ Android é‡Œçš„ <code>PhoneWindow</code>ï¼Œå¬åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªç®¡ç†æ‰‹æœºçª—å£çš„ç±»ï¼Œè°ƒç”¨è¿™ä¸ª <code>setLayout()</code> æœ€åä¼šé‡æ–°ç»™ <code>DectorView</code> è®¾ç½® <code>LayoutParams</code>ï¼Œ<code>DectorView</code> æ˜¯æ‰€æœ‰çª—å£çš„æ ¹å¸ƒå±€</p>
</blockquote>
<p>ä¸Šé¢ä¸¤ç§è§£å†³æ–¹æ³•æˆ‘æ›´æ¨èä½¿ç”¨ç¬¬ä¸€ç§ï¼Œå› ä¸ºåœ¨ xml ä¸­å®šä¹‰å±æ€§æ›´å¥½ä¿®æ”¹ï¼Œä¸ç„¶åœ¨ä»£ç ä¸­ä¿®æ”¹å®½å’Œé«˜ï¼Œä¼šç»™ä»¥åçœ‹ä»£ç çš„äººå¸¦æ¥ç–‘æƒ‘</p>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>OKï¼Œ<code>onMeasure()</code> åŸºæœ¬ä¸Šå°±è®²åˆ°è¿™é‡Œäº†</p>
</blockquote>
<h3 id="8ã€onLayout"><a href="#8ã€onLayout" class="headerlink" title="8ã€onLayout()"></a>8ã€onLayout()</h3><blockquote>
<h3 id="ä½œç”¨-2"><a href="#ä½œç”¨-2" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>å¸ƒå±€å­æ§ä»¶</p>
<h3 id="æ¶‰åŠçŸ¥è¯†-1"><a href="#æ¶‰åŠçŸ¥è¯†-1" class="headerlink" title="æ¶‰åŠçŸ¥è¯†"></a>æ¶‰åŠçŸ¥è¯†</h3><ul>
<li><code>measureWidth</code> ä¸ <code>meaasureHeigth</code></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* ä¸ä¸Šé¢è®²çš„ onDraw() ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå›è°ƒï¼Œè¯¥å›è°ƒçš„ä½œç”¨æ˜¯ç”± requestLayout() è§¦å‘</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> changed ä¸ä¸Šæ¬¡å¸ƒå±€ç›¸æ¯”ï¼Œæ˜¯å¦å‘ç”Ÿæ”¹å˜</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLayout</span><span class="hljs-params">(                                </span></span><br><span class="hljs-params"><span class="hljs-function">    changed: <span class="hljs-type">Boolean</span>,                                 </span></span><br><span class="hljs-params"><span class="hljs-function">    left: <span class="hljs-type">Int</span>, top: <span class="hljs-type">Int</span>, right: <span class="hljs-type">Int</span>, bottom: <span class="hljs-type">Int</span>      </span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span> &#123;                                                   <br>    <span class="hljs-keyword">super</span>.onLayout(changed, left, top, right, bottom) <br>&#125;                                                     <br></code></pre></td></tr></table></figure>

<h3 id="ä¸»è¦ç”¨æ³•-1"><a href="#ä¸»è¦ç”¨æ³•-1" class="headerlink" title="ä¸»è¦ç”¨æ³•"></a>ä¸»è¦ç”¨æ³•</h3><ul>
<li><p>éå†å­ Viewï¼Œå†è°ƒç”¨ <code>child.layout()</code>ï¼Œæ‘†æ”¾å­ View</p>
</li>
<li><p>ä¸€èˆ¬æ˜¯ ViewGroup å®ç°</p>
<p>ä¹‹å‰æåˆ°äº† <code>TextView</code> ä½œä¸º View å´é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å®å®ƒæ²¡æœ‰å¹²ä»€ä¹ˆï¼Œä¸»è¦æ˜¯é‡æ–°è®¾ç½®äº†æ–‡å­—çš„ä½ç½®å’Œå¤§å°</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦åœ¨è¿™é‡Œé‡å†™è®¾ç½®å‘¢ï¼Ÿ</p>
<p>åŸå› ï¼š<code>onLayout()</code> èƒ½æ‹¿åˆ°æœ€ç»ˆæ˜¾ç¤ºçš„å®½åº¦å’Œé«˜åº¦ï¼Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨æœ‰ç‰¹æ®Šéœ€è¦æ—¶å¯ä»¥åœ¨è¿™é‡Œé¢æ¥è®¾ç½®ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„è‡ªå®šä¹‰ ViewGroup å§‹ç»ˆæ˜¯å›ºå®šçš„å¤§å°ï¼Œåˆ™å¯ä»¥ä¸ç”¨é‡å†™ <code>onMeasure()</code>ï¼Œè€Œæ˜¯åœ¨ <code>onLayout()</code> ä¸­ç›´æ¥ç»™å­ View è°ƒç”¨ <code>measure()</code>ã€<code>layout()</code> å¸ƒå±€</p>
</li>
</ul>
<pre><code class=" mermaid">graph LR
id1(&quot;ViewRootImpl å¼€å§‹å¸ƒå±€&quot;)--&gt;id2
id2[&quot;ViewGroup#layout()&quot;]--&gt;id3
id3[&quot;ViewGroup#onLayout()&quot;]--&gt;id4
id4[&quot;View#layout()&quot;]--&gt;id5(&quot;View#onLayout()&quot;)
</code></pre>


</blockquote>
<h4 id="1ã€measureWidth-measureHeight-ä¸-width-height"><a href="#1ã€measureWidth-measureHeight-ä¸-width-height" class="headerlink" title="1ã€measureWidth (measureHeight) ä¸ width (height)"></a>1ã€measureWidth (measureHeight) ä¸ width (height)</h4><blockquote>
<p><code>measureWidth</code> ä»£è¡¨æµ‹é‡çš„å®½åº¦ï¼Œå…¶å®å°±æ˜¯ <code>onMeasure()</code> ä¸­è°ƒç”¨ <code>setMeasuredDimension()</code> è®¾ç½®çš„å®½åº¦</p>
<p><code>width</code> ä»£è¡¨å¸ƒå±€åçš„å®½åº¦ï¼Œæ˜¯ç”± <code>layout()</code> ä¸­æ‘†æ”¾åé€šè¿‡ <code>right - left</code> å¾—åˆ°çš„</p>
<p>ä¸€èˆ¬ <code>measureWidth</code> åªç”¨äº <code>layout()</code> å’Œ <code>onLayout()</code> ä¸­ï¼Œå…¶ä»–åœ°æ–¹ä¸åº”è¯¥ä½¿ç”¨å®ƒ</p>
</blockquote>
<h4 id="2ã€FrameLayout-çš„-onLayout-æºç åˆ†æ"><a href="#2ã€FrameLayout-çš„-onLayout-æºç åˆ†æ" class="headerlink" title="2ã€FrameLayout çš„ onLayout() æºç åˆ†æ"></a>2ã€FrameLayout çš„ onLayout() æºç åˆ†æ</h4><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLayout</span><span class="hljs-params">(<span class="hljs-type">boolean</span> changed, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> top, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span> bottom)</span> &#123;<br>    layoutChildren(left, top, right, bottom, <span class="hljs-literal">false</span> <span class="hljs-comment">/* no force left gravity */</span>);<br>&#125;<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">layoutChildren</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> top, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span> bottom, <span class="hljs-type">boolean</span> forceLeftGravity)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> getChildCount();<br>    <span class="hljs-comment">// è®¡ç®—å­ View èƒ½ç»˜åˆ¶çš„è¾¹ç•Œ</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">parentLeft</span> <span class="hljs-operator">=</span> getPaddingLeftWithForeground();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">parentRight</span> <span class="hljs-operator">=</span> right - left - getPaddingRightWithForeground();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">parentTop</span> <span class="hljs-operator">=</span> getPaddingTopWithForeground();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">parentBottom</span> <span class="hljs-operator">=</span> bottom - top - getPaddingBottomWithForeground();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(i);<br>        <span class="hljs-comment">// å­ View ä¸º Gone æ—¶ä¸å¸ƒå±€ï¼Œåœ¨è‡ªå·±è®¾è®¡è‡ªå®šä¹‰ View æ—¶å»ºè®®ä¹Ÿè¿›è¡Œåˆ¤æ–­</span><br>        <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) &#123;<br>            <span class="hljs-comment">// å–å‡ºå­ View èº«ä¸Šçš„ LayoutParams</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (LayoutParams) child.getLayoutParams();<br>            <span class="hljs-comment">// å¾—åˆ°ä¹‹å‰æµ‹é‡çš„å®½å’Œé«˜</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> child.getMeasuredWidth();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> child.getMeasuredHeight();<br>            <span class="hljs-type">int</span> childLeft;<br>            <span class="hljs-type">int</span> childTop;<br>            <span class="hljs-comment">// å‰é¢æåˆ°çš„ FrameLayout#LayoutParams</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">gravity</span> <span class="hljs-operator">=</span> lp.gravity;<br>            <span class="hljs-keyword">if</span> (gravity == -<span class="hljs-number">1</span>) &#123;<br>                gravity = DEFAULT_CHILD_GRAVITY;<br>            &#125;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">layoutDirection</span> <span class="hljs-operator">=</span> getLayoutDirection();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">absoluteGravity</span> <span class="hljs-operator">=</span> Gravity.getAbsoluteGravity(gravity, layoutDirection);<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">verticalGravity</span> <span class="hljs-operator">=</span> gravity &amp; Gravity.VERTICAL_GRAVITY_MASK;<br>            <span class="hljs-comment">// ä¸‹é¢æ˜¯æ ¹æ®ä¸åŒçš„ gravity æ¥å¸ƒå±€ï¼Œå°±æ˜¯ä¸€äº›ç®€å•çš„è®¡ç®—</span><br>            <span class="hljs-keyword">switch</span> (absoluteGravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) &#123;<br>                <span class="hljs-keyword">case</span> Gravity.CENTER_HORIZONTAL:<br>                    childLeft = parentLeft + (parentRight - parentLeft - width) / <span class="hljs-number">2</span> +<br>                    lp.leftMargin - lp.rightMargin;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> Gravity.RIGHT:<br>                    <span class="hljs-keyword">if</span> (!forceLeftGravity) &#123;<br>                        childLeft = parentRight - width - lp.rightMargin;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                <span class="hljs-keyword">case</span> Gravity.LEFT:<br>                <span class="hljs-keyword">default</span>:<br>                    childLeft = parentLeft + lp.leftMargin;<br>            &#125;<br>            <span class="hljs-keyword">switch</span> (verticalGravity) &#123;<br>                <span class="hljs-keyword">case</span> Gravity.TOP:<br>                    childTop = parentTop + lp.topMargin;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> Gravity.CENTER_VERTICAL:<br>                    childTop = parentTop + (parentBottom - parentTop - height) / <span class="hljs-number">2</span> +<br>                    lp.topMargin - lp.bottomMargin;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> Gravity.BOTTOM:<br>                    childTop = parentBottom - height - lp.bottomMargin;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">default</span>:<br>                    childTop = parentTop + lp.topMargin;<br>            &#125;<br>            <span class="hljs-comment">// æœ€åè°ƒç”¨ child.layout()</span><br>            child.layout(childLeft, childTop, childLeft + width, childTop + height);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</blockquote>
<h3 id="9ã€requestLayout"><a href="#9ã€requestLayout" class="headerlink" title="9ã€requestLayout()"></a>9ã€requestLayout()</h3><blockquote>
<p>è¿™ä¸œè¥¿è·Ÿå‰é¢çš„ <code>invalidate()</code> ä¸€æ ·ï¼Œä½ ä»¬åªéœ€è¦è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>è°ƒç”¨åä¼šåœ¨ä¸‹ä¸€å¸§å›è°ƒ <code>onMeasure()</code> å’Œ <code>onMeasure()</code> è¿›è¡Œé‡æ–°æµ‹é‡å’Œå¸ƒå±€</li>
<li>å¦‚æœä½ çš„ View å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œå®ƒè¿˜ä¼šè°ƒç”¨ <code>onDraw()</code> è¿›è¡Œåˆ·æ–°</li>
</ul>
<p>æ–‡ç« çš„è¯ï¼Œä¸ <code>invalidate()</code> çš„ä¸€æ ·ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/7017452765672636446">https://juejin.cn/post/7017452765672636446</a></p>
<pre><code class=" mermaid">graph TB
id1(&quot;View&quot;)--&gt;id2
id2[&quot;è°ƒç”¨requestLayout()é‡æ–°å¸ƒå±€&quot;]--&gt;id3
id3&#123;&quot;parent == null&quot;&#125;--ä¸ä¸º null--&gt;id4
id4[&quot;å‘Šè¯‰çˆ¶å¸ƒå±€æœ‰å­å¸ƒå±€è¦é‡å¸ƒå±€&quot;]--&gt;id3--ä¸º null--&gt;id5
id5[&quot;ä¼ é€’åˆ°äº† ViewRootImpl (ä¸€ä¸ªç®¡ç†å¸ƒå±€çš„ç±»)&quot;]--&gt;id6
id6[&quot;ViewRootImpl è°ƒç”¨ mChoreographer å‘é€ä¸€ä¸ª post (ä¸€ä¸ªä¸“é—¨ç›‘å¬å±å¹•åˆ·æ–°çš„ç±»)&quot;]-.-&gt;id7
id7[&quot;å±å¹•åˆ·æ–°äº†ï¼Œå›è°ƒ ViewRootImplï¼Œå¼€å§‹é‡æ–°èµ° View æµ‹é‡å’Œå¸ƒå±€æµç¨‹&quot;]--&gt;id8
id8(&quot;ä»é¡¶éƒ¨å¸ƒå±€æœ€åå›è°ƒåˆ° View çš„ onMeasure()ã€onLayout()&quot;)--&gt;id9
id9&#123;&quot;å¦‚æœå®½é«˜æ”¹å˜&quot;&#125;--true--&gt;id10(&quot;è°ƒç”¨ onDraw() å›è°ƒ&quot;)--&gt;id11
id9--false--&gt;id11(&quot;ç»“æŸ&quot;)
</code></pre>


</blockquote>
<h3 id="10ã€setContentView"><a href="#10ã€setContentView" class="headerlink" title="10ã€setContentView"></a>10ã€setContentView</h3><blockquote>
<p>debug èµ°èµ·ï¼Œæœ€åå‘ç°å®ƒè°ƒç”¨äº†</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323223301814.png" srcset="/img/loading.gif" lazyload alt="image-20220323223301814"></p>
<p>æ·»åŠ å¸ƒå±€ç›´æ¥äº¤ç»™äº† <code>LayoutInflater</code> å¤„ç†ï¼Œé‚£æˆ‘ä»¬è®²è§£ä¸€ä¸‹ <code>LayoutInflater</code></p>
</blockquote>
<h4 id="1ã€LayoutInflater"><a href="#1ã€LayoutInflater" class="headerlink" title="1ã€LayoutInflater"></a>1ã€LayoutInflater</h4><blockquote>
<p><code>LayoutInflater</code> æˆ‘ä»¬å¸¸ç”¨çš„å°±ä¸‹é¢è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> View <span class="hljs-title function_">inflate</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> resource, <span class="hljs-meta">@Nullable</span> ViewGroup root)</span> &#123;<br>    <span class="hljs-comment">// å¯ä»¥çœ‹åˆ°å®ƒç›´æ¥è°ƒç”¨äº†ä¸‹é¢é‚£ä¸ªä¸‰ä¸ªå‚æ•°çš„</span><br>	<span class="hljs-keyword">return</span> inflate(resource, root, root != <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> resource å¸ƒå±€ id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> root çˆ¶å¸ƒå±€</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> attachToRoot æ˜¯å¦ç›´æ¥æ·»åŠ åˆ°çˆ¶å¸ƒå±€ï¼Œå¦‚æœä¸º trueï¼Œåœ¨è§£æå‡º View åä¼šç›´æ¥æ·»åŠ åˆ° root ä¸­</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> å¦‚æœ attachToRoot ä¸º trueï¼Œè¿™è¿”å› rootï¼Œå¦‚æœä¸º falseï¼Œåˆ™è¿”å› xml ä¸­çš„æ ¹å¸ƒå±€</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> View <span class="hljs-title function_">inflate</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> resource, <span class="hljs-meta">@Nullable</span> ViewGroup root, <span class="hljs-type">boolean</span> attachToRoot)</span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>ç»§ç»­å¾€é‡Œé¢èµ°ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„ä»£ç åœ¨è¿™é‡Œï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323224318637.png" srcset="/img/loading.gif" lazyload alt="image-20220323224318637"></p>
<p>ä¸Šé¢é‚£ä¸ªå°±æ˜¯ä¹‹å‰ç•™ä¸‹çš„é—®é¢˜ï¼ˆ<a href="#1%E3%80%81LayoutParams">LayoutParams</a>ï¼‰ï¼Œåœ¨ <code>root != null</code> é€šè¿‡ <code>AttributeSet</code> å¾—åˆ°ä½ è‡ªå·±çš„ <code>LayoutParmas</code>ï¼Œç„¶ååœ¨ <code>!attchToRoot</code> æ—¶è°ƒç”¨ <code>setLayoutParams()</code>ï¼Œé‡Œé¢ä¼šè°ƒç”¨ <code>requestLayout()</code>è¿›è¡Œé‡æ–°å¸ƒå±€</p>
<p>ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230405944.png" srcset="/img/loading.gif" lazyload alt="image-20220323230405944"></p>
<p>è¿™é‡Œåœ¨ <code>root != null &amp;&amp; attachToRoot</code> æ—¶è°ƒç”¨ <code>root.addView()</code>ï¼Œè¿™å°±æ˜¯ä½¿ç”¨ <code>attachToRoot</code> çš„æ—¶å€™</p>
<p>ç„¶ååœ¨ <code>addView()</code> é‡Œé¢å°±è°ƒç”¨äº†ä¹‹å‰é‡å†™çš„é‚£ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230713647.png" srcset="/img/loading.gif" lazyload alt="image-20220323230713647"></p>
<p>è¿™å°±æ˜¯ <code>LayoutInflater</code> çš„ç®€å•åˆ†æäº†</p>
<p>ä¹‹å‰æœ‰å­¦å¼Ÿé—®é“ <code>LayoutInflater#inflate()</code> ä¸ <code>View#inflate()</code> çš„åŒºåˆ«ï¼ŒæŸ¥çœ‹æºç ä½ å°±ä¼šå‘ç°å…¶å® <code>View#inflate()</code> å°±æ˜¯è°ƒç”¨çš„ <code>LayoutInflater#inflate()</code></p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323231300755.png" srcset="/img/loading.gif" lazyload alt="image-20220323231300755"></p>
<p>è¿˜æœ‰å­¦å¼Ÿé—®è¿‡ä¸ºä»€ä¹ˆ Rv çš„ <code>onCreateView()</code> ä½¿ç”¨åƒä¸‹é¢è¿™æ ·å†™ä¸è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å…¶å®è¿™ä¸ª parent å°±æ˜¯ Rv</span><br>override fun <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(parent: ViewGroup, viewType: Int)</span>: MyViewHolder &#123;<br>    <span class="hljs-keyword">return</span> MyViewHolder(<br>        <span class="hljs-comment">// è¿™ç§å†™æ³•å°±æ˜¯ä¸‹é¢è¿™ç§å†™æ³•</span><br>        View.inflate(parent.context, R.layout.recycler_item, parent)<br>    )<br>&#125;<br><br>override fun <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(parent: ViewGroup, viewType: Int)</span>: MyViewHolder &#123;<br>    <span class="hljs-keyword">return</span> MyViewHolder(<br>        LayoutInflater.from(parent.context).inflate(R.layout.recycler_item, parent, <span class="hljs-literal">true</span>)<br>    )<br>&#125;<br><br><span class="hljs-comment">// ä¸Šé¢è¿™ä¸¤ç§å†™æ³•ä½¿ç”¨åä¼šæŠ¥é”™ï¼š</span><br><span class="hljs-comment">// java.lang.IllegalStateException: </span><br><span class="hljs-comment">// ViewHolder views must not be attached when created. </span><br><span class="hljs-comment">// Ensure that you are not passing &#x27;true&#x27; to the attachToRoot parameter </span><br><span class="hljs-comment">// of LayoutInflater.inflate(..., boolean attachToRoot)</span><br><span class="hljs-comment">// æ„æ€å°±æ˜¯åªèƒ½åœ¨ ViewHolder å¼€å§‹ä½¿ç”¨æ—¶æ‰èƒ½æŠŠ View æ·»åŠ åˆ° parent ä¸­å»</span><br></code></pre></td></tr></table></figure>

<p>å¯èƒ½éƒ¨åˆ†æœ‰äººè¿™æ ·å†™è¿‡ï¼Œå‘ç° item çš„å¸ƒå±€æ— æ³•è®¾ç½®å¤§å°ï¼Œè¿™ä¸ªé—®é¢˜è·Ÿå‰é¢è®²åˆ°çš„ dialog æ ¹å¸ƒå±€å®½é«˜å¤±æ•ˆæœ‰ç‚¹ç±»ä¼¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">override fun <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(parent: ViewGroup, viewType: Int)</span>: MyViewHolder &#123;<br>    <span class="hljs-keyword">return</span> MyViewHolder(<br>        <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ null</span><br>        LayoutInflater.from(parent.context).inflate(R.layout.recycler_item, <span class="hljs-literal">null</span>)<br>    )<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ null æ—¶ï¼ŒæŒ‰ç…§å‰é¢åˆ†æçš„æµç¨‹ï¼Œå°±ä¸ä¼šç»™æ ¹å¸ƒå±€è®¾ç½® <code>LayoutParams</code>ï¼Œé‚£ä¹ˆåœ¨ Rv <code>addView()</code>æ—¶ï¼Œä¼šè°ƒç”¨ Rv çš„ <code>generateDefaultLayoutParams()</code> ï¼Œæœ€åè°ƒç”¨åˆ° <code>LayoutManger</code> çš„ <code>generateDefaultLayoutParams()</code></p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234144858.png" srcset="/img/loading.gif" lazyload alt="image-20220323234144858"></p>
<p>å¦‚æœæ˜¯ <code>LinearLayoutManger</code>ï¼Œå°±ç›´æ¥è®¾ç½®æˆ <code>wrap_content</code> äº†ï¼Œæ‰€ä»¥åœ¨ xml ä¸­å†™çš„å®½å’Œé«˜æ ¹æœ¬å°±æ²¡æœ‰å»è¯»å–</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234305639.png" srcset="/img/loading.gif" lazyload alt="image-20220323234305639"></p>
</blockquote>
<h3 id="11ã€å‘å¸ƒå¼€æºåº“"><a href="#11ã€å‘å¸ƒå¼€æºåº“" class="headerlink" title="11ã€å‘å¸ƒå¼€æºåº“"></a>11ã€å‘å¸ƒå¼€æºåº“</h3><h4 id="1ã€åˆ›å»ºæ¨¡å—"><a href="#1ã€åˆ›å»ºæ¨¡å—" class="headerlink" title="1ã€åˆ›å»ºæ¨¡å—"></a>1ã€åˆ›å»ºæ¨¡å—</h4><blockquote>
<p>å¤§å‹é¡¹ç›®éƒ½ä¼šé‡‡ç”¨å¤šæ¨¡å—å¼€å‘ï¼Œæ¯ä¸ªäººåªéœ€è¦è´Ÿè´£è‡ªå·±çš„æ¨¡å—ï¼Œæ¨¡å—æ–¹é¢çš„çŸ¥è¯†æˆ‘å°±ä¸è®²è§£äº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯è®²è§£å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰ View çš„æ¨¡å—</p>
<p>é¦–å…ˆ new ä¸€ä¸ªæ¨¡å—</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141248013.png" srcset="/img/loading.gif" lazyload alt="image-20220325141248013"></p>
<p>ç„¶åé€‰ç€å¯¹åº”çš„æ¨¡å—</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141438062.png" srcset="/img/loading.gif" lazyload alt="image-20220325141438062"></p>
<blockquote>
<p>è¿™é‡Œç®€å•è®²ä¸€ä¸‹ï¼š</p>
<p>ç¬¬ä¸€ä¸ª <code>Phone &amp; Tablet</code> ä¹Ÿæ˜¯åˆ›å»ºæ¨¡å—ï¼Œå…¶å®ä¸è¿™ä¸ª <code>Android Library</code> ä¸»è¦æ˜¯åœ¨ <code>build.gradle</code> ä¸Šçš„ç»†å¾®ä¸åŒ</p>
<h5 id="1ã€Phone-amp-Tablet"><a href="#1ã€Phone-amp-Tablet" class="headerlink" title="1ã€Phone &amp; Tablet"></a>1ã€Phone &amp; Tablet</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;com.android.application&#x27;</span><br>&#125;<br><br>android &#123;<br>    defaultConfig &#123;<br>    	applicationId <span class="hljs-string">&quot;com.ndhzs.myapplication&quot;</span><br>    	minSdk <span class="hljs-number">21</span><br>		targetSdk <span class="hljs-number">31</span><br>    	versionCode <span class="hljs-number">1</span><br>	    versionName <span class="hljs-string">&quot;1.0&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="2ã€Android-Library"><a href="#2ã€Android-Library" class="headerlink" title="2ã€Android Library"></a>2ã€Android Library</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;com.android.library&#x27;</span><br>&#125;<br><br>android &#123;<br>    defaultConfig &#123;<br>    	minSdk <span class="hljs-number">21</span><br>		targetSdk <span class="hljs-number">31</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¸åŒä¹‹å¤„ä¸»è¦å°±æ˜¯ä¸Šé¢ä¸¤å¤„ï¼Œå…¶ä»–è¿˜æœ‰ <code>AndroidManifest.xml</code> éƒ½æ˜¯å·®ä¸å¤šçš„</p>
</blockquote>
<p>åˆ›å»ºå¥½çš„æ¨¡å—ä¼šå°‘ res æ–‡ä»¶å¤¹ï¼Œè‡ªå·±æ–°å»ºå³å¯ï¼Œå…¶ä»–åœ°æ–¹ç”¨æ³•å°±è·Ÿå¹³å¸¸å†™æ³•éƒ½ä¸€æ ·</p>
<p>åœ¨ä½ çš„ app æ¨¡å—ä¸­ä½¿ç”¨ä¸‹é¢è¿™ç§å†™æ³•å°±å¯ä»¥åˆšå»ºçš„æ¨¡å—</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>	implementation project(<span class="hljs-string">&#x27;:lib&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¨¡å—ä¸‹ä¹Ÿæ˜¯å…è®¸å†å»ºå­æ¨¡å—çš„ï¼Œæ¨¡å—åŒ–éœ€è¦å­¦ä¹  gradle ç›¸å…³çš„çŸ¥è¯†ï¼Œç­‰ä½ ä»¬è¿›æ¥æ¥æ‰‹æŒé‚®äº†å¤šçœ‹å‡ ä¸ªæ¨¡å—å°±æ— å¸ˆè‡ªé€šäº†ï¼ˆé€æ¼ä¸€ä¸‹æ–°æ¶ˆæ¯ï¼Œç›®å‰å¼ºç¥è¿˜åœ¨æ›´æ–°æ•´ä¸ªæŒé‚®çš„ gradleï¼Œå·²ç»é‡æ„ä¸º kts äº†ï¼Œä¼°è®¡ç­‰ä½ ä»¬è¿›æ¥å°±å¯ä»¥ä½“éªŒåç¨‹äº†ï¼‰</p>
</blockquote>
<h4 id="2ã€å‘å¸ƒåˆ°-jitPack"><a href="#2ã€å‘å¸ƒåˆ°-jitPack" class="headerlink" title="2ã€å‘å¸ƒåˆ° jitPack"></a>2ã€å‘å¸ƒåˆ° jitPack</h4><blockquote>
<p>å¾ˆå¤šæ—¶å€™å‘å¸ƒåˆ°å¼€æºåº“æ–¹ä¾¿æˆ‘ä»¬åœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•ç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è®²è§£å¦‚ä½•å‘å¸ƒåˆ° <code>jitPack</code>ï¼Œä¸ºä»€ä¹ˆä¸å‘å¸ƒåˆ° <code>Maven Central</code>ï¼Œå› ä¸º <code>Maven Central</code> è¦ç”³è¯·æ–‡ä»¶ï¼Œå¾ˆéº»çƒ¦ï¼Œè€Œ <code>jitPack</code> ç›´æ¥å‚»ç“œå¼æ“ä½œä¸€æ­¥åˆ°ä½</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// åœ¨ lib çš„ build.gradle ä¸­</span><br>plugins &#123;<br>	id <span class="hljs-string">&#x27;maven-publish&#x27;</span><br>&#125;<br><br>android &#123;<br>	publishing &#123;<br>		singleVariant <span class="hljs-string">&quot;release&quot;</span><br>	&#125;<br>&#125;<br><br>afterEvaluate &#123;<br>	publishing &#123;<br>		publications &#123;<br>			release(MavenPublication) &#123;<br>				from components.release<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>æ³¨æ„æ˜¯åœ¨ lib çš„ build.gradle ä¸­ï¼Œä¸æ˜¯åœ¨ app çš„ build.gradle</strong></p>
<blockquote>
<p><strong>è¿™é‡Œæ˜¯åŸå› çš„è®²è§£ï¼Œä¸æƒ³çœ‹çš„è¯å¯ä»¥è·³è¿‡</strong></p>
<p>è¿™æ˜¯æˆ‘æ‘¸ç´¢å‡ºæ¥çš„<strong>æœ€æ–°æ•™ç¨‹</strong>ï¼Œå¦‚æœä½ å»é‚£äº›çœ‹é‚£äº›åšå®¢ï¼Œå…¨æ˜¯è¿‡æ—¶æ•™ç¨‹ï¼Œè¿™é‡Œç»™å‡ºæ‘¸ç´¢çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>å‘å¸ƒå¼€æºåº“çš„æ•™ç¨‹å…ˆæ ¹æ® <code>jitPack</code> å®˜ç½‘æ¥ï¼š<a target="_blank" rel="noopener" href="https://docs.jitpack.io/android/">https://docs.jitpack.io/android/</a></p>
</li>
<li><p>ç„¶åçœ‹å®ƒå®˜ç½‘ç»™å‡ºçš„æºç ç¤ºä¾‹ï¼š<a target="_blank" rel="noopener" href="https://github.com/jitpack/android-example/blob/master/library/build.gradle">https://github.com/jitpack/android-example/blob/master/library/build.gradle</a></p>
</li>
<li><p>å†å‚è€ƒè°·æ­Œç»™çš„ç¤ºä¾‹ï¼š<a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio/build/maven-publish-plugin">https://developer.android.google.cn/studio/build/maven-publish-plugin</a></p>
</li>
<li><p>æœ€åçœ‹çœ‹ gradle å®˜ç½‘æ¯ä¸ªæ–¹æ³•çš„æ„æ€ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:tasks">https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:tasks</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication">https://docs.gradle.org/current/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication</a></p>
</li>
</ul>
<p>è¿™æ ·åŸºæœ¬ä¸Šèƒ½å®ç°äº†ï¼Œä½†åœ¨æ‰“åŒ…æ—¶ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Šï¼š</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">WARNING:Software Components will <span class="hljs-keyword">not</span> be created automatically <span class="hljs-keyword">for</span> Maven publishing <span class="hljs-keyword">from</span> Android Gradle Plugin <span class="hljs-number">8.0</span>. <span class="hljs-keyword">To</span> opt-<span class="hljs-keyword">in</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">future</span> behavior, <span class="hljs-keyword">set</span> the Gradle <span class="hljs-keyword">property</span> <br></code></pre></td></tr></table></figure>

<p>æœ€åä¸Š stackoverflow å¯»æ‰¾ï¼ˆå› ä¸ºå…¶ä»–åœ°æ–¹æ‰¾ä¸åˆ°ï¼‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/71365373/software-components-will-not-be-created-automatically-for-maven-publishing-from">https://stackoverflow.com/questions/71365373/software-components-will-not-be-created-automatically-for-maven-publishing-from</a></p>
<p>æœ€æœ€ååœ¨è°·æ­Œæ‰¾åˆ°æ–¹æ³•ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio/publish-library/configure-pub-variants">https://developer.android.google.cn/studio/publish-library/configure-pub-variants</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/tools/gradle-api/7.1/com/android/build/api/dsl/LibraryPublishing">https://developer.android.google.cn/reference/tools/gradle-api/7.1/com/android/build/api/dsl/LibraryPublishing</a></p>
<p>è¿™é‡Œç®€å•è®²ä¸€ä¸‹ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>	publishing &#123;<br>         <span class="hljs-comment">// è¿™ä¸ªæ˜¯ä¼šè‡ªåŠ¨åˆ›å»ºä¸‹é¢ publications ä¸­çš„åŒåæ–¹æ³•</span><br>		singleVariant <span class="hljs-string">&quot;release&quot;</span><br><br>         <span class="hljs-comment">// æ¯”å¦‚è¿™ä¸ªå°±æ˜¯ä¸‹é¢é‚£ä¸ª myRelease(MavenPublication)</span><br>         <span class="hljs-comment">// singleVariant &quot;myRelease&quot;</span><br>	&#125;<br><br>    <span class="hljs-comment">// è¿™æ˜¯å®˜æ–¹é»˜è®¤è‡ªå¸¦çš„ä¸œè¥¿ï¼Œå°±ä¸å¯¹ä¸åŒçš„åŒ…å®šä¹‰ä¸åŒçš„è®¾ç½®</span><br>    buildTypes &#123;<br>        release &#123;<br>        &#125;<br>    &#125;<br>&#125;<br><br>afterEvaluate &#123;<br>	publishing &#123;<br>		publications &#123;<br>			release(MavenPublication) &#123;<br>                 <span class="hljs-comment">// è¿™ä¸ª components.release ä¸­çš„ release æ˜¯ buildTypes ä¸­çš„ release</span><br>				from components.release<br>			&#125;<br><br>             <span class="hljs-comment">// è¿™é‡Œè¿™ä¸ª myRelease å°±å¯¹åº”äºä¸Šé¢å†™çš„é‚£ä¸ª singleVariant &quot;myRelease&quot;</span><br>             <span class="hljs-comment">// myRelease(MavenPublication) &#123;</span><br>			<span class="hljs-comment">//     from components.release</span><br>			<span class="hljs-comment">// &#125;</span><br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœå®åœ¨çœ‹ä¸æ‡‚çš„è¯å°±ç›´æ¥æŒ‰ç…§åˆšå¼€å§‹ç»™å‡ºçš„æŠ„ä¸Šå»å³å¯ï¼Œæ¯•ç«Ÿçœ‹æ‡‚éœ€è¦æœ‰ä¸€å®šçš„ gradle åŸºç¡€</p>
</blockquote>
<p>ç„¶ååœ¨ github ä¸Šå‘ä¸€ä¸ª Releases</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133455931.png" srcset="/img/loading.gif" lazyload alt="image-20220325133455931"></p>
<p>Release å‘å¸ƒå¥½äº†åï¼Œæ‰“å¼€ <code>jitPack</code> </p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133728477.png" srcset="/img/loading.gif" lazyload alt="image-20220325133728477"></p>
<p>è¿™æ ·ä¸€ä¸ªæ­£å¼åŒ…å°±æˆåŠŸå‘å¸ƒå‡ºå»äº†ï¼Œå¼•å…¥çš„è¯ä¸‹é¢æœ‰æ•™ç¨‹</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325134213260.png" srcset="/img/loading.gif" lazyload alt="image-20220325134213260"></p>
<blockquote>
<p>å°æ’æ›²ï¼šç”±äº gradle åˆ° 7.0.0 ç‰ˆæœ¬ä»¥åï¼Œå¼•å…¥æ”¹ä½ç½®äº†</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// åœ¨ settings.gradle é‡Œ</span><br>dependencyResolutionManagement &#123;<br> repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)<br> repositories &#123;<br>     google()<br>     mavenCentral()<br>     maven &#123; url = <span class="hljs-string">&quot;https://jitpack.io&quot;</span> &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</blockquote>
<p>å¦‚æœæ˜¯è‡ªå·±å¹³æ—¶å¼€å‘ä¸­ç”¨åˆ°ï¼Œæ¯æ¬¡éƒ½å‘ Releases æ˜¾å¾—è¿‡äºéº»çƒ¦ï¼Œ<code>jitPack</code> å¯ä»¥å‘å¸ƒå¿«ç…§ç‰ˆæœ¬ï¼Œä½•ä¸ºå¿«ç…§ï¼Œçœ‹å®Œä¸‹é¢çš„æ•™ç¨‹ä½ å°±æ‡‚äº†</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135853586.png" srcset="/img/loading.gif" lazyload alt="image-20220325135853586"></p>
<p>ä½ ä¼šå‘ç°ä¸‹é¢ç»™å‡ºçš„å¼•å…¥å†™æ³•æ²¡æœ‰å¸¦ç‰ˆæœ¬å·</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135808864.png" srcset="/img/loading.gif" lazyload alt="image-20220325135808864"></p>
<p>è¿™ä¸ª <code>SNAPSHOP</code> å°±æ˜¯å¿«ç…§çš„æ ‡è¯†ï¼Œå¸¦æœ‰å¿«ç…§çš„ç‰ˆæœ¬å·åœ¨ build æ—¶ä¼šè‡ªåŠ¨å»æ£€æŸ¥æ˜¯å¦æ˜¯æœ€æ–°ç‰ˆï¼Œä»¥ååªéœ€è¦æäº¤åˆ° main åˆ†æ”¯ï¼Œç„¶åå‘ä¸ªå¿«ç…§ç‰ˆæœ¬å°±å¯ä»¥å‡çº§äº†</p>
<p>åªæœ‰è‡ªå·±ä½¿ç”¨æ—¶æ›´æ¨èå‘å¸ƒå¿«ç…§</p>
</blockquote>
<h4 id="3ã€å‘å¸ƒåˆ°é˜¿é‡Œçš„-Maven"><a href="#3ã€å‘å¸ƒåˆ°é˜¿é‡Œçš„-Maven" class="headerlink" title="3ã€å‘å¸ƒåˆ°é˜¿é‡Œçš„ Maven"></a>3ã€å‘å¸ƒåˆ°é˜¿é‡Œçš„ Maven</h4><blockquote>
<p>å°±åœ¨è¦ä¸Šè¯¾çš„æ˜¨å¤©ï¼Œè‰¾ç¥æ¥é—®æˆ‘æ€ä¹ˆå‘å¸ƒé˜¿é‡Œçš„ Mavenï¼Œä»–æ‰è¿›å‘é‡Œå¡äº†ä¸€ä¸ªæ™šä¸Šï¼Œäºæ˜¯æˆ‘å»è¯•ç€è§£å†³äº†ä¸€ä¸‹</p>
<p>æœç„¶å¤Ÿå‘çš„ï¼Œå› ä¸º gradle å‡åˆ° 7.0.0 ä»¥åæŠŠä¸€ä¸ªæ’ä»¶ç»™ç§»é™¤äº†ï¼Œè€Œé˜¿é‡Œå®˜ç½‘å’Œå…¶ä»–æ•™ç¨‹éƒ½æ˜¯è¿‡æ—¶çš„ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´æ‰æå‡ºæ¥ï¼Œè¿™é‡Œå°±ç›´æ¥ç»™æœ€æ–°çš„æ“ä½œæ•™ç¨‹</p>
<p>é¦–å…ˆï¼Œå»é˜¿é‡Œå®˜ç½‘æ³¨å†Œä¸€ä¸‹ï¼ˆå¥½åƒæ˜¯å…è´¹çš„ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://packages.aliyun.com/maven">https://packages.aliyun.com/maven</a></p>
<p>æ³¨å†Œè¿‡åï¼Œä»–ä¼šç»™ä½ ä¸¤ä¸ªä»“åº“ï¼š</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231305660.png" srcset="/img/loading.gif" lazyload alt="image-20220326231305660"></p>
<p>ä¸€ä¸ªæ˜¯ç”¨äºå‘å¸ƒç¨³å®šç‰ˆçš„åº“ï¼Œä¸€ä¸ªæ˜¯å‘å¸ƒå¿«ç…§ç‰ˆçš„åº“ï¼Œä¸Šé¢ <code>jitPack</code> ä¸­ä¹Ÿä»‹ç»äº†å¿«ç…§</p>
<p>ç„¶åæ‰¾åˆ°è¿™ä¸ªæŒ‡å—ç•Œé¢</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231921252.png" srcset="/img/loading.gif" lazyload alt="image-20220326231921252"></p>
<p>è¿™é‡Œé¢æœ‰ä¸€äº›åŸºç¡€è®¾ç½®ï¼Œä½†è¿™æ•™ç¨‹è¿‡æ—¶äº†ï¼Œä¸‹é¢æˆ‘ç»™å‡ºæœ€æ–°çš„å†™æ³•ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// settings.gradle</span><br>dependencyResolutionManagement &#123;<br>    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)<br>    repositories &#123;<br>        google()<br>        mavenCentral()<br>        <span class="hljs-comment">// è¿™é‡Œæ·»åŠ é˜¿é‡Œ maven çš„ä»“åº“åœ°å€</span><br>        maven &#123;<br>            url <span class="hljs-string">&#x27;https://maven.aliyun.com/repository/public&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// è¿™æ˜¯å•ç‹¬å†™çš„ä¸€ä¸ª maven.gradle</span><br><br><span class="hljs-comment">// gradle 7ä¹‹å‰ä½¿ç”¨çš„ maven æ’ä»¶ï¼Œ7ä¹‹ååªèƒ½ä½¿ç”¨ maven-publish äº†</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;maven-publish&#x27;</span><br><span class="hljs-comment">// è¿™ä¸ªæ˜¯å¼•ç”¨æˆ‘çš„å¯†ç ç­‰ç§å¯†æ–‡ä»¶ï¼Œå»ºè®®æŠŠè¿™äº›å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œå¹¶åœ¨.gitignoreä¸Šæ·»åŠ å®ƒ</span><br>apply <span class="hljs-attr">from:</span> <span class="hljs-string">&quot;$&#123;rootDir&#125;/secret.gradle&quot;</span><br><br>afterEvaluate &#123;<br>    publishing &#123;<br>        publications &#123;<br>            release(MavenPublication) &#123;<br>                from components.release<br>                <span class="hljs-comment">// ç‰ˆæœ¬å·ï¼Œå¦‚æœæœ«å°¾åŠ ä¸Š -SNAPSHOT è¯´æ˜æ˜¯å¿«ç…§ç‰ˆæœ¬</span><br>                version = <span class="hljs-string">&#x27;0.0.1-SNAPSHOT&#x27;</span><br>                <span class="hljs-comment">// é¡¹ç›®åç§°ï¼Œé€šå¸¸ä¸ºç±»åº“æ¨¡å—åç§°ï¼Œä¹Ÿå¯ä»¥ä»»æ„è®¾ç½®</span><br>                artifactId = <span class="hljs-string">&#x27;example&#x27;</span><br>                <span class="hljs-comment">// å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸ä¸ºæ¨¡å—åŒ…åï¼Œä¹Ÿå¯ä»¥ä»»æ„è®¾ç½®</span><br>                groupId = <span class="hljs-string">&#x27;com.985892345&#x27;</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// è¿™ä¸‹é¢çš„ aliMavenUsernameã€aliMavenPasswordã€releaseUrlã€snapshotUrl</span><br>        <span class="hljs-comment">// å¯¹åº”ä½ è‡ªå·±çš„ï¼Œåœ¨é˜¿é‡Œå®˜ç½‘é‚£ä¸ªæŒ‡å—é‡Œæœ‰</span><br>        repositories &#123;<br>            maven &#123;<br>                credentials &#123;<br>                    username aliMavenUsername<br>                    password aliMavenPassword<br>                &#125;<br>                url releaseUrl<br>            &#125;<br>            maven &#123;<br>                credentials &#123;<br>                    username aliMavenUsername<br>                    password aliMavenPassword<br>                &#125;<br>                url snapshotUrl<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// secret.gradle</span><br><span class="hljs-comment">// è¿™ä¸ªæ²¡å­¦è¿‡ gradle çš„è¯å¯èƒ½çœ‹ä¸æ‡‚ï¼Œè¿™é‡Œä¸ä¼šè®²è§£ï¼Œä½ åªç®¡è¿™æ ·å†™å°±å¯ä»¥</span><br>ext.aliMavenUsername = <span class="hljs-string">&quot;ä½ çš„è´¦å·&quot;</span><br>ext.aliMavenPassword = <span class="hljs-string">&quot;ä½ çš„å¯†ç &quot;</span><br>ext.releaseUrl = <span class="hljs-string">&quot;ä½ çš„ç¨³å®šç‰ˆæœ¬å‘å¸ƒåœ°å€&quot;</span><br>ext.snapshotUrl = <span class="hljs-string">&quot;ä½ çš„å¿«ç…§ç‰ˆæœ¬å‘å¸ƒåœ°å€&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// åœ¨ä½ è¦å‘å¸ƒçš„é¡¹ç›®é‡Œçš„ build.gradle</span><br>apply <span class="hljs-attr">from:</span> <span class="hljs-string">&quot;maven.gradle&quot;</span><br><br>android &#123;<br>    <span class="hljs-comment">// è¿™ä¸ªä¸œè¥¿åœ¨ä¹‹å‰ jitPack è®²è¿‡ï¼Œè¿™é‡Œå°±ä¸å†è®²äº†</span><br>    publishing &#123;<br>        singleVariant <span class="hljs-string">&quot;release&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong>é€šå¸¸ä½ è¦å‘å¸ƒçš„é¡¹ç›®æ˜¯ä¸€ä¸ª <code>library</code>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª <code>application</code>ï¼Œå› ä¸ºä¸€èˆ¬ <code>library</code> æ‰æ˜¯ç»™åˆ«äººä½¿ç”¨çš„ï¼Œè€Œ <code>application</code> æ˜¯ä¸€ä¸ªé¡¹ç›®çš„å…¥å£ï¼Œé€šå¸¸æ¥ä¾èµ– <code>library</code></p>
<p>OKï¼Œè¿™æ ·å°±é…ç½®å®Œäº†ï¼Œåˆ·æ–°ä¸€ä¸‹ gradleï¼Œå†ç‚¹å‡»å³ä¸Šè§’çš„ gradle æ ‡å¿—</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234300251.png" srcset="/img/loading.gif" lazyload alt="image-20220326234300251"></p>
<p>ç‚¹å‡»è¿™ä¸ªå°±å¯ä»¥ç›´æ¥è¿è¡Œå‘å¸ƒåˆ° maven çš„ task</p>
<img src="D:/Typora/img/image-20220326234410761.png" srcset="/img/loading.gif" lazyload alt="image-20220326234410761" style="zoom: 67%;" />

<blockquote>
<p>å¯èƒ½ä½ ä»¬æœ‰äº›äººæ‰¾ä¸åˆ°è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºæ–°ç‰ˆçš„ AS æŠŠè¿™ä¸ªé»˜è®¤å…³é—­äº†ï¼Œæˆ‘ä¹Ÿæä¸æ‡‚ä¸ºå•¥ï¼Œä¸ºäº†è®©å¤§å®¶ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œä»»åŠ¡ï¼Ÿ</p>
<p>åœ¨è¿™é‡Œè¿›è¡Œè®¾ç½®ï¼Œå°±èƒ½çœ‹å¾—åˆ°äº†</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234634838.png" srcset="/img/loading.gif" lazyload alt="image-20220326234634838"></p>
</blockquote>
</blockquote>
<h3 id="12ã€åˆ†äº«ä¸€äº›ä¸œè¥¿"><a href="#12ã€åˆ†äº«ä¸€äº›ä¸œè¥¿" class="headerlink" title="12ã€åˆ†äº«ä¸€äº›ä¸œè¥¿"></a>12ã€åˆ†äº«ä¸€äº›ä¸œè¥¿</h3><h4 id="1ã€Material-Design-å®˜ç½‘"><a href="#1ã€Material-Design-å®˜ç½‘" class="headerlink" title="1ã€Material Design å®˜ç½‘"></a>1ã€Material Design å®˜ç½‘</h4><blockquote>
<p>è°æƒ³å†™è‡ªå®šä¹‰ View å•Šï¼Œä½ æƒ³å†™å—ï¼Ÿæ­£ç»äººå†™ä»€ä¹ˆè‡ªå®šä¹‰ Viewã€‚</p>
<p>è‡ªå®šä¹‰ View ç¡®å®å¾ˆéš¾ï¼Œä¸œè¥¿åˆå¤šåˆæ‚ï¼Œåœ¨è€ƒè™‘å†™è‡ªå®šä¹‰ View ä¹‹å‰ï¼Œè¯·å…ˆæœç´¢ä¸€ä¸‹æ˜¯å¦æœ‰åˆ«äººå·²ç»é€ å¥½çš„è½®å­ï¼Œæœ‰è½®å­ç›´æ¥ç”¨ï¼Œä»–ä¸é¦™å—ï¼Ÿ[ç‹—å¤´]ï¼ŒMaterial Design å®˜ç½‘å°±åŒ…å«è®¸å¤šå®˜æ–¹è½®å­</p>
<p>å®˜ç½‘é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://material.io/">https://material.io/</a></p>
<p>æºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/material-components/material-components-android">https://github.com/material-components/material-components-android</a></p>
<p>ç¤ºä¾‹ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://github.com/material-components/material-components-android/releases">https://github.com/material-components/material-components-android/releases</a></p>
<p>è¿™é‡Œé¢çš„éƒ½ç®—å®˜æ–¹æ§ä»¶ï¼Œè€Œä¸”æœ‰å¾ˆå¤šï¼Œå¦‚æœæƒ³å®ç°æŸä¸ªåŠŸèƒ½æ—¶å¯ä»¥å»çœ‹çœ‹æ˜¯å¦å·²ç»æœ‰å®ç°äº†çš„ï¼Œä»–è¿˜ä¸“é—¨å†™äº†ä¸€ä¸ªå®ä¾‹ appï¼Œå¯ä»¥ä¸‹ä¸‹æ¥çœ‹çœ‹ï¼Œæ‰¾åˆ°æƒ³è¦çš„å†å»çœ‹ä»–çš„æºç </p>
</blockquote>
<h4 id="2ã€MotionLayout"><a href="#2ã€MotionLayout" class="headerlink" title="2ã€MotionLayout"></a>2ã€MotionLayout</h4><blockquote>
<p>è¿™ä¸œè¥¿æˆ‘éƒ½è¿˜æ²¡æ€ä¹ˆæ·±å…¥å­¦ä¹ ï¼Œå¯ä»¥å»çœ‹çœ‹æ˜é‡‘ä¸Šçš„ä¸€äº›æ•™ç¨‹ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²äº† ï¼‰</p>
<p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/constraint-layout/motionlayout/examples?hl=zh_cn">https://developer.android.google.cn/training/constraint-layout/motionlayout/examples?hl=zh_cn</a></p>
</blockquote>
<h4 id="2ã€View-post-ã€posyDelay-ã€postOnAnimation"><a href="#2ã€View-post-ã€posyDelay-ã€postOnAnimation" class="headerlink" title="2ã€View#post()ã€posyDelay()ã€postOnAnimation()"></a>2ã€View#post()ã€posyDelay()ã€postOnAnimation()</h4><blockquote>
<h5 id="é¢è¯•é¢˜ï¼š"><a href="#é¢è¯•é¢˜ï¼š" class="headerlink" title="é¢è¯•é¢˜ï¼š"></a>é¢è¯•é¢˜ï¼š</h5><p>å¦‚ä½•åœ¨ <code>onCreate()</code> ä¸­å¾—åˆ° View çš„å®½å’Œé«˜ï¼Ÿ</p>
<p>å“ˆå“ˆï¼Œè¿™ä¸æ˜¯æœ‰æ‰‹å°±è¡Œï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>	<span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>	setContentView(com.ndhzs.lib.R.layout.layout_section7)<br>        <br>	<span class="hljs-keyword">val</span> view = findViewById&lt;View&gt;(com.ndhzs.lib.R.id.myView7)<br>	<span class="hljs-keyword">val</span> width = view.width<br>	<span class="hljs-keyword">val</span> height = view.height<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶åé¢è¯•å®˜ç¬‘äº†ç¬‘ï¼Œä½ å°±è¢«åˆ·äº†</p>
<p>åŸå› ï¼šè¿™ç§å†™æ³•å¾—åˆ°çš„å®½å’Œé«˜ç»“æœæ˜¯ 0</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºå‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œ<code>View#width</code> å’Œ <code>View#height</code> æ˜¯åœ¨ <code>onLayout()</code> ä¸­è®¾ç½®çš„ï¼Œè€Œ <code>onCreate()</code> æ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹å¸ƒå±€ï¼Œåªæ˜¯è°ƒç”¨äº† <code>setContentView()</code> åŠ è½½äº†å¸ƒå±€ï¼Œä¸‰å¤§æµç¨‹è¿˜æ²¡æœ‰å¼€å§‹èµ°ï¼ŒçœŸæ­£å¼€å§‹èµ°ä¸‰å¤§æµç¨‹æ˜¯åœ¨ <code>onResume()</code> åï¼Œè¿™é‡Œæä¾›ä¸‹é¢å‡ ç§æ­£ç¡®æ–¹æ³•ï¼š</p>
<blockquote>
<h5 id="1ã€post"><a href="#1ã€post" class="headerlink" title="1ã€post()"></a>1ã€post()</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> view = findViewById&lt;View&gt;(com.ndhzs.lib.R.id.myView7)<br>view.post &#123;<br>    <span class="hljs-keyword">val</span> width = view.width<br>    <span class="hljs-keyword">val</span> height = view.height<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åŸç†ï¼špost æ˜¯ç”¨ Handler å‘ä¸€ä¸ª Messageï¼Œè€Œ View å¯¹äºè‡ªå¸¦çš„ post åšäº†ç‰¹æ®Šå¤„ç†ï¼Œåªä¼šåœ¨ View è¢«æµ‹é‡åæ‰å¼€å§‹å‘ Message</p>
<h5 id="2ã€doOnLayout"><a href="#2ã€doOnLayout" class="headerlink" title="2ã€doOnLayout"></a>2ã€doOnLayout</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> view = findViewById&lt;View&gt;(com.ndhzs.lib.R.id.myView7)<br>view.doOnLayout &#123;<br>    <span class="hljs-keyword">val</span> width = view.width<br>    <span class="hljs-keyword">val</span> height = view.height<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åŸç†ï¼šä½¿ç”¨ View çš„ä¸€ä¸ª <code>addOnLayoutChangeListener()</code> æ–¹æ³•ï¼Œç›‘å¬ View çš„ <code>onLayout()</code> å›è°ƒ</p>
</blockquote>
<h5 id="å†æ¥ä¸ªé¢è¯•é¢˜ï¼š"><a href="#å†æ¥ä¸ªé¢è¯•é¢˜ï¼š" class="headerlink" title="å†æ¥ä¸ªé¢è¯•é¢˜ï¼š"></a>å†æ¥ä¸ªé¢è¯•é¢˜ï¼š</h5><p>View çš„ <code>post()</code> åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ<code>postDelayed()</code> ä¼šé€ æˆå†…å­˜æ³„æ¼å—ï¼Ÿå¦‚æœä¼šè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼š</p>
<p>1ã€View çš„ <code>post()</code> åœ¨æ²¡æœ‰æ·»åŠ åˆ°å±å¹•å‰ä¼šå…ˆä¿å­˜ Runnable åœ¨ç¬¬ä¸€æ¬¡ <code>performTraversals</code> åˆ°æ¥æ—¶æ‰§è¡Œï¼Œå¦‚æœå·²ç»æ·»åŠ å±å¹•ä¸Šï¼Œå°±ç›´æ¥äº¤ç»™ <code>mAttachInfo</code> çš„ <code>mHanlder</code> æ‰§è¡Œï¼Œè‡³äºè¿™ä¸ª <code>mHandler</code>ï¼Œæ˜¯ <code>ViewRootImpl</code> æŒæœ‰çš„ä¸€ä¸ª <code>ViewRootHandler</code> å¯¹è±¡</p>
<p>2ã€<code>postDelayed()</code> ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºå®ƒæ²¡ä¸»åŠ¨åˆ é™¤ä½ å‘é€çš„ Runnableï¼ˆå…¶å® <code>post()</code> ç†è®ºä¸Šä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œä½†å› ä¸ºæ—¶é—´æçŸ­ï¼Œçº¦ç­‰äºä¸æ³„æ¼ï¼‰</p>
<p>3ã€å¤„ç†çš„è¯ï¼Œå¯ä»¥åœ¨é‡å†™ View çš„ <code>onDetachedFromWindow()</code> æ–¹æ³•ä¸»åŠ¨å–æ¶ˆï¼Œæˆ–è€…å°è£…ä¸€ä¸‹æˆå•ç‹¬çš„ä¸€ä¸ªç±»ï¼Œä½¿ç”¨ <code>addOnAttachStateChangeListener()</code> ä¸“é—¨æ¥å‘ <code>postDelayed()</code></p>
<blockquote>
<p>å¦‚æœé¢è¯•å®˜çœŸçš„åˆéš¾ä½ ï¼Œå¯èƒ½è¿˜ä¼šé—® <code>View#post()</code> åœ¨ä¸åŒç‰ˆæœ¬ä¸Šçš„å®ç° (</p>
<p>è¿™ä¸ªä½ ä»¬è‡ªå·±çœ‹æ–‡ç« å§ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903521804877832">https://juejin.cn/post/6844903521804877832</a></p>
<p>è¿˜æœ‰å¦‚ä½•æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œè¿™ä¸ªè¿˜æ˜¯å¾—æä¸€ä¸‹ï¼Œä¸ç„¶ä¸æçš„è¯ï¼Œå¯èƒ½éƒ½ä¸ä¼šæœ‰äººçŸ¥é“</p>
<p>ç›´æ¥ä½¿ç”¨ï¼šLeakCanary  <a target="_blank" rel="noopener" href="https://github.com/square/leakcanary">https://github.com/square/leakcanary</a></p>
<p>ç”¨æ³•å¾ˆç®€å•ï¼Œåªéœ€ä¸€è¡Œä»£ç å³å¯</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>  <span class="hljs-comment">// debugImplementation because LeakCanary should only run in debug builds.</span><br>  debugImplementation <span class="hljs-string">&#x27;com.squareup.leakcanary:leakcanary-android:xxx&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶åå®ƒä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªå¤šä½™çš„å›¾æ ‡ï¼Œåœ¨ä½ åº”ç”¨å‡ºç°å†…å­˜æ³„æ¼æ—¶å¼¹çª—æé†’</p>
<p><img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325155039418.png" srcset="/img/loading.gif" lazyload alt="image-20220325155039418"></p>
<p>å†…å­˜æ³„éœ²ä¹Ÿæ˜¯é¢è¯•çš„ç‚¹ï¼ˆ</p>
</blockquote>
<h5 id="æœ€åä¸€ä¸ªé¢è¯•é¢˜"><a href="#æœ€åä¸€ä¸ªé¢è¯•é¢˜" class="headerlink" title="æœ€åä¸€ä¸ªé¢è¯•é¢˜"></a>æœ€åä¸€ä¸ªé¢è¯•é¢˜</h5><p><code>postOnAnimation()</code> æ˜¯ä»€ä¹ˆï¼Ÿé€šå¸¸ç”¨äºä»€ä¹ˆæ—¶å€™ï¼Ÿ</p>
<p>ä¸è¦è¢« Animation è¿·æƒ‘äº†ï¼Œè®¤ä¸ºè¿™ä¸ªæ˜¯ç”¨æ¥å‘é€åŠ¨ç”»çš„ï¼Œå¦‚æœè¦è®²è¿™ä¸ªï¼Œæˆ‘ä»¬å…ˆä»å®˜æ–¹å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•è®²èµ·ï¼Œå¦‚æœä½ ç»å¸¸çœ‹å®˜æ–¹æ§ä»¶æºç ï¼Œä½ ä¼šå‘ç°ä¸‹é¢è¿™ä¸ªä¸œè¥¿å¸¸å‡ºç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ViewCompat.postOnAnimation()<br></code></pre></td></tr></table></figure>

<p>å¦‚æœä½ å»çœ‹ä¸€éå®ƒçš„æ³¨é‡Šï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå°±æ˜¯å°† Runnable åœ¨æ‰‹æœºçš„ä¸‹ä¸€å¸§æ‰§è¡Œï¼ˆå‰é¢è¯´è¿‡åˆ·æ–°ç‡ 60 çš„æ‰‹æœºæ¯å¸§ç›¸éš” 16 æ¯«ç§’ï¼‰ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨åœ¨ SDK 16 åŠä»¥ä¸Šå°±æ˜¯è°ƒç”¨çš„ <code>View#postOnAnimation()</code></p>
<p>é‚£è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨åœºæ™¯å¦‚ä½•å‘¢ï¼Ÿ</p>
<p>å®ƒå¸¸ç”¨äºä»£æ›¿ <code>ValueAnimator</code> åŠ¨ç”»ï¼ˆ<code>ValueAnimator</code> è¿™ç±»åŠ¨ç”»ä¸ <code>View#postOnAnimation()</code> å†…éƒ¨å®ç°æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œæ¯”å¦‚åœ¨ Rv çš„æƒ¯æ€§æ»‘åŠ¨ä¸­å°±ä¼šç”¨åˆ°è¿™ä¸ª <code>ViewCompat.postOnAnimation()</code>ï¼ˆä¸‹æ¬¡äº‹ä»¶åˆ†å‘æ—¶æ‰è®²ï¼‰</p>
<p>æ‰€ä»¥ä½ ä¼šç»å¸¸çœ‹è§è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">Runnable</span> <span class="hljs-variable">mRunnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-comment">// ......</span><br>		ViewCompat.postOnAnimation(View.<span class="hljs-built_in">this</span>, <span class="hljs-built_in">this</span>)<br>         <span class="hljs-comment">// å¹³æ—¶å¼€å‘å¯ä»¥ç›´æ¥ä½¿ç”¨ View.postOnAnimation(View.this, this)</span><br>	&#125;<br>&#125;<br><span class="hljs-comment">// è¿™æ ·å°±å½¢æˆäº†ä¸€ç§éšå¼çš„é€’å½’ï¼Œåœ¨æ¯æ¬¡å±å¹•åˆ·æ–°æ—¶è°ƒç”¨ run()</span><br></code></pre></td></tr></table></figure>


</blockquote>
<h4 id="3ã€View-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#3ã€View-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3ã€View çš„ç”Ÿå‘½å‘¨æœŸ"></a>3ã€View çš„ç”Ÿå‘½å‘¨æœŸ</h4><blockquote>
<p>View ä¹Ÿæœ‰ä»€ä¹ˆå‘¨æœŸï¼Œä½† View çš„ç”Ÿå‘½å‘¨æœŸå¾ˆä¸å®Œå–„</p>
<pre><code class=" mermaid">graph TB
id1(&quot;æ„é€ å‡½æ•°ï¼ˆå¯¹åº” onCreate()ï¼‰&quot;)--&gt;id2
id2[&quot;onFinishInflate()ï¼ˆå¯¹åº” onCreate() ä¸­çš„ setContentView()ï¼‰&quot;]--&gt;id3
id3[&quot;onAttachedToWindow()&quot;]--&gt;id4
id4[&quot;onWindowVisbilityChanged()&quot;]--&gt;id5
id5[&quot;onMeasure()&quot;]--&gt;id6
id6[&quot;onLayout()&quot;]--&gt;id7
id7[&quot;onDraw()&quot;]--&gt;id8
id8[&quot;onWindowFocusChanged()&quot;]--&gt;id9
id9[&quot;onWindowVisibilityChanged()&quot;]--&gt;id10
id10[&quot;onDetachedFromWindow()&quot;]
</code></pre>

<h5 id="onFinishInflate"><a href="#onFinishInflate" class="headerlink" title="onFinishInflate()"></a>onFinishInflate()</h5><p> ä» xml ä¸­å®Œå…¨åŠ è½½å®Œæ—¶çš„å›è°ƒ</p>
<h5 id="onAttachedToWindow"><a href="#onAttachedToWindow" class="headerlink" title="onAttachedToWindow()"></a>onAttachedToWindow()</h5><p>å¼€å§‹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„å›è°ƒ</p>
<h5 id="onWindowVisbilityChanged"><a href="#onWindowVisbilityChanged" class="headerlink" title="onWindowVisbilityChanged()"></a>onWindowVisbilityChanged()</h5><p>çª—å£å¯è§æ€§æ”¹å˜çš„å›è°ƒ</p>
<h5 id="onWindowFocusChanged"><a href="#onWindowFocusChanged" class="headerlink" title="onWindowFocusChanged()"></a>onWindowFocusChanged()</h5><p>çª—å£è·å–ç„¦ç‚¹æ—¶çš„å›è°ƒ</p>
<h5 id="onDetachedFromWindow"><a href="#onDetachedFromWindow" class="headerlink" title="onDetachedFromWindow()"></a>onDetachedFromWindow()</h5><p>View ä¸æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„å›è°ƒ</p>
<p>å…¶ä»–çš„çœ‹çœ‹è¿™ç¯‡æ–‡ç« å§ï¼š<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0a4cb44ce9d1">https://www.jianshu.com/p/0a4cb44ce9d1</a></p>
<p>å¯ä»¥çœ‹åˆ°å…¶å® View çš„ç”Ÿå‘½å‘¨æœŸä¸æ˜¯å¾ˆå®Œå–„ï¼Œç”šè‡³è¿è‡ªèº«ä»€ä¹ˆæ—¶å€™è¢«æ·»åŠ è¿› ViewGroup éƒ½æ²¡æœ‰æ–¹æ³•å›è°ƒï¼Œremove ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½†å¦‚æœæƒ³å®ç° addView å’Œ removeView ç›‘å¬çš„è¯ï¼ŒæŸ¥çœ‹æºç åå‘ç°åªèƒ½ä½¿ç”¨ <code>ViewGroup#setOnHierarchyChangeListener()</code>ï¼Œæ„æ€æ˜¯åœ¨ View ä¸­é€šè¿‡ç»™ parent è®¾ç½®ç›‘å¬ï¼Œä½†è¿™ä¸ªæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯åªèƒ½è®¾ç½®ä¸€æ¬¡ç›‘å¬</p>
</blockquote>
<h4 id="4ã€è‡ªå®šä¹‰-View-çš„ä¸€äº›è§„èŒƒ"><a href="#4ã€è‡ªå®šä¹‰-View-çš„ä¸€äº›è§„èŒƒ" class="headerlink" title="4ã€è‡ªå®šä¹‰ View çš„ä¸€äº›è§„èŒƒ"></a>4ã€è‡ªå®šä¹‰ View çš„ä¸€äº›è§„èŒƒ</h4><blockquote>
<ul>
<li>åº”è¯¥å°½é‡è§£è€¦ï¼ŒView é‡Œé¢ä¸å»ºè®®åŒ…å« <code>ç½‘ç»œè¯·æ±‚</code>ã€<code>Rxjavaj</code>ã€<code>EventBus</code>ã€<code>Lifecycle ç›¸å…³ç»„ä»¶</code> ç­‰ï¼Œè¿™äº›åº”è¯¥æ˜¯ä¸»è¯­åº”ç”¨å±‚ä½¿ç”¨çš„ï¼Œè€Œä¸æ˜¯åœ¨ View é‡Œé¢ä½¿ç”¨ï¼ŒView é‡Œé¢åº”è¯¥å°½é‡ä½¿ç”¨ MVC çš„æ¨¡å¼æ¥å†™</li>
<li>å¯ä»¥åˆ†ç¦»ä¸€äº›èŒè´£å‡ºæ¥ï¼Œæ¯”å¦‚è¯¾è¡¨æˆ‘å°±æŠŠäº‹ä»¶å’Œç»˜åˆ¶é€šè¿‡è®¾ç½®ç›‘å¬çš„æ–¹å¼æ¥åˆ†ç¦»ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ‰©å±•ï¼Œè€Œä¸æ˜¯å…¨éƒ¨å¡åœ¨ View é‡Œé¢</li>
</ul>
<h5 id="åˆ†ç¦»-Draw-äº‹ä»¶"><a href="#åˆ†ç¦»-Draw-äº‹ä»¶" class="headerlink" title="åˆ†ç¦» Draw äº‹ä»¶"></a>åˆ†ç¦» Draw äº‹ä»¶</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è‡ªå®šä¹‰ç»˜å›¾çš„ç›‘å¬</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mItemDecoration = ArrayList&lt;ItemDecoration&gt;(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatchDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> &#123;<br>    mItemDecoration.forEach &#123;<br>        it.onDrawBelow(canvas, <span class="hljs-keyword">this</span>)<br>    &#125;<br>    <span class="hljs-keyword">super</span>.dispatchDraw(canvas)<br>    mItemDecoration.forEach &#123;<br>        it.onDrawAbove(canvas, <span class="hljs-keyword">this</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¯¥ç±»ä¸»è¦ç”¨äºå®ç°ä¸€äº›ç®€å•çš„ç»˜å›¾å¤„ç†</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ç»è¿‡æˆ‘çš„æ€è€ƒï¼Œæˆ‘è®¤ä¸ºä¸åº”è¯¥æä¾›åˆ é™¤çš„æ–¹æ³•ï¼ŒåŸå› å¦‚ä¸‹ï¼š</span><br><span class="hljs-comment"> * - ä¸€èˆ¬ä¸ä¼šæœ‰éœ€è¦ä¸­é€”åˆ é™¤çš„æƒ…å†µ</span><br><span class="hljs-comment"> * - å¾ˆå®¹æ˜“å‡ºç°äº‹ä»¶åœ¨éå†ä¸­å°±æŠŠå®ƒåˆ é™¤ï¼Œå¯¼è‡´å‡ºç°éå†è¶Šä½çš„é”™è¯¯</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * è®¾è®¡å‚è€ƒäº† RV çš„ ItemDecoration</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 985892345 (Guo Xiangrui)</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@email</span> 2767465918<span class="hljs-doctag">@qq</span>.com</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/1/27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ItemDecoration</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨æ‰€æœ‰å­ View çš„ onDraw() å‰çš„å›è°ƒï¼Œåœ¨è¿™é‡Œé¢ç»˜å›¾å¯ä»¥ç»˜åˆ¶åœ¨å­ View ä¸‹æ–¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawBelow</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>, view: <span class="hljs-type">View</span>)</span></span> &#123; &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨æ‰€æœ‰å­ View çš„ onDraw() åçš„å›è°ƒï¼Œåœ¨è¿™é‡Œé¢ç»˜å›¾å¯ä»¥ç»˜åˆ¶åœ¨å­ View ä¸Šæ–¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawAbove</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>, view: <span class="hljs-type">View</span>)</span></span> &#123; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿˜æœ‰åˆ†ç¦»äº‹ä»¶åˆ†å‘ï¼Œæˆ‘å°±ç•™åˆ°ä¸‹æ¬¡è¯¾æ¥è®²äº†</p>
</blockquote>
<h4 id="5ã€å¸ƒå±€è°ƒè¯•è½¯ä»¶"><a href="#5ã€å¸ƒå±€è°ƒè¯•è½¯ä»¶" class="headerlink" title="5ã€å¸ƒå±€è°ƒè¯•è½¯ä»¶"></a>5ã€å¸ƒå±€è°ƒè¯•è½¯ä»¶</h4><blockquote>
<p>Android è°ƒè¯•åˆ©å™¨ Pandora</p>
<p>ä¸€ä¸ªå¾ˆç‰›é€¼çš„ debug å·¥å…·ï¼Œå¯ä»¥åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹å¸ƒå±€å±æ€§ã€ç½‘ç»œè¯·æ±‚ã€sp ç­‰å¾ˆå¤šä¸œè¥¿</p>
<p><a target="_blank" rel="noopener" href="https://www.wanandroid.com/blog/show/2183">https://www.wanandroid.com/blog/show/2183</a></p>
</blockquote>
<h4 id="6ã€Rv-æ€ä¹ˆå¾—åˆ°æŸä¸ª-item-çš„å®ä¾‹"><a href="#6ã€Rv-æ€ä¹ˆå¾—åˆ°æŸä¸ª-item-çš„å®ä¾‹" class="headerlink" title="6ã€Rv æ€ä¹ˆå¾—åˆ°æŸä¸ª item  çš„å®ä¾‹"></a>6ã€Rv æ€ä¹ˆå¾—åˆ°æŸä¸ª item  çš„å®ä¾‹</h4><blockquote>
<p>è¿™ä¸ç®—è‡ªå®šä¹‰ View çš„å†…å®¹ï¼Œå› ä¸ºå¯’å‡æ—¶æœ‰å¾ˆå¤šå­¦å¼Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è¿™é‡Œè®²è§£ä¸€ä¸‹å§</p>
<p>å¾—åˆ°é‡Œé¢çš„ item æ›´å»ºè®®ä½¿ç”¨åœ¨ä¸éœ€è¦ä¿æŒçŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æŸä¸ª item çš„å˜åŠ¨éœ€è¦åŠ è½½åŠ¨ç”»ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RvAdapter</span> : <span class="hljs-type">RecyclerView.Adapter</span>&lt;<span class="hljs-type">RvAdapter.RvVH</span>&gt;() &#123;<br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RvVH</span>(itemView: View) : RecyclerView.ViewHolder(itemView) &#123;<br>     <span class="hljs-keyword">val</span> mAnimationView: AnimationView = itemView.findViewById(R.id.item_animation)<br> &#125;<br><br> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getVHolder</span><span class="hljs-params">(position: <span class="hljs-type">Int</span>, call: <span class="hljs-type">VHolderCallback</span>)</span></span> &#123;<br>     <span class="hljs-comment">// è°ƒç”¨ä¸¤ä¸ªå‚æ•°çš„è¿™ä¸ªåˆ·æ–°</span><br>     notifyItemChanged(position, call)<br> &#125;<br><br> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">     parent: <span class="hljs-type">ViewGroup</span>, </span></span><br><span class="hljs-params"><span class="hljs-function">     viewType: <span class="hljs-type">Int</span></span></span><br><span class="hljs-params"><span class="hljs-function"> )</span></span>: RvVH &#123;<br>     <span class="hljs-keyword">return</span> RvVH(<br>         LayoutInflater<br>         	.from(parent.context)<br>         	.inflate(R.layout.layout_item, parent, <span class="hljs-literal">false</span>)<br>     )<br> &#125;<br><br> <span class="hljs-comment">// é‡å†™ä¸‰ä¸ªå‚æ•°çš„è¿™ä¸ªæ–¹æ³•</span><br> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">     holder: <span class="hljs-type">RvVH</span>, </span></span><br><span class="hljs-params"><span class="hljs-function">     position: <span class="hljs-type">Int</span>, </span></span><br><span class="hljs-params"><span class="hljs-function">     payloads: <span class="hljs-type">MutableList</span>&lt;<span class="hljs-type">Any</span>&gt;</span></span><br><span class="hljs-params"><span class="hljs-function"> )</span></span> &#123;<br>     <span class="hljs-keyword">if</span> (payloads.isEmpty()) &#123;<br>         <span class="hljs-keyword">super</span>.onBindViewHolder(holder, position, payloads)<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-comment">// è¿™é‡Œå¾—åˆ° payloads å°±æ˜¯ä¹‹å‰åˆ·æ–°ä¼ å…¥çš„å›è°ƒ</span><br>         <span class="hljs-comment">// å› ä¸ºæ˜¯åœ¨ä¸‹ä¸€å¸§æ‰ä¼šåˆ·æ–°ï¼ŒæœŸé—´å¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡åˆ·æ–° itemï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ª List</span><br>         payloads.forEach &#123;<br>             <span class="hljs-keyword">if</span> (it <span class="hljs-keyword">is</span> VHolderCallback) &#123;<br>                 it.call(holder)<br>             &#125;<br>         &#125;<br>     &#125;<br> &#125;<br><br> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">RvVH</span>, position: <span class="hljs-type">Int</span>)</span></span> &#123;<br> &#125;<br><br> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = <span class="hljs-number">100</span><br><br> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-keyword">interface</span> VHolderCallback &#123;</span><br>     <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">call</span><span class="hljs-params">(holder: <span class="hljs-type">RvVH</span>)</span></span><br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹å¼å°±æ˜¯è°ƒç”¨ <code>getVHolder()</code> å°±å¯ä»¥äº†</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">getVHolder(<span class="hljs-number">1</span>) &#123;<br> <span class="hljs-comment">// å¼€å§‹åŠ¨ç”»</span><br> it.mAnimationView.startAnim()<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><p>è¿™ç§æ–¹æ³•åœ¨å›è°ƒæ—¶ä¸èƒ½è¿›è¡Œå»¶è¿Ÿä¿å­˜è¿”å›çš„ holder å¯¹è±¡ï¼Œå› ä¸ºå®ƒåªæ˜¯ç›®å‰çŠ¶æ€ä¸‹çš„ holderï¼Œä¸èƒ½ä¿è¯åˆ·æ–°åä»æ˜¯è¿™ä¸ª</p>
</li>
<li><p>è¿™é‡Œé¢å¯¹ View çš„è®¾ç½®éƒ½æ˜¯æš‚æ—¶çš„ï¼Œæ‰€ä»¥æœ€å¼€å§‹æˆ‘å°±è¯´äº†ç”¨æ¥è°ƒç”¨ä¸€ä¸‹åŠ¨ç”»æ‰èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¦‚æœæƒ³æ°¸ä¹…ä¿å­˜å»ºè®®ï¼š</p>
<ul>
<li>æ”¹å˜ä¼ å…¥ Rv çš„æ•°æ®é›†åˆï¼Œ</li>
<li>æˆ–è€…è°ƒç”¨ <code>ViewHolder#setIsRecyclable(false)</code>ï¼Œä½†è¦è®°å¾—åœ¨ä¹‹åè¿˜åŸï¼Œä¸ç„¶è¿™ä¸ª ViewHolder å°±ä¸ä¼šè¢«å›æ”¶</li>
</ul>
</li>
<li><p>è¿™ç§æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">getVHolder(<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-comment">// å¼€å§‹åŠ¨ç”»</span><br>    it.setIsRecyclable(<span class="hljs-literal">false</span>)<br>    it.mAnimationView.startAnim()<br>&#125;<br><span class="hljs-comment">// åé¢è°ƒç”¨è¿™ä¸ªè¿›è¡Œæ™®é€šåˆ·æ–°ï¼Œåªè¦å‡ºç°äº†è¿™ä¸ªï¼Œå‰é¢çš„ç‰¹æ®Šåˆ·æ–°éƒ½ä¼šå¤±æ•ˆ</span><br>notifyItemChanged(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<p>å¯¹äºå·®åˆ†åˆ·æ–°ä¹Ÿæœ‰ä¸€ä¸ªä¸ payload ç›¸å…³çš„æ–¹æ³•</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// è¿™ä¸ªæ˜¯ ItemCallbackï¼Œä½†ä¸ DiffUtil.Callback æ˜¯å·®ä¸å¤šçš„</span><br><span class="hljs-keyword">object</span> : DiffUtil.ItemCallback&lt;ICourseVpBean&gt;() &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">areItemsTheSame</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        oldItem: <span class="hljs-type">ICourseVpBean</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        newItem: <span class="hljs-type">ICourseVpBean</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> oldItem.week == newItem.week<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">areContentsTheSame</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        oldItem: <span class="hljs-type">ICourseVpBean</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        newItem: <span class="hljs-type">ICourseVpBean</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> oldItem == newItem<br>    &#125;<br><br>    <span class="hljs-comment">// å°±è¿™ä¸ªæ–¹æ³•ï¼Œå»ºè®®é‡å†™å¹¶ä¸è¿”å›</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getChangePayload</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        oldItem: <span class="hljs-type">ICourseVpBean</span>, </span></span><br><span class="hljs-params"><span class="hljs-function">        newItem: <span class="hljs-type">ICourseVpBean</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: Any &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment">// åªè¦ä¸ä¸º null å°±å¯ä»¥åœ¨åˆ·æ–°æ—¶å»æ‰ä¸ç¼“å­˜çš„äº’æ¢ï¼Œå‡å°‘æ€§èƒ½çš„æ¶ˆè€—</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="äºŒã€åŠ¨ç”»"><a href="#äºŒã€åŠ¨ç”»" class="headerlink" title="äºŒã€åŠ¨ç”»"></a>äºŒã€åŠ¨ç”»</h2><blockquote>
<p>åŠ¨ç”»è¿™ä¸œè¥¿å»ºè®®çœ‹ã€ŠAndroidè‡ªå®šä¹‰æ§ä»¶å¼€å‘å…¥é—¨ä¸å®æˆ˜ã€‹å’Œä¸‹é¢è¿™ç½‘å€ï¼Œæˆ‘è¿™é‡Œå°±ä¸è¿›è¡Œè®²è§£äº†</p>
<p><a target="_blank" rel="noopener" href="https://qijian.blog.csdn.net/article/details/50995268">https://qijian.blog.csdn.net/article/details/50995268</a></p>
<p>æœ¬èŠ‚è¯¾ä¸»è¦è®²å…ƒç´ å…±äº«åŠ¨ç”»</p>
<p>å› ä¸ºæ—¶é—´å…³ç³»å†™ä¸äº†äº†ï¼ˆè¿™è¯¾ä»¶ç¡®å®æŠŠæˆ‘å†™ç´¯äº†ï¼‰ï¼Œè¿™é‡Œç»™å‡ºä¸€äº›ç½‘å€ï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903727015395336">https://juejin.cn/post/6844903727015395336</a></p>
<blockquote>
<p>è¿™ä¸ªä¸»è¦å†™äº† activity ä¹‹é—´çš„å…ƒç´ å…±äº«ï¼Œä¾‹å­è¾ƒå…¨</p>
</blockquote>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29425853/article/details/53104919">https://blog.csdn.net/qq_29425853/article/details/53104919</a></p>
</li>
</ul>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Android/">#Android</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Viewç›¸å…³</div>
      <div>http://example.com/2022/08/08/è‡ªå®šä¹‰View/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 8, 2022</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>Licensed under</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/11/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="Androidæ€§èƒ½ä¼˜åŒ–">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Androidæ€§èƒ½ä¼˜åŒ–</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/14/Gilde%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Glideæ·±å…¥åˆ†æ">
                        <span class="hidden-mobile">Glideæ·±å…¥åˆ†æ</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
